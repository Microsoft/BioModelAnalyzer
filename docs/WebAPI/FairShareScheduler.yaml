swagger: '2.0'

# LTL Query Web API (long-running jobs)
info:
  version: "0.0.2"
  title: FairShareScheduler
  
basePath: /api/lra

host: localhost:8223

paths:
  /{appId}:
    post:
      description: |
        Schedules new job.
      parameters:
        - name: appId
          in: path
          description: Identifies the application that is sending the job
          required: true
          type: string
          format: guid
      produces:
        - text/plain
        - application/json          
      responses:
        200:
          description: The job is scheduled to execute.
          schema: 
            description: Job identifier that allows to get status and result of the job.
            type: string
            format: guid
    get:
      description: |
        Gets status of the job.
      parameters: 
        - name: jobId
          in: query
          description: Identifies the job. This is the identifier that is returned when the job is added
          required: true
          type: string
          format: guid
        - name: appId
          in: path
          description: Identifies the application that is sending the job
          required: true
          type: string
          format: guid
      produces:
        - text/plain
        - application/json
      responses:
        # Response code
        404:
          description: There is no job with the given job id and application id
        200:
          description: Succeeded - the job is succeeded
        201:
          description: Queued - the job is queued and awaits to be chosen by a worker
          schema:
            description: |
              Approximate position of the job in the queue. Starts with zero. 
              Negative value indicates that the position couldn't be determined.
            type: integer
            format: int32
        202:
          description: Executing - the job is being executed
          schema:
            description: Additional information.
            type: object
            properties:
              started:
                description: Time in milliseconds passed since the execution started (at the moment when this response is built).
                type: integer
                format: int32
              elapsed:
                description: Time when the job started. See rfc 3339.
                type: string
                format: date-time
        203:
          description: Failed - the job is failed
          schema:
            description: Description of the failure.
            type: string
        501:
          description: Unknown status
    delete:
      description: |
        Deletes the job and, if appropriate, cancels the execution.
      parameters: 
        - name: jobId
          in: query
          description: Identifies the job. This is the identifier that is returned when the job is added
          required: true
          type: string
          format: guid
        - name: appId
          in: path
          description: Identifies the application that is sending the job
          required: true
          type: string
          format: guid 
      produces:
        - text/plain
      responses:
        200:
          description: Job is deleted from the scheduler. The workers will not take the job for execution. If the job is already executing, it is requested to cancel but it is still possible that its result will be saved.
        404:
          description: Combination of the application and job IDs is not found.
        500:
          description: Exceptions occured when deleting the jobs. The scheduler is consistent though it is not guaranteed that the job execution is requested to cancel or the job will no be executed later.
          schema:
            description: Description of the failure.
            type: string
  /{appId}/result:
    get:
      description: |
        Gets result of the succeeded job.
      parameters: 
        - name: jobId
          in: query
          description: Identifies the job. This is the identifier that is returned when the job is added
          required: true
          type: string
          format: guid
        - name: appId
          in: path
          description: Identifies the application that is sending the job
          required: true
          type: string
          format: guid
      produces:
        - application/json
      responses:
        # Response code
        404:
          description: Either there is no job with the given job id and application id, or the job is not succeeded.
        200:
          description: The job is succeeded and its result is in the response.