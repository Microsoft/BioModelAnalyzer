var __extends,BMA;(function(n,t,i,r){n.SVGPlot=function(n,u){var s,h;this.base=t.Plot;this.base(n,u);var o=this,f=r,e=r;Object.defineProperty(this,"svg",{get:function(){return e}});s=function(n){e=n;n.configure({width:f.width(),height:f.height(),viewBox:"0 0 1 1",preserveAspectRatio:"none meet"},!0);o.host.trigger("svgLoaded")};h=function(n,t){return(n-(t.y+t.height/2))*-1+t.y+t.height/2};this.arrange=function(n){if(t.CanvasPlot.prototype.arrange.call(this,n),f===r&&(f=i("<div><\/div>").css("overflow","hidden").appendTo(o.host),f.svg({onLoad:s})),f.width(n.width).height(n.height),e!==r){var u=o.visibleRect;e.configure({width:f.width(),height:f.height()},!1);isNaN(u.y)||isNaN(u.height)||e.configure({viewBox:u.x+" "+(-u.y-u.height)+" "+u.width+" "+u.height},!1)}};this.getTransform=function(){var n=this.coordinateTransform,t=n.plotToScreenX,i=n.plotToScreenY,r=this.xDataTransform&&this.xDataTransform.dataToPlot,u=this.yDataTransform&&this.yDataTransform.dataToPlot,f=r?function(n){return t(r(n))}:t,e=u?function(n){return i(u(n))}:i;return{dataToScreenX:f,dataToScreenY:e}};this.getScreenToDataTransform=function(){var n=this.coordinateTransform,t=n.screenToPlotX,i=n.screenToPlotY,r=this.xDataTransform&&this.xDataTransform.plotToData,u=this.yDataTransform&&this.yDataTransform.plotToData,f=r?function(n){return r(t(n))}:t,e=u?function(n){return u(i(n))}:i;return{screenToDataX:f,screenToDataY:e}}};n.SVGPlot.prototype=new t.Plot;t.register("svgPlot",function(t,i){return new n.SVGPlot(t,i)});n.RectsPlot=function(n,i){this.base=t.CanvasPlot;this.base(n,i);var u;this.draw=function(n){u=n.rects;u||(u=[]);this.invalidateLocalBounds();this.requestNextFrameOrUpdate();this.fireAppearanceChanged()};this.computeLocalBounds=function(){var f=this.xDataTransform&&this.xDataTransform.dataToPlot,e=this.yDataTransform&&this.yDataTransform.dataToPlot,i,n;if(u===r||u.length<1)return r;for(i={x:u[0].x,y:u[0].y,width:u[0].width,height:u[0].height},n=1;n<u.length;n++)i=t.Utils.unionRects(i,{x:u[n].x,y:u[n].y,width:u[n].width,height:u[n].height});return i};this.getLocalPadding=function(){return{left:0,right:0,top:0,bottom:0}};this.renderCore=function(n,i){var e,f;if(t.Polyline.prototype.renderCore.call(this,n,i),u!==r&&!(u.length<1)){var h=this.getTransform(),o=h.dataToScreenX,s=h.dataToScreenY,l=i.width,a=i.height,b=l,k=a,c=this.getContext(!0);for(e=0;e<u.length;e++){f=u[e];c.fillStyle=f.fill;var v=o(f.x),y=s(f.y+f.height),p=o(f.x+f.width)-o(f.x),w=s(f.y)-s(f.y+f.height);c.fillRect(v,y,p,w)}}};this.onDataTransformChanged=function(n){this.invalidateLocalBounds();t.RectsPlot.prototype.onDataTransformChanged.call(this,n)}};n.RectsPlot.prototype=new t.CanvasPlot;t.register("rectsPlot",function(t,i){return new n.RectsPlot(t,i)})})(window.BMAExt=window.BMAExt||{},InteractiveDataDisplay||{},jQuery),function(n,t){n.GridLinesPlot=function(n,i){this.base=t.CanvasPlot;this.base(n,i);var f=0,r=1,e=0,u=1,s="1px",o="LightGray",h={};t.Utils.readStyle(this.host,h);h&&(o=typeof h.stroke!="undefined"?h.stroke:o,s=typeof h.thickness!="undefined"?h.thickness:s);Object.defineProperty(this,"x0",{get:function(){return f},set:function(n){n!=f&&(f=n,this.requestUpdateLayout())},configurable:!1});Object.defineProperty(this,"xStep",{get:function(){return r},set:function(n){if(n!=r){if(r<=0)throw"xStep show be positive";r=n;this.requestUpdateLayout()}},configurable:!1});Object.defineProperty(this,"y0",{get:function(){return e},set:function(n){n!=e&&(e=n,this.requestUpdateLayout())},configurable:!1});Object.defineProperty(this,"yStep",{get:function(){return u},set:function(n){if(n!=u){if(u<=0)throw"yStep show be positive";u=n;this.requestUpdateLayout()}},configurable:!1});Object.defineProperty(this,"thickness",{get:function(){return s},set:function(n){if(n!=s){if(n<=0)throw"GridLines thickness must be positive";s=n;this.requestNextFrameOrUpdate()}},configurable:!1});Object.defineProperty(this,"stroke",{get:function(){return o},set:function(n){n!=o&&(o=n,this.requestNextFrameOrUpdate())},configurable:!1});this.renderCore=function(n,i){var p,a,v,b,k,h,y;t.GridlinesPlot.prototype.renderCore.call(this,n,i);p=this.getTransform();a=this.getContext(!0);a.strokeStyle=o;a.fillStyle=o;a.lineWidth=1;for(var w=parseInt(s.slice(0,-2)),c=[],d=Math.ceil((n.x-f)/r)*r+f,g=(Math.ceil((n.x+n.width-f)/r)-1)*r+f,l=d;l<=g;)c.push(l),l+=r;for(h=0,y=c.length;h<y;h++)v=p.dataToScreenX(c[h]),a.fillRect(v,0,w,i.height);for(c=[],b=Math.ceil((n.y-e)/u)*u+e,k=(Math.ceil((n.y+n.height-e)/u)-1)*u+e,l=b;l<=k;)c.push(l),l+=u;for(v,h=0,y=c.length;h<y;h++)v=p.dataToScreenY(c[h]),a.fillRect(0,v,i.width,w)};this.getTransform=function(){var n=this.coordinateTransform,t=n.plotToScreenX,i=n.plotToScreenY,r=this.xDataTransform&&this.xDataTransform.dataToPlot,u=this.yDataTransform&&this.yDataTransform.dataToPlot,f=r?function(n){return t(r(n))}:t,e=u?function(n){return i(u(n))}:i;return{dataToScreenX:f,dataToScreenY:e}}};n.GridLinesPlot.prototype=new t.CanvasPlot;t.register("scalableGridLines",function(t,i){return new n.GridLinesPlot(t,i)})}(window.BMAExt=window.BMAExt||{},InteractiveDataDisplay||{},jQuery),function(n){function t(t,i){var u=$(t),f=u.children("Model").children("Variables").children("Variable"),e=f.map(function(t,i){var r=$(i),u=r.children("ContainerId").text();return u=u===""?"-1":u,new n.Model.Variable(parseInt(r.attr("Id")),parseInt(u),r.children("Type").text(),r.attr("Name"),parseInt(r.children("RangeFrom").text()),parseInt(r.children("RangeTo").text()),r.children("Formula").text())}).get(),o=u.children("Model").children("Relationships").children("Relationship"),s=o.map(function(t,i){var r=$(i);return new n.Model.Relationship(parseInt(r.attr("Id")),parseInt(r.children("FromVariableId").text()),parseInt(r.children("ToVariableId").text()),r.children("Type").text())}).get(),h=u.children("Model").children("Containers").children("Container"),r=h.map(function(t,i){var r=$(i),u=r.children("Size").text();return u=u===""?"1":u,new n.Model.ContainerLayout(parseInt(r.attr("Id")),r.attr("Name"),parseInt(u),parseInt(r.children("PositionX").text()),parseInt(r.children("PositionY").text()))}).get(),c=f.map(function(t,u){var s=$(u),g=parseInt(s.attr("Id")),a=s.children("CellX").text(),v=s.children("CellY").text(),w,k,h,c,y,p,d,o,f,b,l;if(a===""||v==="")if(w=s.children("ContainerId").text(),w!==""){for(k=parseInt(w),f=0;f<r.length;f++)if(r[f].Id===k){a=r[f].PositionX.toString();v=r[f].PositionY.toString();break}}else a="0",v="0";if(h=s.children("PositionX").text(),h=h===""?"0":h,c=s.children("PositionY").text(),c=c===""?"0":c,y=parseInt(a)*i.xStep+i.xOrigin+parseFloat(h)*(i.xStep-60)/300+30,p=parseInt(v)*i.yStep+i.yOrigin+parseFloat(c)*(i.yStep-50)/350+25,e[t].Type==="MembraneReceptor"){for(d=parseInt(s.children("ContainerId").text()),o=undefined,f=0;f<r.length;f++)if(r[f].Id===d){o=r[f];break}b=n.SVGHelper.GeEllipsePoint((o.PositionX+.5)*i.xStep+i.xOrigin+(o.Size-1)*i.xStep/2+2.5*o.Size,(o.PositionY+.5)*i.yStep+i.yOrigin+(o.Size-1)*i.yStep/2,107*o.Size,127*o.Size,y,p);y=b.x;p=b.y}return l=s.children("Angle").text(),l=l===""?"0":l,new n.Model.VariableLayout(g,y,p,Number.NaN,Number.NaN,parseFloat(l))}).get();return{Model:new n.Model.BioModel(u.children("Model").attr("Name"),e,s),Layout:new n.Model.Layout(r,c)}}n.ParseXmlModel=t}(BMA||(BMA={})),function(n){var t;(function(t){function i(t,i){var r=t.className.baseVal;r?n.SVGHelper.StringInString(r,i)||(t.className.baseVal=r+" "+i):t.className.baseVal=i}function r(n,t){var i=n.className.baseVal.replace(new RegExp("(\\s|^)"+t+"(\\s|$)")," ");i==" "&&(i=null);n.className.baseVal=i}function u(n,t){return n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function f(){return null}function e(n,t,i,r,u,f){if(u===n)return{x:n,y:t+r};var e=(t-f)/(n-u),o=(n*f-u*t)/(n-u),h=r*r+i*i*e*e,s=2*(e*(o-t)*i*i-r*r*n),l=n*n*r*r+i*i*(o-t)*(o-t)-r*r*i*i,a=(u-n)/Math.abs(u-n),c=(-s+a*Math.sqrt(s*s-4*h*l))/(2*h),v=e*c+o;return{x:c,y:v}}function o(n,t,i,r,u,f){if(u===n)return[{x:n,y:t+r},{x:n,y:t-r}];var o=(t-f)/(n-u),s=(n*f-u*t)/(n-u),h=r*r+i*i*o*o,e=2*(o*(s-t)*i*i-r*r*n),c=n*n*r*r+i*i*(s-t)*(s-t)-r*r*i*i,l=(u-n)/Math.abs(u-n),a=(-e+l*Math.sqrt(e*e-4*h*c))/(2*h),y=o*a+s,v=(-e-l*Math.sqrt(e*e-4*h*c))/(2*h),p=o*v+s;return[{x:a,y:y},{x:v,y:p}]}t.AddClass=i;t.RemoveClass=r;t.StringInString=u;t.DoNothing=f;t.GeEllipsePoint=e;t.GeEllipsePoints=o})(t=n.SVGHelper||(n.SVGHelper={}))}(BMA||(BMA={})),function(n){var t;(function(t){function i(n,t,i){var s=undefined,h,c,l,a,v,y,p,r,e,u,o,w;if(i.type==="variable")h=n.GetVariableById(i.id),c=t.GetVariableById(i.id),h!==undefined&&c!==undefined&&(s={Container:undefined,Realtionships:undefined,Variables:[{m:h,l:c}]});else if(i.type==="container"&&(l=i.id,a=t.GetContainerById(l),a!==undefined)){var f=[],b=n.Variables,k=t.Variables;for(r=0;r<b.length;r++)v=b[r],v.ContainerId===l&&f.push({m:v,l:k[r]});for(y=[],p=n.Relationships,r=0;r<p.length;r++){for(e=p[r],u=0,o=0;o<f.length;o++)if(w=f[o],e.FromVariableId===w.m.Id&&u++,e.ToVariableId===w.m.Id&&u++,u==2)break;u===2&&y.push(e)}s={Container:a,Realtionships:y,Variables:f}}return s}function r(t,i,r,u,f){var s=i.GetContainerById(r),o,h,w,e,tt,it;if(s!==undefined){var c=u-s.Size,b=i.Containers,k=t.Variables,d=i.Variables,l=[];for(h=0;h<b.length;h++)o=b[h],o.Id===s.Id?l.push(new n.Model.ContainerLayout(o.Id,o.Name,u,o.PositionX,o.PositionY)):o.PositionX>s.PositionX||o.PositionY>s.PositionY?l.push(new n.Model.ContainerLayout(o.Id,o.Name,o.Size,o.PositionX>s.PositionX?o.PositionX+c:o.PositionX,o.PositionY>s.PositionY?o.PositionY+c:o.PositionY)):l.push(o);var a=s.PositionX*f.xStep+f.xOrigin,v=s.PositionY*f.yStep+f.yOrigin,y=[];for(h=0;h<d.length;h++)if(w=k[h],e=d[h],k[h].ContainerId===s.Id)y.push(new n.Model.VariableLayout(e.Id,a+(e.PositionX-a)*u/s.Size,v+(e.PositionY-v)*u/s.Size,0,0,e.Angle));else if(w.Type==="Constant")y.push(new n.Model.VariableLayout(e.Id,e.PositionX>a+f.xStep?e.PositionX+c*f.xStep:e.PositionX,e.PositionY>v+f.yStep?e.PositionY+c*f.yStep:e.PositionY,0,0,e.Angle));else{var p=i.GetContainerById(w.ContainerId),g=p.PositionX*f.xStep+f.xOrigin,nt=p.PositionY*f.yStep+f.yOrigin,rt=(e.PositionX-g)/p.Size+g,ut=(e.PositionY-nt)/p.Size+nt;y.push(new n.Model.VariableLayout(e.Id,rt>a+f.xStep?e.PositionX+c*f.xStep:e.PositionX,ut>v+f.yStep?e.PositionY+c*f.yStep:e.PositionY,0,0,e.Angle))}return tt=new n.Model.Layout(l,y),it=new n.Model.BioModel(t.Name,t.Variables,t.Relationships),{model:it,layout:tt}}}function u(n,t){for(var i,o,c,h,f,r={x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},u={x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},s=n.Containers,e=0;e<s.length;e++)i=s[e],i.PositionX<r.x&&(r.x=i.PositionX),i.PositionY<r.y&&(r.y=i.PositionY),i.PositionX+i.Size-1>u.x&&(u.x=i.PositionX+i.Size-1),i.PositionY+i.Size-1>u.y&&(u.y=i.PositionY+i.Size-1);for(o=n.Variables,c=function(n,i){var r=Math.ceil((n-t.xOrigin)/t.xStep)-1,u=Math.ceil((i-t.yOrigin)/t.yStep)-1;return{x:r,y:u}},e=0;e<o.length;e++)h=o[e],f=c(h.PositionX,h.PositionY),f.x<r.x&&(r.x=f.x),f.y<r.y&&(r.y=f.y),f.x>u.x&&(u.x=f.x),f.y>u.y&&(u.y=f.y);return s.length===0&&o.length===0?undefined:{x:r.x*t.xStep+t.xOrigin,y:r.y*t.yStep+t.yOrigin,width:(u.x-r.x+1)*t.xStep,height:(u.y-r.y+1)*t.yStep}}t.CreateClipboardContent=i;t.ResizeContainer=r;t.GetModelBoundingBox=u})(t=n.ModelHelper||(n.ModelHelper={}))}(BMA||(BMA={})),function(n){var i=function(){function n(){this.registeredCommands=[]}return n.prototype.Execute=function(n,t){for(var i=0;i<this.registeredCommands.length;i++)if(this.registeredCommands[i].Name==n){this.registeredCommands[i].Execute(t);return}},n.prototype.On=function(n,i){for(var u,r=0;r<this.registeredCommands.length;r++)if(this.registeredCommands[r].Name==n){this.registeredCommands[r].RegisterCallback(i);return}u=new t(n);u.RegisterCallback(i);this.registeredCommands.push(u)},n.prototype.Off=function(n,t){for(var i=0;i<this.registeredCommands.length;i++)if(this.registeredCommands[i].Name==n){this.registeredCommands[i].UnregisterCallback(t);return}},n}(),t;n.CommandRegistry=i;t=function(){function n(n){this.name=n;this.callbacks=[]}return Object.defineProperty(n.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),n.prototype.RegisterCallback=function(n){this.callbacks.push(n)},n.prototype.UnregisterCallback=function(n){var t=this.callbacks.indexOf(n);t>-1&&this.callbacks.splice(t,1)},n.prototype.Execute=function(n){for(var t=0;t<this.callbacks.length;t++)this.callbacks[t](n)},n}();n.ApplicationCommand=t}(BMA||(BMA={}));__extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype;n.prototype=new r},function(n){var t;(function(t){var i=function(){function n(n,t,i,r,u){this.type=n;this.renderToSvg=t;this.contains=i;this.description=r;this.iconClass=u}return Object.defineProperty(n.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"RenderToSvg",{get:function(){return this.renderToSvg},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Description",{get:function(){return this.description},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"IconClass",{get:function(){return this.iconClass},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Contains",{get:function(){return this.contains},enumerable:!0,configurable:!0}),n}(),r,u,f;t.Element=i;r=function(n){function t(t,i,r,u,f,e){n.call(this,t,i,r,f,e);this.getBbox=u}return __extends(t,n),Object.defineProperty(t.prototype,"GetBoundingBox",{get:function(){return this.getBbox},enumerable:!0,configurable:!0}),t}(i);t.BboxElement=r;u=function(n){function t(t,i,r,u,f,e,o){n.call(this,t,i,r,e,o);this.intersectsBorder=u;this.containsBBox=f}return __extends(t,n),Object.defineProperty(t.prototype,"IntersectsBorder",{get:function(){return this.intersectsBorder},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ContainsBBox",{get:function(){return this.containsBBox},enumerable:!0,configurable:!0}),t}(i);t.BorderContainerElement=u;f=function(){function t(){var c=this,t,h;this.variableWidthConstant=35;this.variableHeightConstant=30;this.variableSizeConstant=30;this.relationshipBboxOffset=20;this.containerRadius=100;this.lineWidth=1;this.labelSize=10;this.labelVisibility=!0;t=this;this.elements=[];h=$("<div><\/div>");h.svg({onLoad:function(n){c.svg=n}});var e=102,o=124,l=112,a=130,s=5,v=0,f=100;this.elements.push(new u("Container",function(n){var i=t.svg,u,h,r,v;if(i===undefined)return undefined;i.clear();u=(n.layout.PositionX+.5)*n.grid.xStep+(n.layout.Size-1)*n.grid.xStep/2;h=(n.layout.PositionY+.5)*n.grid.yStep+(n.layout.Size-1)*n.grid.yStep/2;n.translate!==undefined&&(u+=n.translate.x,h+=n.translate.y);r=i.group({transform:"translate("+u+", "+h+")"});i.rect(r,-n.grid.xStep*n.layout.Size/2+n.grid.xStep/f+(n.translate===undefined?0:n.translate.x),-n.grid.yStep*n.layout.Size/2+n.grid.yStep/f+(n.translate===undefined?0:n.translate.y),n.grid.xStep*n.layout.Size-2*n.grid.xStep/f,n.grid.yStep*n.layout.Size-2*n.grid.yStep/f,0,0,{stroke:"none",fill:n.background!==undefined?n.background:"white"});var l=.45*n.layout.Size,a=i.createPath(),c=i.path(r,a,{stroke:"transparent",fill:"#FAAF40","fill-rule":"evenodd",d:"M249,577 C386.518903,577 498,447.83415 498,288.5 C498,129.16585 386.518903,0 249,0 C111.481097,0 0,129.16585 0,288.5 C0,447.83415 111.481097,577 249,577 Z M262,563 C387.368638,563 489,440.102164 489,288.5 C489,136.897836 387.368638,14 262,14 C136.631362,14 35,136.897836 35,288.5 C35,440.102164 136.631362,563 262,563 Z",transform:"scale("+l+") translate(-250, -290)"});return n.translate===undefined&&(i.ellipse(r,s*n.layout.Size,0,e*n.layout.Size,o*n.layout.Size,{stroke:"none",fill:"white"}),t.labelVisibility===!0&&n.layout.Name!==undefined&&n.layout.Name!==""&&(v=i.text(r,0,0,n.layout.Name,{transform:"translate("+-(n.layout.Size*n.grid.xStep/2-10*n.layout.Size)+", "+-(n.layout.Size*n.grid.yStep/2-t.labelSize-10*n.layout.Size)+")","font-size":t.labelSize*n.layout.Size,fill:"black"}))),$(c).attr("onmouseover","BMA.SVGHelper.AddClass(this, 'modeldesigner-element-hover')"),$(c).attr("onmouseout","BMA.SVGHelper.RemoveClass(this, 'modeldesigner-element-hover')"),$(i.toSVG()).children()},function(){return!1},function(n,t,i,r,u){var h=i+s*u.Size+u.xStep*(u.Size-1),c=Math.abs(n-h),y=i+v*u.Size+u.xStep*(u.Size-1),p=Math.abs(n-y),w=r+u.yStep*(u.Size-1),f=Math.abs(t-w),b=Math.pow(p/(l*u.Size),2)+Math.pow(f/(a*u.Size),2)<1,k=Math.pow(c/(e*u.Size),2)+Math.pow(f/(o*u.Size),2)>1;return b&&k},function(n,t,i,r){var u=function(n,u){var f=Math.abs(n-(t+s*r.Size+r.xStep*(r.Size-1))),h=Math.abs(u-i-r.yStep*(r.Size-1));return Math.pow(f/(e*r.Size),2)+Math.pow(h/(o*r.Size),2)<1},f=u(n.x,n.y),h=u(n.x,n.y+n.height),c=u(n.x+n.width,n.y),l=u(n.x+n.width,n.y+n.height);return f&&h&&c&&l},"Cell","cell-icon"));this.elements.push(new r("Constant",function(n){var i=t.svg,u,o;if(i===undefined)return undefined;i.clear();var r=i.group({transform:"translate("+n.layout.PositionX+", "+n.layout.PositionY+")"}),e=i.createPath(),f=i.path(r,e,{stroke:"transparent",fill:"#BBBDBF","stroke-width":8,d:"M27.3,43.4l-2.2-0.8c-12-4.4-19.3-11.5-20-19.7c0-0.5-0.1-0.9-0.1-1.4c-5.4-2.6-9-7.3-10.5-12.3c-0.6-2-0.9-4.1-0.8-6.3c-4.7-1.7-8.2-4.7-10.3-8.2c-2.1-3.4-3.2-8.1-2.1-13.4c-6.7-1.8-12.5-4.3-15.9-5.8l-7.4,19.9l26.7,7.9L-17,9.1l-32.8-9.7l11.9-32l3,1.5c3.9,1.9,10.8,4.9,18.1,6.9c1.9-4,5.1-8.1,10-12.1c10.8-8.9,19.7-8.1,23.8-3.4c3.5,4,3.6,11.6-4.2,18.7c-6.3,5.7-16.2,5.7-25.7,3.8c-0.6,3.2-0.2,6.2,1.4,8.9c1.3,2.2,3.4,4,6.3,5.3C-3.4-8.3,0.7-13.2,8-16c15.9-6.1,19.9,0.2,20.7,2.2c2.1,5.2-2.4,11.8-10.1,15C11.5,4.2,5.1,5-0.3,4.4C-0.2,5.5,0,6.5,0.3,7.5c0.9,3.2,3,6.1,6.2,8C8,12.1,11,9,15,6.7C25,1,32.2,1.6,35.7,4.2c2.3,1.7,3.3,4.3,2.7,7.1c-1.1,5.3-7.6,9.7-17.5,11.8c-3.6,0.8-6.8,0.8-9.7,0.4c1,4.9,6,9.5,13.9,12.8l7.4-10.7l17.4,10.1l-3,5.1l-12.6-7.4L27.3,43.4L27.3,43.4z M12.1,17.5c2.2,0.3,4.8,0.3,7.6-0.3c9.4-2,12.6-5.6,12.9-7.2c0.1-0.4,0-0.7-0.4-1c-1.4-1-6.2-1.7-14.1,2.9C15.2,13.4,13.2,15.4,12.1,17.5L12.1,17.5z M0.6-1.5C5-1,10.3-1.7,16.3-4.2c5.4-2.3,7.4-6,6.9-7.3c-0.4-1-4.3-2.2-13,1.1C5-8.5,2-5.1,0.6-1.5L0.6-1.5z M-10.8-22.8c7.8,1.4,15.2,1.3,19.5-2.6c4.7-4.2,5.4-8.4,3.7-10.4c-2.1-2.5-8.3-1.9-15.5,4.1C-6.5-28.9-9.1-25.9-10.8-22.8L-10.8-22.8z",transform:"scale(0.36)"});return t.labelVisibility===!0&&(u=0,n.model.Name!==""&&(o=i.text(r,0,0,n.model.Name,{transform:"translate("+-t.variableWidthConstant/2+", "+(t.variableHeightConstant/2+t.labelSize)+")","font-size":t.labelSize,fill:n.labelColor!==undefined?n.labelColor:"black"}),u+=t.labelSize),n.valueText!==undefined&&i.text(r,0,0,n.valueText+"",{transform:"translate("+-t.variableWidthConstant/2+", "+(t.variableHeightConstant/2+t.labelSize+u)+")","font-size":t.labelSize,fill:n.labelColor!==undefined?n.labelColor:"black"})),$(f).attr("onmouseover","BMA.SVGHelper.AddClass(this, 'modeldesigner-element-hover')"),$(f).attr("onmouseout","BMA.SVGHelper.RemoveClass(this, 'modeldesigner-element-hover')"),$(i.toSVG()).children()},function(n,i,r,u){return n>r-t.variableWidthConstant/2&&n<r+t.variableWidthConstant/2&&i>u-t.variableHeightConstant/2&&i<u+t.variableHeightConstant/2},function(n,i){return{x:n-t.variableWidthConstant/2,y:i-t.variableHeightConstant/2,width:t.variableWidthConstant,height:t.variableHeightConstant}},"Extracellular Protein","constant-icon"));this.elements.push(new r("Default",function(n){var i=t.svg,u,o;if(i===undefined)return undefined;i.clear();var r=i.group({transform:"translate("+n.layout.PositionX+", "+n.layout.PositionY+")"}),e=i.createPath(),f=i.path(r,e,{stroke:"transparent",fill:"#EF4137",strokeWidth:8,d:"M27.3,43.4l-2.2-0.8c-12-4.4-19.3-11.5-20-19.7c0-0.5-0.1-0.9-0.1-1.4c-5.4-2.6-9-7.3-10.5-12.3c-0.6-2-0.9-4.1-0.8-6.3c-4.7-1.7-8.2-4.7-10.3-8.2c-2.1-3.4-3.2-8.1-2.1-13.4c-6.7-1.8-12.5-4.3-15.9-5.8l-7.4,19.9l26.7,7.9L-17,9.1l-32.8-9.7l11.9-32l3,1.5c3.9,1.9,10.8,4.9,18.1,6.9c1.9-4,5.1-8.1,10-12.1c10.8-8.9,19.7-8.1,23.8-3.4c3.5,4,3.6,11.6-4.2,18.7c-6.3,5.7-16.2,5.7-25.7,3.8c-0.6,3.2-0.2,6.2,1.4,8.9c1.3,2.2,3.4,4,6.3,5.3C-3.4-8.3,0.7-13.2,8-16c15.9-6.1,19.9,0.2,20.7,2.2c2.1,5.2-2.4,11.8-10.1,15C11.5,4.2,5.1,5-0.3,4.4C-0.2,5.5,0,6.5,0.3,7.5c0.9,3.2,3,6.1,6.2,8C8,12.1,11,9,15,6.7C25,1,32.2,1.6,35.7,4.2c2.3,1.7,3.3,4.3,2.7,7.1c-1.1,5.3-7.6,9.7-17.5,11.8c-3.6,0.8-6.8,0.8-9.7,0.4c1,4.9,6,9.5,13.9,12.8l7.4-10.7l17.4,10.1l-3,5.1l-12.6-7.4L27.3,43.4L27.3,43.4z M12.1,17.5c2.2,0.3,4.8,0.3,7.6-0.3c9.4-2,12.6-5.6,12.9-7.2c0.1-0.4,0-0.7-0.4-1c-1.4-1-6.2-1.7-14.1,2.9C15.2,13.4,13.2,15.4,12.1,17.5L12.1,17.5z M0.6-1.5C5-1,10.3-1.7,16.3-4.2c5.4-2.3,7.4-6,6.9-7.3c-0.4-1-4.3-2.2-13,1.1C5-8.5,2-5.1,0.6-1.5L0.6-1.5z M-10.8-22.8c7.8,1.4,15.2,1.3,19.5-2.6c4.7-4.2,5.4-8.4,3.7-10.4c-2.1-2.5-8.3-1.9-15.5,4.1C-6.5-28.9-9.1-25.9-10.8-22.8L-10.8-22.8z",transform:"scale(0.25)"});return t.labelVisibility===!0&&(u=0,n.model.Name!==""&&(o=i.text(r,0,0,n.model.Name,{transform:"translate("+-t.variableWidthConstant/2+", "+(t.variableHeightConstant/2+t.labelSize)+")","font-size":t.labelSize,fill:n.labelColor!==undefined?n.labelColor:"black"}),u+=t.labelSize),n.valueText!==undefined&&i.text(r,0,0,n.valueText+"",{transform:"translate("+-t.variableWidthConstant/2+", "+(t.variableHeightConstant/2+t.labelSize+u)+")","font-size":t.labelSize,fill:n.labelColor!==undefined?n.labelColor:"black"})),$(f).attr("onmouseover","BMA.SVGHelper.AddClass(this, 'modeldesigner-element-hover')"),$(f).attr("onmouseout","BMA.SVGHelper.RemoveClass(this, 'modeldesigner-element-hover')"),$(i.toSVG()).children()},function(n,i,r,u){return n>r-t.variableWidthConstant/2&&n<r+t.variableWidthConstant/2&&i>u-t.variableHeightConstant/2&&i<u+t.variableHeightConstant/2},function(n,i){return{x:n-t.variableWidthConstant/2,y:i-t.variableHeightConstant/2,width:t.variableWidthConstant,height:t.variableHeightConstant}},"Intracellular Protein","variable-icon"));this.elements.push(new r("MembraneReceptor",function(n){var r=t.svg,s,u,e,v;if(r===undefined)return undefined;r.clear();var f=r.group({transform:"translate("+n.layout.PositionX+", "+n.layout.PositionY+")"}),c=(n.gridCell.x+.5)*n.grid.xStep+n.grid.x0+(n.sizeCoef-1)*n.grid.xStep/2,l=(n.gridCell.y+.5)*n.grid.yStep+n.grid.y0+(n.sizeCoef-1)*n.grid.yStep/2,i={x:n.layout.PositionX-c,y:n.layout.PositionY-l},o=Math.sqrt(i.x*i.x+i.y*i.y);i.x=i.x/o;i.y=i.y/o;s=Math.acos(-i.y);u=s*i.x/Math.abs(i.x);u=u*180/Math.PI;u<0&&(u+=360);var a=r.createPath(),h=r.path(f,a,{stroke:"transparent",fill:"#3BB34A",strokeWidth:8,d:"M9.9-10.5c-1.4-1.9-2.3,0.1-5.1,0.8C2.6-9.2,2.4-13.2,0-13.2c-2.4,0-2.4,3.5-4.8,3.5c-2.4,0-3.8-2.7-5.2-0.8l8.2,11.8v12.1c0,1,0.8,1.7,1.7,1.7c1,0,1.7-0.8,1.7-1.7V1.3L9.9-10.5z",transform:"scale(1.2) rotate("+u+")"});return t.labelVisibility===!0&&(e=0,n.model.Name!==""&&(v=r.text(f,0,0,n.model.Name,{transform:"translate("+-t.variableWidthConstant/2+", "+(t.variableHeightConstant/2+t.labelSize)+")","font-size":t.labelSize,fill:n.labelColor!==undefined?n.labelColor:"black"}),e+=t.labelSize),n.valueText!==undefined&&r.text(f,0,0,n.valueText+"",{transform:"translate("+-t.variableWidthConstant/2+", "+(t.variableHeightConstant/2+t.labelSize+e)+")","font-size":t.labelSize,fill:n.labelColor!==undefined?n.labelColor:"black"})),$(h).attr("onmouseover","BMA.SVGHelper.AddClass(this, 'modeldesigner-element-hover')"),$(h).attr("onmouseout","BMA.SVGHelper.RemoveClass(this, 'modeldesigner-element-hover')"),$(r.toSVG()).children()},function(n,i,r,u){return n>r-t.variableWidthConstant/2&&n<r+t.variableWidthConstant/2&&i>u-t.variableHeightConstant/2&&i<u+t.variableHeightConstant/2},function(n,i){return{x:n-t.variableWidthConstant/2,y:i-t.variableHeightConstant/2,width:t.variableWidthConstant,height:t.variableHeightConstant}},"Membrane Receptor","receptor-icon"));this.elements.push(new i("Activator",function(n){var r=t.svg,u,e,i,o;if(r===undefined)return undefined;if(r.clear(),u=undefined,e=t.lineWidth===0?1:t.lineWidth>0?t.lineWidth:1/Math.abs(t.lineWidth),n.layout.start.Id===n.layout.end.Id){var y=n.layout.start.PositionX,l=n.layout.start.PositionY,p=t.variableWidthConstant*.7,f=t.variableHeightConstant*.7,a=p*.6,c=f*1.6,v=a*(1-Math.sqrt(1-f*f/(c*c)))+y,w=r.createPath();u=r.path(w.move(v,l-f).arc(a,c,0,!0,!0,v,l+f),{fill:"none",stroke:"#808080",strokeWidth:e+1,"marker-end":"url(#Activator)"})}else{i={x:n.layout.end.PositionX-n.layout.start.PositionX,y:n.layout.end.PositionY-n.layout.start.PositionY};o=Math.sqrt(i.x*i.x+i.y*i.y);i.x/=o;i.y/=o;var b=o/2<Math.sqrt(i.x*i.x*t.relationshipBboxOffset*t.relationshipBboxOffset+i.y*i.y*t.relationshipBboxOffset*t.relationshipBboxOffset),s={x:n.layout.start.PositionX+i.x*t.relationshipBboxOffset,y:n.layout.start.PositionY+i.y*t.relationshipBboxOffset},h={x:n.layout.end.PositionX-i.x*t.relationshipBboxOffset,y:n.layout.end.PositionY-i.y*t.relationshipBboxOffset};u=b?r.line(h.x,h.y,s.x,s.y,{stroke:"#808080",strokeWidth:e+1,"marker-end":"url(#Activator)"}):r.line(s.x,s.y,h.x,h.y,{stroke:"#808080",strokeWidth:e+1,"marker-end":"url(#Activator)"})}return u!==undefined&&($(u).attr("onmouseover","BMA.SVGHelper.AddClass(this, 'modeldesigner-line-hover')"),$(u).attr("onmouseout","BMA.SVGHelper.RemoveClass(this, 'modeldesigner-line-hover')")),$(r.toSVG()).children()},function(i,r,u,f){var o,h,s;if(u.x!==f.x||u.y!==f.y)return(o=(i-u.x)*(f.x-u.x)+(r-u.y)*(f.y-u.y),o<0)?Math.sqrt(Math.pow(u.y-r,2)+Math.pow(u.x-i,2))<u.pixelWidth:(h=Math.pow(f.y-u.y,2)+Math.pow(f.x-u.x,2),h<=o)?Math.sqrt(Math.pow(f.y-r,2)+Math.pow(f.x-i,2))<u.pixelWidth:(s=Math.abs((f.y-u.y)*i-(f.x-u.x)*r+f.x*u.y-u.x*f.y),s/=Math.sqrt(Math.pow(f.y-u.y,2)+Math.pow(f.x-u.x,2)),s<u.pixelWidth);var l=u.x,a=u.y,c=t.variableWidthConstant*.7*.6,v=t.variableHeightConstant*.7*1.6,y=l+c,p=a,e=n.SVGHelper.GeEllipsePoints(y,p,c,v,i,r),w=Math.sqrt(Math.pow(e[0].x-i,2)+Math.pow(e[0].y-r,2)),b=Math.sqrt(Math.pow(e[1].x-i,2)+Math.pow(e[1].y-r,2));return w<u.pixelWidth||b<u.pixelWidth},"Activating Relationship","activate-icon"));this.elements.push(new i("Inhibitor",function(n){var r=t.svg,u,e,i,o;if(r===undefined)return undefined;if(r.clear(),u=undefined,e=t.lineWidth===0?1:t.lineWidth>0?t.lineWidth:1/Math.abs(t.lineWidth),n.layout.start.Id===n.layout.end.Id){var y=n.layout.start.PositionX,l=n.layout.start.PositionY,p=t.variableWidthConstant*.7,f=t.variableHeightConstant*.7,a=p*.6,c=f*1.6,v=a*(1-Math.sqrt(1-f*f/(c*c)))+y,w=r.createPath();u=r.path(w.move(v,l-f).arc(a,c,0,!0,!0,v,l+f),{fill:"none",stroke:"#808080",strokeWidth:e+1,"marker-end":"url(#Inhibitor)"})}else{i={x:n.layout.end.PositionX-n.layout.start.PositionX,y:n.layout.end.PositionY-n.layout.start.PositionY};o=Math.sqrt(i.x*i.x+i.y*i.y);i.x/=o;i.y/=o;var b=o/2<Math.sqrt(i.x*i.x*t.relationshipBboxOffset*t.relationshipBboxOffset+i.y*i.y*t.relationshipBboxOffset*t.relationshipBboxOffset),s={x:n.layout.start.PositionX+i.x*t.relationshipBboxOffset,y:n.layout.start.PositionY+i.y*t.relationshipBboxOffset},h={x:n.layout.end.PositionX-i.x*t.relationshipBboxOffset,y:n.layout.end.PositionY-i.y*t.relationshipBboxOffset};u=b?r.line(h.x,h.y,s.x,s.y,{stroke:"#808080",strokeWidth:e+1,"marker-end":"url(#Inhibitor)"}):r.line(s.x,s.y,h.x,h.y,{stroke:"#808080",strokeWidth:e+1,"marker-end":"url(#Inhibitor)"})}return u!==undefined&&($(u).attr("onmouseover","BMA.SVGHelper.AddClass(this, 'modeldesigner-line-hover')"),$(u).attr("onmouseout","BMA.SVGHelper.RemoveClass(this, 'modeldesigner-line-hover')")),$(r.toSVG()).children()},function(i,r,u,f){var o,h,s;if(u.x!==f.x||u.y!==f.y)return(o=(i-u.x)*(f.x-u.x)+(r-u.y)*(f.y-u.y),o<0)?Math.sqrt(Math.pow(u.y-r,2)+Math.pow(u.x-i,2))<u.pixelWidth:(h=Math.pow(f.y-u.y,2)+Math.pow(f.x-u.x,2),h<=o)?Math.sqrt(Math.pow(f.y-r,2)+Math.pow(f.x-i,2))<u.pixelWidth:(s=Math.abs((f.y-u.y)*i-(f.x-u.x)*r+f.x*u.y-u.x*f.y),s/=Math.sqrt(Math.pow(f.y-u.y,2)+Math.pow(f.x-u.x,2)),s<u.pixelWidth);var l=u.x,a=u.y,c=t.variableWidthConstant*.7*.6,v=t.variableHeightConstant*.7*1.6,y=l+c,p=a,e=n.SVGHelper.GeEllipsePoints(y,p,c,v,i,r),w=Math.sqrt(Math.pow(e[0].x-i,2)+Math.pow(e[0].y-r,2)),b=Math.sqrt(Math.pow(e[1].x-i,2)+Math.pow(e[1].y-r,2));return w<u.pixelWidth||b<u.pixelWidth},"Inhibiting Relationship","inhibit-icon"))}return Object.defineProperty(t.prototype,"LineWidth",{get:function(){return this.lineWidth},set:function(n){this.lineWidth=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LabelSize",{get:function(){return this.labelSize},set:function(n){this.labelSize=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"LabelVisibility",{get:function(){return this.labelVisibility},set:function(n){this.labelVisibility=n},enumerable:!0,configurable:!0}),t.prototype.CreateSvgElement=function(n,t){var r=document.createElementNS("http://www.w3.org/2000/svg",n),i="";return(t.x!=0||t.y!=0)&&(i+="translate("+t.x+","+t.y+")"),t.scale!==undefined&&t.scale!=1&&(i+="scale("+t.scale+","+t.scale+")"),i.length>0&&r.setAttribute("transform",i),r},t.prototype.CreateSvgPath=function(n,t,i,r,u){i===void 0&&(i=0);r===void 0&&(r=0);u===void 0&&(u=1);var f=this.CreateSvgElement("path",{x:i,y:r,scale:u});return f.setAttribute("d",n),f.setAttribute("fill",t),f},Object.defineProperty(t.prototype,"Elements",{get:function(){return this.elements},enumerable:!0,configurable:!0}),t.prototype.GetElementByType=function(n){for(var t=0;t<this.elements.length;t++)if(this.elements[t].Type===n)return this.elements[t];throw"the is no element for specified type";},t}();t.ElementsRegistry=f})(t=n.Elements||(n.Elements={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u){this.name=n;this.head=t;this.about=i;this.inserttext=r;this.offset=u}return Object.defineProperty(n.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Head",{get:function(){return this.head},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"About",{get:function(){return this.about},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"InsertText",{get:function(){return this.inserttext},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Offset",{get:function(){return this.offset},enumerable:!0,configurable:!0}),n}(),i;n.BMAFunction=t;i=function(){function n(){var n=this;this.functions=[];this.functions.push(new t("VAR","var(name)","A variable, where name is the name of the variable","var()",4));this.functions.push(new t("POS","pos(name)","","pos()",4));this.functions.push(new t("NEG","neg(name)","","neg()",4));this.functions.push(new t("AVG","avg(x,y,z)","The average of a list of expressions. E.g., avg( var(X); var(Y); 22; var(Z)*2 )","avg(,)",4));this.functions.push(new t("MIN","min(x,y)","The minimum of a two expressions. E.g., min( var(X), var(Y)), or min(var(X), 0)","min(,)",4));this.functions.push(new t("MAX","max(x,y)","The maximum of a two expressions. E.g., max( var(X), var(Y))","max(,)",4));this.functions.push(new t("CONST","22 or const(22)","An integer number. E.g., 1234, 42, -9","const()",6));this.functions.push(new t("+","x + y","Usual addition operator. E.g., 2+3, 44 + var(X)"," + ",3));this.functions.push(new t("-","x - y","Usual addition operator. E.g., 2-3, 44 - var(X)"," - ",3));this.functions.push(new t("*","x * y","Usual addition operator. E.g., 2*3, 44 * var(X)"," * ",3));this.functions.push(new t("/","x / y","Usual addition operator. E.g., 2/3, 44 / var(X)"," / ",3));this.functions.push(new t("CEIL","ceil(x)","The ceiling of an expression. E.g., ceil (var(X))","ceil()",5));this.functions.push(new t("FLOOR","floor(x)","The floor of an expression. E.g., floor(var(X))","floor()",6))}return Object.defineProperty(n.prototype,"Functions",{get:function(){return this.functions},enumerable:!0,configurable:!0}),n.prototype.GetFunctionByName=function(n){for(var t=0;t<this.functions.length;t++)if(this.functions[t].Name===n)return this.functions[t];throw"There is no function as you want";},n}();n.FunctionsRegistry=i})(t=n.Functions||(n.Functions={}))}(BMA||(BMA={})),function(n){var t=function(){function t(n){this.messagebox=n}return t.prototype.IsInRepo=function(n){return window.localStorage.getItem(n)!==null},t.prototype.Save=function(n,t){try{window.localStorage.setItem(n,t);window.Commands.Execute("LocalStorageChanged",{})}catch(i){i==="QUOTA_EXCEEDED_ERR"&&this.messagebox.Show("Error: Local repository is full")}},t.prototype.ParseItem=function(t){try{var i=JSON.parse(t);return n.Model.ImportModelAndLayout(i),!0}catch(r){return!1}},t.prototype.SaveModel=function(n,t){window.localStorage.getItem(n)!==null?confirm("Overwrite the file?")&&this.Save("user."+n,JSON.stringify(t)):this.Save("user."+n,JSON.stringify(t))},t.prototype.RemoveModel=function(n){window.localStorage.removeItem(n);window.Commands.Execute("LocalStorageChanged",{})},t.prototype.LoadModel=function(t){var r=window.localStorage.getItem(t),i;if(r!==null)try{return i=new n.Model.AppModel,i.Deserialize(r),JSON.parse(i.Serialize())}catch(u){alert(u)}else return null},t.prototype.GetModelList=function(){for(var t,i,u,r=[],n=0;n<window.localStorage.length;n++)t=window.localStorage.key(n),i=this.IsUserKey(t),i!==undefined&&(u=window.localStorage.getItem(t),this.ParseItem(u)&&r.push(i));return r},t.prototype.IsUserKey=function(n){var i=n.split("."),t,r;if(i[0]==="user"){for(t=i[1],r=2;r<i.length;r++)t=t.concat("."),t=t.concat(i[r]);return t}return undefined},t}();n.LocalRepositoryTool=t}(BMA||(BMA={})),function(n){var t=function(){function t(){this.currentModel=new n.Model.AppModel}return t.prototype.Snapshot=function(n){this.currentModel.Deserialize(n.Serialize())},t.prototype.IsChanged=function(n){return this.currentModel.Serialize()!==n.Serialize()},t}();n.ChangesChecker=t}(BMA||(BMA={})),function(n){var t;(function(t){var h=function(){function t(n,t,i){this.name=n;this.variables=t;this.relationships=i}return Object.defineProperty(t.prototype,"Name",{get:function(){return this.name},set:function(n){this.name=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Variables",{get:function(){return this.variables.slice(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Relationships",{get:function(){return this.relationships.slice(0)},enumerable:!0,configurable:!0}),t.prototype.Clone=function(){return new t(this.Name,this.variables.slice(0),this.relationships.slice(0))},t.prototype.SetVariableProperties=function(t,i,r,u,f){for(var e=0;e<this.variables.length;e++)if(this.variables[e].Id===t){this.variables[e]=new n.Model.Variable(this.variables[e].Id,this.variables[e].ContainerId,this.variables[e].Type,i===undefined?this.variables[e].Name:i,isNaN(r)?this.variables[e].RangeFrom:r,isNaN(u)?this.variables[e].RangeTo:u,f===undefined?this.variables[e].Formula:f);return}},t.prototype.GetVariableById=function(n){for(var t=0;t<this.variables.length;t++)if(this.variables[t].Id===n)return this.variables[t];return undefined},t.prototype.GetJSON=function(){for(var t,i=[],n=0;n<this.variables.length;n++)i.push(this.variables[n].GetJSON());for(t=[],n=0;n<this.relationships.length;n++)t.push(this.relationships[n].GetJSON());return{ModelName:this.name,Engine:"VMCAI",Variables:i,Relationships:t}},t}(),i,r,u,f,e,o,s;t.BioModel=h;i=function(){function n(){}return Object.defineProperty(n,"Default",{get:function(){return"Default"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Constant",{get:function(){return"Constant"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"MembraneReceptor",{get:function(){return"MembraneReceptor"},enumerable:!0,configurable:!0}),n}();t.VariableTypes=i;r=function(){function n(n,t,i,r,u,f,e){this.id=n;this.containerId=t;this.type=i;this.rangeFrom=u;this.rangeTo=f;this.formula=e;this.name=r}return Object.defineProperty(n.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ContainerId",{get:function(){return this.containerId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"RangeFrom",{get:function(){return this.rangeFrom},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"RangeTo",{get:function(){return this.rangeTo},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Formula",{get:function(){return this.formula},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Name",{get:function(){return this.name},enumerable:!0,configurable:!0}),n.prototype.GetJSON=function(){return{Id:this.id,Name:this.name,RangeFrom:this.rangeFrom,RangeTo:this.rangeTo,formula:this.formula}},n}();t.Variable=r;u=function(){function n(){}return Object.defineProperty(n,"Activator",{get:function(){return"Activator"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"Inhibitor",{get:function(){return"Inhibitor"},enumerable:!0,configurable:!0}),n}();t.RelationshipTypes=u;f=function(){function n(n,t,i,r){this.id=n;this.fromVariableId=t;this.toVariableId=i;this.type=r}return Object.defineProperty(n.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"FromVariableId",{get:function(){return this.fromVariableId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"ToVariableId",{get:function(){return this.toVariableId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Type",{get:function(){return this.type},enumerable:!0,configurable:!0}),n.prototype.GetJSON=function(){return{Id:this.id,FromVariableId:this.fromVariableId,ToVariableId:this.toVariableId,Type:this.type}},n}();t.Relationship=f;e=function(){function n(n,t){this.containers=n;this.variables=t}return Object.defineProperty(n.prototype,"Containers",{get:function(){return this.containers.slice(0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Variables",{get:function(){return this.variables.slice(0)},enumerable:!0,configurable:!0}),n.prototype.Clone=function(){return new n(this.containers.slice(0),this.variables.slice(0))},n.prototype.GetVariableById=function(n){for(var t=0;t<this.variables.length;t++)if(this.variables[t].Id===n)return this.variables[t];return undefined},n.prototype.GetContainerById=function(n){for(var t=0;t<this.containers.length;t++)if(this.containers[t].Id===n)return this.containers[t];return undefined},n}();t.Layout=e;o=function(){function n(n,t,i,r,u){this.id=n;this.name=t;this.size=i;this.positionX=r;this.positionY=u}return Object.defineProperty(n.prototype,"Name",{get:function(){return this.name},set:function(n){this.name=n},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Size",{get:function(){return this.size},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PositionX",{get:function(){return this.positionX},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PositionY",{get:function(){return this.positionY},enumerable:!0,configurable:!0}),n}();t.ContainerLayout=o;s=function(){function n(n,t,i,r,u,f){this.id=n;this.positionX=t;this.positionY=i;this.cellX=r;this.cellY=u;this.angle=f}return Object.defineProperty(n.prototype,"Id",{get:function(){return this.id},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PositionX",{get:function(){return this.positionX},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"PositionY",{get:function(){return this.positionY},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CellX",{get:function(){return this.cellX},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CellY",{get:function(){return this.cellY},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Angle",{get:function(){return this.angle},enumerable:!0,configurable:!0}),n}();t.VariableLayout=s})(t=n.Model||(n.Model={}))}(BMA||(BMA={})),function(n){var t;(function(t){var i=function(){function t(){this.proofResult=undefined;this.model=new n.Model.BioModel("model 1",[],[]);this.layout=new n.Model.Layout([],[])}return Object.defineProperty(t.prototype,"BioModel",{get:function(){return this.model},set:function(n){this.model=n;window.Commands.Execute("AppModelChanged",{})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Layout",{get:function(){return this.layout},set:function(n){this.layout=n},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ProofResult",{get:function(){return this.proofResult},set:function(n){this.proofResult=n},enumerable:!0,configurable:!0}),t.prototype.DeserializeLegacyJSON=function(t){var i,u,f,e,o,r;if(t!==undefined&&t!==null){if(i=JSON.parse(t),i===undefined||i.model===undefined||i.layout===undefined||i.model.variables===undefined||i.layout.variables===undefined||i.model.variables.length!==i.layout.variables.length||i.layout.containers===undefined||i.model.relationships===undefined){console.log("Invalid model");return}for(u=[],r=0;r<i.model.variables.length;r++)u.push(new n.Model.Variable(i.model.variables[r].id,i.model.variables[r].containerId,i.model.variables[r].type,i.model.variables[r].name,i.model.variables[r].rangeFrom,i.model.variables[r].rangeTo,i.model.variables[r].formula));for(f=[],r=0;r<i.layout.variables.length;r++)f.push(new n.Model.VariableLayout(i.layout.variables[r].id,i.layout.variables[r].positionX,i.layout.variables[r].positionY,i.layout.variables[r].cellX,i.layout.variables[r].cellY,i.layout.variables[r].angle));for(e=[],r=0;r<i.model.relationships.length;r++)e.push(new n.Model.Relationship(i.model.relationships[r].id,i.model.relationships[r].fromVariableId,i.model.relationships[r].toVariableId,i.model.relationships[r].type));for(o=[],r=0;r<i.layout.containers.length;r++)o.push(new n.Model.ContainerLayout(i.layout.containers[r].id,i.layout.containers[r].name,i.layout.containers[r].size,i.layout.containers[r].positionX,i.layout.containers[r].positionY));this.model=new n.Model.BioModel(i.model.name,u,e);this.layout=new n.Model.Layout(o,f)}else this.model=new n.Model.BioModel("model 1",[],[]),this.layout=new n.Model.Layout([],[]);this.proofResult=undefined;window.Commands.Execute("ModelReset",undefined)},t.prototype.Deserialize=function(t){if(t!==undefined&&t!==null){var i=n.Model.ImportModelAndLayout(JSON.parse(t));this.model=i.Model;this.layout=i.Layout}else this.model=new n.Model.BioModel("model 1",[],[]),this.layout=new n.Model.Layout([],[]);this.proofResult=undefined;window.Commands.Execute("ModelReset",undefined)},t.prototype.Reset=function(n,t){this.model=n;this.layout=t;window.Commands.Execute("ModelReset",undefined)},t.prototype.Serialize=function(){return JSON.stringify(n.Model.ExportModelAndLayout(this.model,this.layout))},t}();t.AppModel=i})(t=n.Model||(n.Model={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){this.isStable=n;this.time=t;this.ticks=i}return Object.defineProperty(n.prototype,"IsStable",{get:function(){return this.isStable},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Time",{get:function(){return this.time},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"Ticks",{get:function(){return this.ticks},enumerable:!0,configurable:!0}),n}();n.ProofResult=t})(t=n.Model||(n.Model={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(){this.lineWidth=10;this.textLabelSize=10;this.gridVisibility=!0;this.textLabelVisibility=!0;this.iconsVisibility=!0;this.iconsSize=10}return Object.defineProperty(n.prototype,"LineWidth",{get:function(){return this.lineWidth},set:function(n){this.lineWidth=n;window.Commands.Execute("AppCommands.ChangeLineWidth",this.lineWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"TextLabelSize",{get:function(){return this.textLabelSize},set:function(n){this.textLabelSize=n;window.Commands.Execute("AppCommands.ChangeTextLabelSize",this.textLabelSize)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"GridVisibility",{get:function(){return this.gridVisibility},set:function(n){this.gridVisibility=n;window.Commands.Execute("AppCommands.ToggleGridVisibility",this.gridVisibility)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"TextLabelVisibility",{get:function(){return this.textLabelVisibility},set:function(n){this.textLabelVisibility=n;window.Commands.Execute("AppCommands.ToggleTextLabelVisibility",this.textLabelVisibility)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"IconsVisibility",{get:function(){return this.iconsVisibility},set:function(n){this.iconsVisibility=n;window.Commands.Execute("AppCommands.ToggleIconsVisibility",this.iconsVisibility)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"IconsSize",{get:function(){return this.iconsSize},set:function(n){this.iconsSize=n;window.Commands.Execute("AppCommands.ChangeIconsSize",this.iconsSize)},enumerable:!0,configurable:!0}),n}();n.AppVisualSettings=t})(t=n.Model||(n.Model={}))}(BMA||(BMA={})),function(n){var t;(function(n){function t(n,t){var u={},f,s,r,e,i,o,h;if(n!==undefined&&n!=null){if(n=n.trim(),n.toLowerCase()=="avg(pos)-avg(neg)")return null;for(f="var(",s=0;(r=n.indexOf(f,s))>=0;){if(e=n.indexOf(")",r),e<0)break;i=n.substring(r+f.length,e);u[i]=u[i]===undefined?0:u[i]+1;o=t(i);h=undefined;h=o instanceof Array?o[u[i]]:o;n=n.substring(0,r+f.length)+h+n.substr(e);s=r+1}}return n}function i(n){function i(t,i){var r=n.Variables.filter(function(r){return r.Name==i&&n.Relationships.some(function(n){return n.ToVariableId==t&&n.FromVariableId==r.Id})}),u;if(r.length==0)throw new Error("Unknown variable "+i+" in formula for variable id = "+t);return u=[],u.concat(r.map(function(n){return n.Id.toString()}))}return{Name:n.Name,Variables:n.Variables.map(function(n){return{Id:n.Id,RangeFrom:n.RangeFrom,RangeTo:n.RangeTo,Formula:t(n.Formula,function(t){return i(n.Id,t)})}}),Relationships:n.Relationships.map(function(n){return{Id:n.Id,FromVariable:n.FromVariableId,ToVariable:n.ToVariableId,Type:n.Type}})}}function r(n,t){return{Model:i(n),Layout:{Variables:t.Variables.map(function(t){var i=n.GetVariableById(t.Id);return{Id:t.Id,Name:i.Name,Type:i.Type,ContainerId:i.ContainerId,PositionX:t.PositionX,PositionY:t.PositionY,CellX:t.CellX,CellY:t.CellY,Angle:t.Angle}}),Containers:t.Containers.map(function(n){return{Id:n.Id,Name:n.Name,Size:n.Size,PositionX:n.PositionX,PositionY:n.PositionY}})}}}function u(i){var r={};return i.Layout.Variables.forEach(function(n){r[n.Id]=n}),{Model:new n.BioModel(i.Model.Name,i.Model.Variables.map(function(i){return new n.Variable(i.Id,r[i.Id].ContainerId,r[i.Id].Type,r[i.Id].Name,i.RangeFrom,i.RangeTo,t(i.Formula,function(n){return r[parseInt(n)].Name}))}),i.Model.Relationships.map(function(t){return new n.Relationship(t.Id,t.FromVariable,t.ToVariable,t.Type)})),Layout:new n.Layout(i.Layout.Containers.map(function(t){return new n.ContainerLayout(t.Id,t.Name,t.Size,t.PositionX,t.PositionY)}),i.Layout.Variables.map(function(t){return new n.VariableLayout(t.Id,t.PositionX,t.PositionY,t.CellX,t.CellY,t.Angle)}))}}n.MapVariableNames=t;n.ExportBioModel=i;n.ExportModelAndLayout=r;n.ImportModelAndLayout=u})(t=n.Model||(n.Model={}))}(BMA||(BMA={})),function(n){var t;(function(n){var d=function(){function n(n){this.svgPlotDiv=n}return n.prototype.Draw=function(n){this.svgPlotDiv.drawingsurface({svg:n})},n.prototype.DrawLayer2=function(n){this.svgPlotDiv.drawingsurface({lightSvg:n})},n.prototype.TurnNavigation=function(n){this.svgPlotDiv.drawingsurface({isNavigationEnabled:n})},n.prototype.SetGrid=function(n,t,i,r){this.svgPlotDiv.drawingsurface({grid:{x0:n,y0:t,xStep:i,yStep:r}})},n.prototype.GetDragSubject=function(){return this.svgPlotDiv.drawingsurface("getDragSubject")},n.prototype.SetZoom=function(n){this.svgPlotDiv.drawingsurface({zoom:n})},n.prototype.GetPlotX=function(n){return this.svgPlotDiv.drawingsurface("getPlotX",n)},n.prototype.GetPlotY=function(n){return this.svgPlotDiv.drawingsurface("getPlotY",n)},n.prototype.GetPixelWidth=function(){return this.svgPlotDiv.drawingsurface("getPixelWidth")},n.prototype.SetGridVisibility=function(n){this.svgPlotDiv.drawingsurface({gridVisibility:n})},n.prototype.HighlightAreas=function(n){this.svgPlotDiv.drawingsurface({rects:n})},n.prototype.SetCenter=function(n,t){this.svgPlotDiv.drawingsurface("setCenter",{x:n,y:t})},n.prototype.SetVisibleRect=function(n){this.svgPlotDiv.drawingsurface({visibleRect:n})},n}(),t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k;n.SVGPlotDriver=d;t=function(){function n(n){this.button=n}return n.prototype.Turn=function(n){this.button.button("option","disabled",!n)},n}();n.TurnableButtonDriver=t;i=function(){function n(n){this.variableEditor=n;this.variableEditor.bmaeditor();this.variableEditor.hide();this.variableEditor.click(function(n){n.stopPropagation()})}return n.prototype.GetVariableProperties=function(){return{name:this.variableEditor.bmaeditor("option","name"),formula:this.variableEditor.bmaeditor("option","formula"),rangeFrom:this.variableEditor.bmaeditor("option","rangeFrom"),rangeTo:this.variableEditor.bmaeditor("option","rangeTo")}},n.prototype.SetValidation=function(n,t){this.variableEditor.bmaeditor("SetValidation",n,t)},n.prototype.Initialize=function(n,t){var r,f,i,u;for(this.variableEditor.bmaeditor("option","name",n.Name),r=[],f=n.Id,i=0;i<t.Relationships.length;i++)u=t.Relationships[i],u.ToVariableId===f&&r.push(t.GetVariableById(u.FromVariableId).Name);this.variableEditor.bmaeditor("option","inputs",r);this.variableEditor.bmaeditor("option","formula",n.Formula);this.variableEditor.bmaeditor("option","rangeFrom",n.RangeFrom);this.variableEditor.bmaeditor("option","rangeTo",n.RangeTo)},n.prototype.Show=function(n,t){this.variableEditor.show();this.variableEditor.css("left",n).css("top",t)},n.prototype.Hide=function(){this.variableEditor.hide()},n}();n.VariableEditorDriver=i;r=function(){function n(n){this.containerEditor=n;this.containerEditor.containernameeditor();this.containerEditor.hide();this.containerEditor.click(function(n){n.stopPropagation()})}return n.prototype.GetContainerName=function(){return this.containerEditor.containernameeditor("option","name")},n.prototype.Initialize=function(n){this.containerEditor.containernameeditor("option","name",n.Name)},n.prototype.Show=function(n,t){this.containerEditor.show();this.containerEditor.css("left",n).css("top",t)},n.prototype.Hide=function(){this.containerEditor.hide()},n}();n.ContainerEditorDriver=r;u=function(){function n(n,t){this.proofAccordion=n;this.proofContentViewer=t}return n.prototype.SetData=function(n){n!==undefined&&this.proofContentViewer.proofresultviewer(n)},n.prototype.ShowResult=function(){this.proofAccordion.bmaaccordion({contentLoaded:{ind:"#icon1",val:!0}})},n.prototype.OnProofStarted=function(){this.proofAccordion.bmaaccordion({contentLoaded:{ind:"#icon1",val:!1}})},n.prototype.OnProofFailed=function(){$("#icon1").click()},n.prototype.Show=function(n){this.proofContentViewer.proofresultviewer("show",n.tab)},n.prototype.Hide=function(n){this.proofContentViewer.proofresultviewer("hide",n.tab)},n}();n.ProofViewer=u;f=function(){function n(n){this.viewer=n}return n.prototype.GetViewer=function(){return this.viewer},n.prototype.ShowStartFurtherTestingToggler=function(){this.viewer.furthertesting("ShowStartToggler")},n.prototype.HideStartFurtherTestingToggler=function(){this.viewer.furthertesting("HideStartToggler")},n.prototype.ShowResults=function(n){n!==undefined?this.viewer.furthertesting("SetData",{tabLabels:n.tabLabels,tableHeaders:n.tableHeaders,data:n.data}):this.viewer.furthertesting("SetData",undefined)},n.prototype.HideResults=function(){this.viewer.furthertesting({data:null})},n.prototype.StandbyMode=function(){this.viewer.furthertesting({buttonMode:"StandbyMode"})},n.prototype.ActiveMode=function(){this.viewer.furthertesting({buttonMode:"ActiveMode"})},n}();n.FurtherTestingDriver=f;e=function(){function n(n){this.popupWindow=n}return n.prototype.Seen=function(){return!this.popupWindow.is(":hidden")},n.prototype.Show=function(n){var i=this,t="";this.popupWindow.removeClass("further-testing-popout").removeClass("proof-propagation-popout").removeClass("proof-variables-popout").removeClass("simulation-popout");switch(n.tab){case"ProofVariables":t="Variables";this.popupWindow.addClass("proof-variables-popout");break;case"ProofPropagation":t="Proof Progression";this.popupWindow.addClass("proof-propagation-popout");break;case"SimulationVariables":t="Simulation Progression";this.popupWindow.addClass("simulation-popout");break;case"FurtherTesting":t="Further Testing";this.popupWindow.addClass("further-testing-popout");break;case"SimulationPlot":t="Simulation Graph"}this.popupWindow.resultswindowviewer({header:t,tabid:n.tab,content:n.content,icon:"min"});popup_position();this.popupWindow.show()},n.prototype.Hide=function(){this.popupWindow.hide()},n.prototype.Collapse=function(){window.Commands.Execute("Collapse",this.popupWindow.resultswindowviewer("option","tabid"))},n}();n.PopupDriver=e;o=function(){function n(n){this.viewer=n}return n.prototype.Set=function(n){var t=this.CreateExpandedTable(n.variables,n.colors),i=this.CreateInterval(n.variables);this.viewer.simulationexpanded({variables:t,init:n.init,interval:i,data:undefined})},n.prototype.SetData=function(n){var t=this.CreatePlotView(n);this.viewer.simulationexpanded("option","data",t)},n.prototype.GetViewer=function(){return this.viewer},n.prototype.StandbyMode=function(){this.viewer.simulationexpanded({buttonMode:"StandbyMode"})},n.prototype.ActiveMode=function(){this.viewer.simulationexpanded({buttonMode:"ActiveMode"})},n.prototype.AddResult=function(n){var t=this.ConvertResult(n);this.viewer.simulationexpanded("AddResult",t)},n.prototype.CreatePlotView=function(n){for(var i,r=[],t=1;t<n[0].Plot.length;t++)for(r[t-1]=[],i=0;i<n.length;i++)r[t-1][i]=n[i].Plot[t];return r},n.prototype.CreateInterval=function(n){for(var i=[],t=0;t<n.length;t++)i[t]=[],i[t][0]=n[t].RangeFrom,i[t][1]=n[t].RangeTo;return i},n.prototype.ConvertResult=function(n){var i=[],t;for(n.Variables!==undefined&&n.Variables!==null&&(i=[]),t=0;t<n.Variables.length;t++)i[t]=n.Variables[t].Value;return i},n.prototype.findColorById=function(n,t){for(var i=0;i<n.length;i++)if(t===n[i].Id)return n[i];return undefined},n.prototype.CreateExpandedTable=function(n,t){for(var r=[],i=0;i<n.length;i++)r[i]=[],r[i][0]=this.findColorById(t,n[i].Id).Color,r[i][1]=this.findColorById(t,n[i].Id).Seen,r[i][2]=n[i].Name,r[i][3]=n[i].RangeFrom,r[i][4]=n[i].RangeTo;return r},n}();n.SimulationExpandedDriver=o;s=function(){function n(n){this.viewer=n}return n.prototype.ChangeVisibility=function(n){this.viewer.simulationviewer("ChangeVisibility",n.ind,n.check)},n.prototype.SetData=function(n){this.viewer.simulationviewer(n)},n.prototype.Show=function(n){this.viewer.simulationviewer("show",n.tab)},n.prototype.Hide=function(n){this.viewer.simulationviewer("hide",n.tab)},n}();n.SimulationViewerDriver=s;h=function(){function n(n){this.widget=n}return n.prototype.AddItem=function(n){this.widget.localstoragewidget("AddItem",n)},n.prototype.Show=function(){this.widget.show()},n.prototype.Hide=function(){this.widget.hide()},n.prototype.SetItems=function(n){this.widget.localstoragewidget({items:n})},n.prototype.Message=function(n){this.widget.localstoragewidget("Message",n)},n}();n.LocalStorageDriver=h;c=function(){function n(n){this.currentPromise=undefined;var t=this;this.fileInput=n;n.change(function(i){var r=i;r.target.files!==undefined&&r.target.files.length==1&&t.currentPromise!==undefined&&(t.currentPromise.resolve(r.target.files[0]),t.currentPromise=undefined,n.val(""))})}return n.prototype.OpenFileDialog=function(){var n=$.Deferred();return this.currentPromise=n,this.fileInput.click(),n.promise()},n.prototype.OnCheckFileSelected=function(){return!1},n}();n.ModelFileLoader=c;l=function(){function n(n){this.contextMenu=n}return n.prototype.EnableMenuItems=function(n){for(var t=0;t<n.length;t++)this.contextMenu.contextmenu("enableEntry",n[t].name,n[t].isEnabled)},n.prototype.ShowMenuItems=function(n){for(var t=0;t<n.length;t++)this.contextMenu.contextmenu("showEntry",n[t].name,n[t].isVisible)},n.prototype.GetMenuItems=function(){return[]},n}();n.ContextMenuDriver=l;a=function(){function n(n){this.acc=n}return n.prototype.Hide=function(){var n=this.acc.children().filter('[aria-selected="true"]').trigger("click")},n}();n.AccordionHider=a;v=function(){function n(){}return n.prototype.Invoke=function(n){return $.ajax({type:"POST",url:"api/Validate",data:JSON.stringify(n),contentType:"application/json",dataType:"json"})},n}();n.FormulaValidationService=v;y=function(){function n(){}return n.prototype.Invoke=function(n){return $.ajax({type:"POST",url:"api/FurtherTesting",data:JSON.stringify(n),contentType:"application/json",dataType:"json"})},n}();n.FurtherTestingService=y;p=function(){function n(){}return n.prototype.Invoke=function(n){return $.ajax({type:"POST",url:"api/Analyze",data:JSON.stringify(n),contentType:"application/json",dataType:"json"})},n}();n.ProofAnalyzeService=p;w=function(){function n(){}return n.prototype.Invoke=function(n){return $.ajax({type:"POST",url:"api/Simulate",data:JSON.stringify(n),contentType:"application/json",dataType:"json"})},n}();n.SimulationService=w;b=function(){function n(){}return n.prototype.Show=function(n){alert(n)},n.prototype.Log=function(n){console.log(n)},n}();n.MessageBoxDriver=b;k=function(){function n(){}return n.prototype.Export=function(n,t,i){var r=saveTextAs(n,t+"."+i)},n}();n.ExportService=k})(t=n.UIDrivers||(n.UIDrivers={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(n,t,i){var r=this,u;this.currentModelIndex=-1;u=this;this.appModel=n;this.undoButton=t;this.redoButton=i;window.Commands.On("Undo",function(){r.Undo()});window.Commands.On("Redo",function(){r.Redo()});window.Commands.On("ModelReset",function(){r.Set(r.appModel.BioModel,r.appModel.Layout)});this.Set(this.appModel.BioModel,this.appModel.Layout)}return n.prototype.OnModelUpdated=function(n){this.undoButton.Turn(this.CanUndo);this.redoButton.Turn(this.CanRedo);this.appModel.BioModel=this.Current.model;this.appModel.Layout=this.Current.layout;window.Commands.Execute("DrawingSurfaceRefreshOutput",{status:n})},n.prototype.Undo=function(){this.CanUndo&&(--this.currentModelIndex,this.OnModelUpdated("Undo"))},n.prototype.Redo=function(){this.CanRedo&&(++this.currentModelIndex,this.OnModelUpdated("Redo"))},n.prototype.Truncate=function(){this.models.length=this.currentModelIndex+1},n.prototype.Dup=function(n,t){this.Truncate();var i=this.Current;this.models[this.currentModelIndex]={model:i.model.Clone(),layout:i.layout.Clone()};this.models.push({model:n,layout:t});++this.currentModelIndex;this.OnModelUpdated("Dup")},Object.defineProperty(n.prototype,"CanUndo",{get:function(){return this.currentModelIndex>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"CanRedo",{get:function(){return this.currentModelIndex<this.models.length-1},enumerable:!0,configurable:!0}),n.prototype.Set=function(n,t){this.models=[{model:n,layout:t}];this.currentModelIndex=0;this.OnModelUpdated("Set")},Object.defineProperty(n.prototype,"Current",{get:function(){return this.models[this.currentModelIndex]},enumerable:!0,configurable:!0}),n}();n.UndoRedoPresenter=t})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f,e,o,s,h){var l=this,c,v,a;this.xOrigin=0;this.yOrigin=0;this.xStep=250;this.yStep=280;this.variableIndex=1;this.stagingLine=undefined;this.stagingGroup=undefined;this.stagingVariable=undefined;this.stagingContainer=undefined;this.editingId=undefined;c=this;this.appModel=t;this.undoRedoPresenter=i;this.driver=r;this.navigationDriver=u;this.variableEditor=e;this.containerEditor=o;this.contextMenu=s;this.exportservice=h;r.SetGrid(this.xOrigin,this.yOrigin,this.xStep,this.yStep);window.Commands.On("SaveSVG",function(){c.exportservice.Export(c.svg.toSVG(),t.BioModel.Name,"svg")});window.Commands.On("AddElementSelect",function(n){c.selectedType=n;c.navigationDriver.TurnNavigation(n===undefined);c.stagingLine=undefined});window.Commands.On("DrawingSurfaceClick",function(n){var t,i;c.selectedType!==undefined?c.TryAddVariable(n.x,n.y,c.selectedType,undefined):(t=c.GetVariableAtPosition(n.x,n.y),t!==undefined?(c.editingId=t,c.variableEditor.Initialize(c.GetVariableById(c.undoRedoPresenter.Current.layout,c.undoRedoPresenter.Current.model,t).model,c.undoRedoPresenter.Current.model),c.variableEditor.Show(n.screenX,n.screenY),window.Commands.Execute("DrawingSurfaceVariableEditorOpened",undefined),c.RefreshOutput()):(i=c.GetContainerAtPosition(n.x,n.y),i!==undefined&&(c.editingId=i,c.containerEditor.Initialize(c.undoRedoPresenter.Current.layout.GetContainerById(i)),c.containerEditor.Show(n.screenX,n.screenY),window.Commands.Execute("DrawingSurfaceContainerEditorOpened",undefined),c.RefreshOutput())))});window.Commands.On("VariableEdited",function(){var i=l,n,t;if(i.editingId!==undefined){var u=l.undoRedoPresenter.Current.model,r=u.Variables,f=-1;for(n=0;n<r.length;n++)if(r[n].Id===i.editingId){f=n;break}f!==-1&&(t=i.variableEditor.GetVariableProperties(),u.SetVariableProperties(r[n].Id,t.name,t.rangeFrom,t.rangeTo,t.formula),i.RefreshOutput())}});window.Commands.On("ContainerNameEdited",function(){var n=l,i,t;n.editingId!==undefined&&(i=l.undoRedoPresenter.Current.layout,t=i.GetContainerById(n.editingId),t!==undefined&&(t.Name=n.containerEditor.GetContainerName(),n.RefreshOutput()))});window.Commands.On("DrawingSurfaceContextMenuOpening",function(n){var r=c.driver.GetPlotX(n.left),u=c.driver.GetPlotY(n.top),i=c.GetVariableAtPosition(r,u),t=c.GetContainerAtPosition(r,u),e=c.GetRelationshipAtPosition(r,u,3*c.driver.GetPixelWidth()),h=t!==undefined?c.undoRedoPresenter.Current.layout.GetContainerById(t).Size:undefined,f=c.clipboard!==undefined,s,o;f===!0&&(c.clipboard.Container!==undefined?f=c.CanAddContainer(r,u,c.clipboard.Container.Size):(s=c.clipboard.Variables[0],f=c.CanAddVariable(r,u,s.m.Type,undefined)));o=!0;f!==!0&&i===undefined&&t===undefined&&e===undefined&&(f=!0,o=!1);c.contextMenu.ShowMenuItems([{name:"Cut",isVisible:i!==undefined||t!==undefined},{name:"Copy",isVisible:i!==undefined||t!==undefined},{name:"Paste",isVisible:f},{name:"Delete",isVisible:i!==undefined||t!==undefined||e!==undefined},{name:"Size",isVisible:t!==undefined},{name:"ResizeCellTo1x1",isVisible:!0},{name:"ResizeCellTo2x2",isVisible:!0},{name:"ResizeCellTo3x3",isVisible:!0},{name:"Edit",isVisible:i!==undefined||t!==undefined}]);c.contextMenu.EnableMenuItems([{name:"Paste",isEnabled:o}]);c.contextElement={x:r,y:u,screenX:n.left,screenY:n.top};i!==undefined?(c.contextElement.id=i,c.contextElement.type="variable"):t!==undefined?(c.contextElement.id=t,c.contextElement.type="container"):e!==undefined&&(c.contextElement.id=e,c.contextElement.type="relationship")});window.Commands.On("DrawingSurfaceDelete",function(){c.contextElement!==undefined&&(c.contextElement.type==="variable"?c.RemoveVariable(c.contextElement.id):c.contextElement.type==="relationship"?c.RemoveRelationship(c.contextElement.id):c.contextElement.type==="container"&&c.RemoveContainer(c.contextElement.id),c.contextElement=undefined)});window.Commands.On("DrawingSurfaceCopy",function(){c.CopyToClipboard(!1)});window.Commands.On("DrawingSurfaceCut",function(){c.CopyToClipboard(!0)});window.Commands.On("DrawingSurfacePaste",function(){var p,w,t,u,g,nt,i,l,a,v;if(c.clipboard!==undefined)if(c.clipboard.Container!==undefined){var r=c.undoRedoPresenter.Current.model,f=c.undoRedoPresenter.Current.layout,y={},e=c.clipboard.Container,o=r.Variables.slice(0),s=f.Variables.slice(0),b=f.Containers.slice(0),k=r.Relationships.slice(0),d=c.variableIndex++,h=c.GetGridCell(c.contextElement.x,c.contextElement.y);for(b.push(new n.Model.ContainerLayout(d,e.Name,e.Size,h.x,h.y)),p={x:e.PositionX*c.Grid.xStep+c.Grid.x0,y:e.PositionY*c.Grid.yStep+c.Grid.y0},w={x:h.x*c.Grid.xStep+c.Grid.x0,y:h.y*c.Grid.yStep+c.Grid.y0},i=0;i<c.clipboard.Variables.length;i++)t=c.clipboard.Variables[i].m,u=c.clipboard.Variables[i].l,y[t.Id]=c.variableIndex,g=u.PositionX-p.x,nt=u.PositionY-p.y,o.push(new n.Model.Variable(c.variableIndex,d,t.Type,t.Name,t.RangeFrom,t.RangeTo,t.Formula)),s.push(new n.Model.VariableLayout(c.variableIndex++,w.x+g,w.y+nt,0,0,u.Angle));for(i=0;i<c.clipboard.Realtionships.length;i++)l=c.clipboard.Realtionships[i],k.push(new n.Model.Relationship(c.variableIndex++,y[l.FromVariableId],y[l.ToVariableId],l.Type));a=new n.Model.BioModel(r.Name,o,k);v=new n.Model.Layout(b,s);c.undoRedoPresenter.Dup(a,v)}else{var t=c.clipboard.Variables[0].m,u=c.clipboard.Variables[0].l,r=c.undoRedoPresenter.Current.model,f=c.undoRedoPresenter.Current.layout,o=r.Variables.slice(0),s=f.Variables.slice(0);o.push(new n.Model.Variable(c.variableIndex,t.ContainerId,t.Type,t.Name,t.RangeFrom,t.RangeTo,t.Formula));s.push(new n.Model.VariableLayout(c.variableIndex++,c.contextElement.x,c.contextElement.y,0,0,u.Angle));a=new n.Model.BioModel(r.Name,o,r.Relationships);v=new n.Model.Layout(f.Containers,s);c.undoRedoPresenter.Dup(a,v)}});window.Commands.On("DrawingSurfaceResizeCell",function(t){if(c.contextElement!==undefined&&c.contextElement.type==="container"){var r=n.ModelHelper.ResizeContainer(i.Current.model,i.Current.layout,c.contextElement.id,t.size,{xOrigin:c.xOrigin,yOrigin:c.yOrigin,xStep:c.xStep,yStep:c.yStep});l.undoRedoPresenter.Dup(r.model,r.layout)}});window.Commands.On("DrawingSurfaceEdit",function(){var n;c.contextElement!==undefined&&c.contextElement.type==="variable"?(n=c.contextElement.id,c.editingId=n,c.variableEditor.Initialize(c.GetVariableById(c.undoRedoPresenter.Current.layout,c.undoRedoPresenter.Current.model,n).model,c.undoRedoPresenter.Current.model),c.variableEditor.Show(c.contextElement.screenX,c.contextElement.screenY),window.Commands.Execute("DrawingSurfaceVariableEditorOpened",undefined),c.RefreshOutput()):c.contextElement!==undefined&&c.contextElement.type==="container"&&(n=c.contextElement.id,c.editingId=n,c.containerEditor.Initialize(c.undoRedoPresenter.Current.layout.GetContainerById(n)),c.containerEditor.Show(c.contextElement.screenX,c.contextElement.screenY),window.Commands.Execute("DrawingSurfaceContainerEditorOpened",undefined),c.RefreshOutput());c.contextElement=undefined});window.Commands.On("DrawingSurfaceRefreshOutput",function(t){var u,i,r;l.undoRedoPresenter.Current!==undefined&&(t!==undefined&&((t.status==="Undo"||t.status==="Redo"||t.status==="Set")&&(l.variableEditor.Hide(),l.editingId=undefined),t.status==="Set"&&(l.ResetVariableIdIndex(),u=l.GetLayoutCentralPoint(),i=n.ModelHelper.GetModelBoundingBox(l.undoRedoPresenter.Current.layout,{xOrigin:l.Grid.x0,yOrigin:l.Grid.y0,xStep:l.Grid.xStep,yStep:l.Grid.yStep}),l.driver.SetVisibleRect(i))),c.editingId!==undefined&&(r=c.undoRedoPresenter.Current.model.GetVariableById(c.editingId),r!==undefined?c.variableEditor.Initialize(c.GetVariableById(c.undoRedoPresenter.Current.layout,c.undoRedoPresenter.Current.model,c.editingId).model,c.undoRedoPresenter.Current.model):c.containerEditor.Initialize(c.undoRedoPresenter.Current.layout.GetContainerById(c.editingId))),c.RefreshOutput())});window.Commands.On("ModelFitToView",function(){if(l.undoRedoPresenter.Current!==undefined){var t=n.ModelHelper.GetModelBoundingBox(l.undoRedoPresenter.Current.layout,{xOrigin:l.Grid.x0,yOrigin:l.Grid.y0,xStep:l.Grid.xStep,yStep:l.Grid.yStep});l.driver.SetVisibleRect(t)}});window.Commands.On("DrawingSurfaceSetProofResults",function(n){if(l.svg!==undefined&&l.undoRedoPresenter.Current!==undefined){var t=l.CreateSvg(n);l.driver.Draw(t)}});window.Commands.On("DrawingSurfaceVariableEditorOpened",function(){l.containerEditor.Hide()});window.Commands.On("DrawingSurfaceContainerEditorOpened",function(){l.variableEditor.Hide()});v=$("<div><\/div>");v.svg({onLoad:function(n){l.svg=n;c.RefreshOutput()}});a=f.GetDragSubject();window.Commands.On("ZoomSliderChanged",function(n){if(n.isExternal!==!0){var t=n.value*24+800;u.SetZoom(t)}});window.Commands.On("VisibleRectChanged",function(n){n<window.PlotSettings.MinWidth&&(n=window.PlotSettings.MinWidth,u.SetZoom(n));n>window.PlotSettings.MaxWidth&&(n=window.PlotSettings.MaxWidth,u.SetZoom(n));var t=(n-window.PlotSettings.MinWidth)/24;window.Commands.Execute("ZoomSliderBind",t)});a.dragStart.subscribe(function(n){var t,i,r,u;if(c.selectedType==="Activator"||c.selectedType==="Inhibitor"){if(t=l.GetVariableAtPosition(n.x,n.y),t!==undefined){l.stagingLine={};l.stagingLine.id=t;l.stagingLine.x0=n.x;l.stagingLine.y0=n.y;return}}else c.selectedType===undefined&&(t=l.GetVariableAtPosition(n.x,n.y),i=l.GetContainerAtPosition(n.x,n.y),t!==undefined?(c.navigationDriver.TurnNavigation(!1),r=c.GetVariableById(c.undoRedoPresenter.Current.layout,c.undoRedoPresenter.Current.model,t),c.stagingVariable={model:r.model,layout:r.layout}):i!==undefined?(c.navigationDriver.TurnNavigation(!1),u=c.undoRedoPresenter.Current.layout.GetContainerById(i),c.stagingContainer={container:u}):c.navigationDriver.TurnNavigation(!0));l.stagingLine=undefined});a.drag.subscribe(function(t){if((c.selectedType==="Activator"||c.selectedType==="Inhibitor")&&c.stagingLine!==undefined){c.stagingLine.x1=t.x1;c.stagingLine.y1=t.y1;c.svg!==undefined&&c.driver.DrawLayer2(c.CreateStagingSvg());return}c.stagingVariable!==undefined?(c.stagingVariable.layout=new n.Model.VariableLayout(c.stagingVariable.layout.Id,t.x1,t.y1,0,0,0),c.svg!==undefined&&c.driver.DrawLayer2(c.CreateStagingSvg())):l.stagingContainer!==undefined&&(c.stagingContainer.position={x:t.x1,y:t.y1},c.svg!==undefined&&c.driver.DrawLayer2(c.CreateStagingSvg()))});a.dragEnd.subscribe(function(){if(c.driver.DrawLayer2(undefined),(c.selectedType==="Activator"||c.selectedType==="Inhibitor")&&l.stagingLine!==undefined&&(l.TryAddStagingLineAsLink(),l.stagingLine=undefined,l.RefreshOutput()),c.stagingVariable!==undefined){var n=c.stagingVariable.layout.PositionX,t=c.stagingVariable.layout.PositionY,i=c.stagingVariable.model.Type,r=c.stagingVariable.model.Id;c.stagingVariable=undefined;c.TryAddVariable(n,t,i,r)||c.RefreshOutput()}if(c.stagingContainer!==undefined){var u=c.stagingContainer.position.x,f=c.stagingContainer.position.y,e=c.stagingContainer.container.Id;c.stagingContainer=undefined;c.TryAddVariable(u,f,"Container",e)||c.RefreshOutput()}})}return t.prototype.RefreshOutput=function(){if(this.svg!==undefined&&this.undoRedoPresenter.Current!==undefined){var n=this.CreateSvg(undefined);this.driver.Draw(n)}},t.prototype.CopyToClipboard=function(t){var i=this;i.contextElement!==undefined&&(i.clipboard=n.ModelHelper.CreateClipboardContent(i.undoRedoPresenter.Current.model,i.undoRedoPresenter.Current.layout,i.contextElement),t&&(i.contextElement.type==="variable"?i.RemoveVariable(i.contextElement.id):i.contextElement.type==="container"&&i.RemoveContainer(i.contextElement.id)),i.contextElement=undefined)},t.prototype.GetLayoutCentralPoint=function(){for(var r,o=this.undoRedoPresenter.Current.layout,s=this.undoRedoPresenter.Current.model,t={x:0,y:0},i=0,f=o.Containers,n=0;n<f.length;n++)t.x+=f[n].PositionX,t.y+=f[n].PositionY,i++;var e=o.Variables,u=[],h=function(n){for(var t=0;t<u.length;t++)if(n.x===u[t].x&&n.y===u[t].y)return!0;return!1};for(n=0;n<e.length;n++)s.Variables[n].Type==="Constant"&&(r=this.GetGridCell(e[n].PositionX,e[n].PositionY),h(r)||(u.push(r),t.x+=r.x,t.y+=r.y,i++));return i>0&&(t.x=(t.x/i+.5)*this.xStep+this.xOrigin,t.y=-(t.y/i+.5)*this.yStep+this.yOrigin),t},t.prototype.GetCurrentSVG=function(n){return $(n.toSVG()).children()},t.prototype.RemoveVariable=function(t){var r,f,i,h,c;this.editingId===t&&(this.editingId=undefined);var e=!1,l=this.undoRedoPresenter.Current.model,a=this.undoRedoPresenter.Current.layout,u=this.undoRedoPresenter.Current.model.Variables,v=this.undoRedoPresenter.Current.layout.Variables,o=[],s=[];for(i=0;i<u.length;i++)u[i].Id!==t?(o.push(u[i]),s.push(v[i])):e=!0;for(r=this.undoRedoPresenter.Current.model.Relationships,f=[],i=0;i<r.length;i++)r[i].FromVariableId!==t&&r[i].ToVariableId!==t&&f.push(r[i]);e===!0&&(h=new n.Model.BioModel(l.Name,o,f),c=new n.Model.Layout(a.Containers,s),this.undoRedoPresenter.Dup(h,c))},t.prototype.RemoveContainer=function(t){var s,h,c,i,e,l,u,k,d;this.editingId===t&&(this.editingId=undefined);var a=!1,o=this.undoRedoPresenter.Current.model,v=this.undoRedoPresenter.Current.layout,y=v.Containers,p=[];for(i=0;i<y.length;i++)s=y[i],s.Id!==t?p.push(s):a=!0;if(a===!0){var r=o.Variables,g=v.Variables,w=[],b=[],f=[];for(i=0;i<r.length;i++)r[i].Type==="Constant"||r[i].ContainerId!==t?(w.push(r[i]),b.push(g[i])):(f.push(r[i].Id),this.editingId===r[i].Id&&(this.editingId=undefined));for(h=o.Relationships,c=[],i=0;i<h.length;i++){for(e=h[i],l=!1,u=0;u<f.length;u++)if(e.FromVariableId===f[u]||e.ToVariableId===f[u]){l=!0;break}l===!1&&c.push(e)}k=new n.Model.BioModel(o.Name,w,c);d=new n.Model.Layout(p,b);this.undoRedoPresenter.Dup(k,d)}},t.prototype.RemoveRelationship=function(t){for(var s,h,u=!1,f=this.undoRedoPresenter.Current.model,e=this.undoRedoPresenter.Current.layout,r=this.undoRedoPresenter.Current.model.Relationships,o=[],i=0;i<r.length;i++)r[i].Id!==t?o.push(r[i]):u=!0;u===!0&&(s=new n.Model.BioModel(f.Name,f.Variables,o),h=new n.Model.Layout(e.Containers,e.Variables),this.undoRedoPresenter.Dup(s,h))},t.prototype.GetVariableAtPosition=function(n,t){for(var r=this.undoRedoPresenter.Current.model.Variables,e=this.undoRedoPresenter.Current.layout.Variables,i=0;i<r.length;i++){var u=r[i],f=e[i],o=window.ElementRegistry.GetElementByType(u.Type);if(o.Contains(n,t,f.PositionX,f.PositionY))return u.Id}return undefined},t.prototype.GetContainerAtPosition=function(n,t){for(var r,f=this.undoRedoPresenter.Current.layout.Containers,e=window.ElementRegistry.GetElementByType("Container"),i=this.Grid,u=0;u<f.length;u++)if(r=f[u],e.IntersectsBorder(n,t,(r.PositionX+.5)*i.xStep+i.x0,(r.PositionY+.5)*i.yStep+i.y0,{Size:r.Size,xStep:i.xStep/2,yStep:i.yStep/2}))return r.Id;return undefined},t.prototype.GetRelationshipAtPosition=function(n,t,i){for(var f=this.undoRedoPresenter.Current.model.Relationships,e=this.undoRedoPresenter.Current.layout,u=0;u<f.length;u++){var r=f[u],o=e.GetVariableById(r.FromVariableId),s=e.GetVariableById(r.ToVariableId),h={x:o.PositionX,y:o.PositionY,pixelWidth:i},c={x:s.PositionX,y:s.PositionY},l=window.ElementRegistry.GetElementByType(r.Type);if(l.Contains(n,t,h,c))return r.Id}return undefined},t.prototype.Intersects=function(n,t){return Math.abs(n.x-t.x)*2<=n.width+t.width&&Math.abs(n.y-t.y)*2<=n.height+t.height},t.prototype.Contains=function(n,t){return t.width<this.xStep&&t.height<this.yStep&&t.x>n.x*this.xStep+this.xOrigin&&t.x+t.width<(n.x+1)*this.xStep+this.xOrigin&&t.y>n.y*this.yStep+this.yOrigin&&t.y+t.height<(n.y+1)*this.yStep+this.yOrigin},t.prototype.TryAddStagingLineAsLink=function(){for(var s,r=this.undoRedoPresenter.Current.model.Variables,h=this.undoRedoPresenter.Current.layout.Variables,t=0;t<r.length;t++){var u=r[t],f=h[t],c=window.ElementRegistry.GetElementByType(u.Type);if(c.Contains(this.stagingLine.x1,this.stagingLine.y1,f.PositionX,f.PositionY)){var e=this.undoRedoPresenter.Current,i=e.model,l=e.layout,o=i.Relationships.slice(0);o.push(new n.Model.Relationship(this.variableIndex++,this.stagingLine.id,u.Id,this.selectedType));s=new n.Model.BioModel(i.Name,i.Variables,o);this.undoRedoPresenter.Dup(s,l);return}}},t.prototype.CanAddContainer=function(n,t,i){for(var r,e,s,u=this,o=u.GetGridCell(n,t),f=0;f<i;f++)for(r=0;r<i;r++)if(e={x:o.x+f,y:o.y+r},s=u.GetContainerFromGridCell(e)===undefined&&u.GetConstantsFromGridCell(e).length===0,s!==!0)return!1;return!0},t.prototype.CanAddVariable=function(n,t,i,r){var u=this,a=u.GetGridCell(n,t),v=u.undoRedoPresenter.Current.model.Variables.slice(0),h=u.undoRedoPresenter.Current.layout.Variables.slice(0),c,y,f,e,o,l;switch(i){case"Constant":if(c=window.ElementRegistry.GetElementByType("Constant").GetBoundingBox(n,t),y=u.GetContainerFromGridCell(a)===undefined&&u.Contains(a,c),y===!0)for(f=0;f<h.length;f++)if((e=v[f],r===undefined||r!==e.Id)&&(o=h[f],l=window.ElementRegistry.GetElementByType(e.Type).GetBoundingBox(o.PositionX,o.PositionY),this.Intersects(c,l)))return!1;return y;case"Default":var c=window.ElementRegistry.GetElementByType("Default").GetBoundingBox(n,t),a=u.GetGridCell(n,t),s=u.GetContainerFromGridCell(a);if(s===undefined||!window.ElementRegistry.GetElementByType("Container").ContainsBBox(c,(s.PositionX+.5)*u.xStep,(s.PositionY+.5)*u.yStep,{Size:s.Size,xStep:u.Grid.xStep/2,yStep:u.Grid.yStep/2}))return!1;for(f=0;f<h.length;f++)if((e=v[f],r===undefined||r!==e.Id)&&(o=h[f],l=window.ElementRegistry.GetElementByType(e.Type).GetBoundingBox(o.PositionX,o.PositionY),u.Intersects(c,l)))return!1;return!0;case"MembraneReceptor":var c=window.ElementRegistry.GetElementByType("MembraneReceptor").GetBoundingBox(n,t),a=u.GetGridCell(n,t),s=u.GetContainerFromGridCell(a);if(s===undefined||!window.ElementRegistry.GetElementByType("Container").IntersectsBorder(n,t,(s.PositionX+.5)*u.xStep,(s.PositionY+.5)*u.yStep,{Size:s.Size,xStep:u.Grid.xStep/2,yStep:u.Grid.yStep/2}))return!1;for(f=0;f<h.length;f++)if((e=v[f],r===undefined||r!==e.Id)&&(o=h[f],l=window.ElementRegistry.GetElementByType(e.Type).GetBoundingBox(o.PositionX,o.PositionY),u.Intersects(c,l)))return!1;return!0}throw"Unknown Variable type";},t.prototype.TryAddVariable=function(t,i,r,u){var e=this,it=e.undoRedoPresenter.Current,l=it.model,v=it.layout,g,nt,w,rt,ut,p,h,o,s,st,d,f,c,tt,b,k;switch(r){case"Container":var y=v.Containers.slice(0),o=l.Variables.slice(0),s=v.Variables.slice(0),p=e.GetGridCell(t,i),h=v.GetContainerById(u);if(e.CanAddContainer(t,i,h===undefined?1:h.Size)===!0){if(u!==undefined){for(f=0;f<y.length;f++)if(y[f].Id===u)for(g={x:y[f].PositionX*e.Grid.xStep+e.Grid.x0,y:y[f].PositionY*e.Grid.yStep+e.Grid.y0},y[f]=new n.Model.ContainerLayout(u,y[f].Name,y[f].Size,p.x,p.y),nt={x:p.x*e.Grid.xStep+e.Grid.x0,y:p.y*e.Grid.yStep+e.Grid.y0},w=0;w<s.length;w++)o[w].ContainerId===u&&(rt=s[w].PositionX,ut=s[w].PositionY,s[w]=new n.Model.VariableLayout(s[w].Id,rt-g.x+nt.x,ut-g.y+nt.y,0,0,s[w].Angle))}else y.push(new n.Model.ContainerLayout(e.variableIndex++,"",1,p.x,p.y));return b=new n.Model.BioModel(l.Name,l.Variables,l.Relationships),k=new n.Model.Layout(y,s),e.undoRedoPresenter.Dup(b,k),!0}break;case"Constant":if(o=l.Variables.slice(0),s=v.Variables.slice(0),e.CanAddVariable(t,i,"Constant",u)!==!0)return!1;if(u!==undefined)for(f=0;f<o.length;f++)o[f].Id===u&&(s[f]=new n.Model.VariableLayout(u,t,i,0,0,0));else o.push(new n.Model.Variable(this.variableIndex,0,r,"",0,1,"")),s.push(new n.Model.VariableLayout(this.variableIndex++,t,i,0,0,0));return b=new n.Model.BioModel(l.Name,o,l.Relationships),k=new n.Model.Layout(v.Containers,s),e.undoRedoPresenter.Dup(b,k),!0;case"Default":if(o=l.Variables.slice(0),s=v.Variables.slice(0),e.CanAddVariable(t,i,"Default",u)!==!0)return!1;if(p=e.GetGridCell(t,i),h=e.GetContainerFromGridCell(p),u!==undefined)for(f=0;f<o.length;f++)o[f].Id===u&&(c=o[f],c.ContainerId!==h.Id&&(o[f]=new n.Model.Variable(c.Id,h.Id,c.Type,c.Name,c.RangeFrom,c.RangeTo,c.Formula)),s[f]=new n.Model.VariableLayout(u,t,i,0,0,0));else o.push(new n.Model.Variable(this.variableIndex,h.Id,r,"",0,1,"")),s.push(new n.Model.VariableLayout(this.variableIndex++,t,i,0,0,0));return b=new n.Model.BioModel(l.Name,o,l.Relationships),k=new n.Model.Layout(v.Containers,s),e.undoRedoPresenter.Dup(b,k),!0;case"MembraneReceptor":if(o=l.Variables.slice(0),s=v.Variables.slice(0),e.CanAddVariable(t,i,"MembraneReceptor",u)!==!0)return!1;var p=e.GetGridCell(t,i),h=e.GetContainerFromGridCell(p),ft=(h.PositionX+.5)*this.xStep+this.xOrigin+(h.Size-1)*this.xStep/2,et=(h.PositionY+.5)*this.yStep+this.yOrigin+(h.Size-1)*this.yStep/2,a={x:t-ft,y:i-et},ot=Math.sqrt(a.x*a.x+a.y*a.y);if(a.x=a.x/ot,a.y=a.y/ot,st=Math.acos(-a.y),d=st*a.x/Math.abs(a.x),d=d*180/Math.PI,d<0&&(d+=360),u!==undefined)for(f=0;f<o.length;f++)o[f].Id===u&&(c=o[f],c.ContainerId!==h.Id&&(o[f]=new n.Model.Variable(c.Id,h.Id,c.Type,c.Name,c.RangeFrom,c.RangeTo,c.Formula)),s[f]=new n.Model.VariableLayout(u,t,i,0,0,d));else tt=n.SVGHelper.GeEllipsePoint(ft+2.5*h.Size,et,107*h.Size,127*h.Size,t,i),o.push(new n.Model.Variable(this.variableIndex,h.Id,r,"",0,1,"")),s.push(new n.Model.VariableLayout(this.variableIndex++,tt.x,tt.y,0,0,d));return b=new n.Model.BioModel(l.Name,o,l.Relationships),k=new n.Model.Layout(v.Containers,s),e.undoRedoPresenter.Dup(b,k),!0}return!1},t.prototype.GetGridCell=function(n,t){var i=Math.ceil((n-this.xOrigin)/this.xStep)-1,r=Math.ceil((t-this.yOrigin)/this.yStep)-1;return{x:i,y:r}},t.prototype.GetContainerFromGridCell=function(n){for(var r=this.undoRedoPresenter.Current,i=r.layout.Containers,t=0;t<i.length;t++)if(i[t].PositionX<=n.x&&i[t].PositionX+i[t].Size>n.x&&i[t].PositionY<=n.y&&i[t].PositionY+i[t].Size>n.y)return i[t];return undefined},t.prototype.GetConstantsFromGridCell=function(n){for(var r=[],u=this.undoRedoPresenter.Current.model.Variables,e=this.undoRedoPresenter.Current.layout.Variables,t=0;t<u.length;t++){var o=u[t],i=e[t],f=this.GetGridCell(i.PositionX,i.PositionY);n.x===f.x&&n.y===f.y&&r.push({variable:o,variableLayout:i})}return r},t.prototype.ResetVariableIdIndex=function(){var t,i,n;for(this.variableIndex=1,t=this.undoRedoPresenter.Current.model,i=this.undoRedoPresenter.Current.layout,n=0;n<t.Variables.length;n++)t.Variables[n].Id>=this.variableIndex&&(this.variableIndex=t.Variables[n].Id+1);for(n=0;n<i.Containers.length;n++)i.Containers[n].Id>=this.variableIndex&&(this.variableIndex=i.Containers[n].Id+1);for(n=0;n<t.Relationships.length;n++)t.Relationships[n].Id>=this.variableIndex&&(this.variableIndex=t.Relationships[n].Id+1)},Object.defineProperty(t.prototype,"Grid",{get:function(){return{x0:this.xOrigin,y0:this.yOrigin,xStep:this.xStep,yStep:this.yStep}},enumerable:!0,configurable:!0}),t.prototype.GetVariableById=function(n,t,i){for(var u,f=n.Variables,e=t.Variables,r=0;r<f.length;r++)if(u=f[r],u.Id===i)return{model:e[r],layout:u};throw"No such variable in model";},t.prototype.GetVariableColorByStatus=function(n){return n?"green":"red"},t.prototype.GetContainerColorByStatus=function(n){return n?"#E9FFCC":"#FFDDDB"},t.prototype.GetItemById=function(n,t){for(var i=0;i<n.length;i++)if(n[i].id===t)return n[i];return undefined},t.prototype.CreateSvg=function(n){var i,o,s,u,h,v,c,a,w,b,t;if(this.svg===undefined)return undefined;for(i=[],o=this.undoRedoPresenter.Current.layout.Containers,t=0;t<o.length;t++)s=o[t],u=window.ElementRegistry.GetElementByType("Container"),i.push(u.RenderToSvg({layout:s,grid:this.Grid,background:n===undefined||n.containersStability===undefined?undefined:this.GetContainerColorByStatus(n.containersStability[s.Id])}));for(h=this.undoRedoPresenter.Current.model.Variables,v=this.undoRedoPresenter.Current.layout.Variables,t=0;t<h.length;t++){var r=h[t],k=v[t],u=window.ElementRegistry.GetElementByType(r.Type),f=n===undefined?undefined:this.GetItemById(n.variablesStability,r.Id),e=r.Type==="MembraneReceptor"?this.undoRedoPresenter.Current.layout.GetContainerById(r.ContainerId):undefined,y=undefined,p=undefined;e!==undefined&&(y=e.Size,p={x:e.PositionX,y:e.PositionY});i.push(u.RenderToSvg({model:r,layout:k,grid:this.Grid,gridCell:p,sizeCoef:y,valueText:f===undefined?undefined:f.range,labelColor:f===undefined?undefined:this.GetVariableColorByStatus(f.state)}))}for(c=this.undoRedoPresenter.Current.model.Relationships,t=0;t<c.length;t++){var l=c[t],u=window.ElementRegistry.GetElementByType(l.Type),d=this.GetVariableById(this.undoRedoPresenter.Current.layout,this.undoRedoPresenter.Current.model,l.FromVariableId).layout,g=this.GetVariableById(this.undoRedoPresenter.Current.layout,this.undoRedoPresenter.Current.model,l.ToVariableId).layout;i.push(u.RenderToSvg({layout:{start:d,end:g},grid:this.Grid}))}for(this.svg.clear(),a=this.svg.defs("bmaDefs"),w=this.svg.marker(a,"Activator",4,0,8,4,"auto",{viewBox:"0 -2 4 4"}),this.svg.polyline(w,[[0,2],[4,0],[0,-2]],{fill:"none",stroke:"#808080",strokeWidth:"1px"}),b=this.svg.marker(a,"Inhibitor",0,0,2,6,"auto",{viewBox:"0 -3 2 6"}),this.svg.line(b,0,3,0,-3,{fill:"none",stroke:"#808080",strokeWidth:"2px"}),t=0;t<i.length;t++)this.svg.add(i[t]);return $(this.svg.toSVG()).children()},t.prototype.CreateStagingSvg=function(){var n,i,r,t;if(this.svg===undefined)return undefined;if(this.svg.clear(),n=this.svg.defs("bmaDefs"),i=this.svg.marker(n,"Activator",4,0,8,4,"auto",{viewBox:"0 -2 4 4"}),this.svg.polyline(i,[[0,2],[4,0],[0,-2]],{fill:"none",stroke:"#808080",strokeWidth:"1px"}),r=this.svg.marker(n,"Inhibitor",0,0,2,6,"auto",{viewBox:"0 -3 2 6"}),this.svg.line(r,0,3,0,-3,{fill:"none",stroke:"#808080",strokeWidth:"2px"}),this.stagingLine!==undefined&&this.svg.line(this.stagingLine.x0,this.stagingLine.y0,this.stagingLine.x1,this.stagingLine.y1,{stroke:"#808080",strokeWidth:2,fill:"#808080","marker-end":"url(#"+this.selectedType+")",id:"stagingLine"}),this.stagingVariable!==undefined&&(t=window.ElementRegistry.GetElementByType(this.stagingVariable.model.Type),this.svg.add(t.RenderToSvg({model:this.stagingVariable.model,layout:this.stagingVariable.layout,grid:this.Grid}))),this.stagingContainer!==undefined){var t=window.ElementRegistry.GetElementByType("Container"),u=(this.stagingContainer.container.PositionX+.5)*this.Grid.xStep+(this.stagingContainer.container.Size-1)*this.Grid.xStep/2,f=(this.stagingContainer.container.PositionY+.5)*this.Grid.yStep+(this.stagingContainer.container.Size-1)*this.Grid.yStep/2;this.svg.add(t.RenderToSvg({layout:this.stagingContainer.container,grid:this.Grid,background:"none",translate:{x:this.stagingContainer.position.x-u,y:this.stagingContainer.position.y-f}}))}return $(this.svg.toSVG()).children()},t}();t.DesignSurfacePresenter=i})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f,e){var s=this,o;this.appModel=t;this.ajax=u;this.messagebox=f;this.logService=e;o=this;window.Commands.On("ProofByFurtherTesting",function(n){try{n.fixPoint.forEach(function(n){var t=o.getIndById(o.stability.variablesStability,n.Id),i=o.stability.variablesStability[t].id})}catch(r){throw new EventException;}n.fixPoint.forEach(function(n){var t=o.getIndById(o.stability.variablesStability,n.Id),r,i;o.stability.variablesStability[t].state=!0;o.stability.variablesStability[t].range=n.Value;r=o.stability.variablesStability[t].id;i=o.appModel.BioModel.GetVariableById(r).ContainerId;i!==undefined&&(o.stability.containersStability[i]=!0)});var t=o.CreateTableView(o.stability.variablesStability);o.expandedProofVariables=o.CreateExpandedProofVariables(t);o.AddPropagationColumn(o.stability.variablesStability);i.SetData({issucceeded:n.issucceeded,message:n.message,data:{numericData:t.numericData,colorVariables:t.colorData,colorData:o.colorData}});window.Commands.Execute("DrawingSurfaceSetProofResults",o.stability)});window.Commands.On("ProofStarting",function(){var r,f;i.OnProofStarted();try{r=n.Model.ExportBioModel(t.BioModel)}catch(u){alert(u)}o.logService.LogProofRun();f=o.ajax.Invoke(r).done(function(u){var f=t.ProofResult=new n.Model.ProofResult(u.Status==="Stabilizing",u.Time,u.Ticks),s,h,c;u.Ticks!==null?(o.expandedProofPropagation=$("<div><\/div>"),u.Status==="NotStabilizing"?window.Commands.Execute("ProofFailed",{Model:r,Res:u,Variables:o.appModel.BioModel.Variables}):window.Commands.Execute("ProofFailed",undefined),o.stability=o.Stability(u.Ticks),s=o.CreateTableView(o.stability.variablesStability),o.colorData=o.CreateColoredTable(u.Ticks),h=function(){var n=$.Deferred(),i=o.CreateExpandedProofPropagation(t.ProofResult.Ticks);return n.resolve(i),n.promise()},$.when(h()).done(function(n){o.expandedProofPropagation=n}),c=function(){var n=$.Deferred(),t=o.CreateExpandedProofVariables(s);return n.resolve(t),n.promise()},$.when(c()).done(function(n){o.expandedProofVariables=n}),window.Commands.Execute("DrawingSurfaceSetProofResults",o.stability),i.SetData({issucceeded:f.IsStable,message:o.CreateMessage(f.IsStable,f.Time),data:{numericData:s.numericData,colorVariables:s.colorData,colorData:o.colorData}}),i.ShowResult(t.ProofResult)):(e.LogProofError(),u.Status=="Error"?i.SetData({issucceeded:undefined,message:u.Error,data:undefined}):i.SetData({issucceeded:u.Status==="Stabilizing",message:o.CreateMessage(f.IsStable,f.Time),data:undefined}),i.ShowResult(t.ProofResult));o.Snapshot()}).fail(function(n,t,r){console.log("Proof Service Failed: "+r);o.messagebox.Show("Proof Service Failed: "+r);i.OnProofFailed()})});window.Commands.On("ProofRequested",function(){o.CurrentModelChanged()?window.Commands.Execute("ProofStarting",{}):(i.ShowResult(t.ProofResult),window.Commands.Execute("DrawingSurfaceSetProofResults",o.stability))});window.Commands.On("Expand",function(n){if(s.appModel.BioModel.Variables.length!==0)switch(n){case"ProofPropagation":s.appModel.ProofResult.Ticks!==null&&(r.Show({tab:n,content:$("<div><\/div>")}),i.Hide({tab:n}),r.Show({tab:n,content:o.expandedProofPropagation}));break;case"ProofVariables":i.Hide({tab:n});r.Show({tab:n,content:o.expandedProofVariables});break;default:i.Show({tab:undefined})}});window.Commands.On("Collapse",function(n){i.Show({tab:n});r.Hide()})}return t.prototype.CurrentModelChanged=function(){if(this.currentModel===undefined)return this.Snapshot(),!0;try{return JSON.stringify(n.Model.ExportBioModel(this.currentModel))!==JSON.stringify(n.Model.ExportBioModel(this.appModel.BioModel))}catch(t){return console.log(t),!0}},t.prototype.Snapshot=function(){this.currentModel=this.appModel.BioModel.Clone()},t.prototype.CreateMessage=function(n,t){return n?"BMA succeeded in checking every possible state of the model in "+t+" seconds. After stepping through separate interactions, the model eventually reached a single stable state.":"After stepping through separate interactions in the model, the analysis failed to determine a final stable state"},t.prototype.Stability=function(n){var r=[],o,f,t;if(n===null)return undefined;var l=this.appModel.BioModel.Variables,e=this.appModel.Layout.Containers,s=[],c=n[0].Variables.length;for(t=0;t<c;t++){var i=n[0].Variables[t],u=i.Lo===i.Hi,h="";h=u?i.Lo:i.Lo+" - "+i.Hi;o=i.Id;s[t]={id:o,state:u,range:h};f=this.appModel.BioModel.GetVariableById(o);f.ContainerId===undefined||u&&r[f.ContainerId]!==undefined||(r[f.ContainerId]=u)}for(t=0;t<e.length;t++)r[e[t].Id]===undefined&&(r[e[t].Id]=!0);return{variablesStability:s,containersStability:r}},t.prototype.getIndById=function(n,t){for(var r,u,i=0;i<n.length;i++)if(r=n[i].id.toString(),u=t.toString(),r===u)return i;return undefined},t.prototype.CreateTableView=function(n){var i=[],s,r,t,u,e,h,o,f;if(n===undefined)return{numericData:undefined,colorData:undefined};for(s=this.appModel.BioModel,r=[],t=0;t<n.length;t++){if(u=n[n.length-1-t],e=s.GetVariableById(u.id),i[t]=[],r[t]=[],i[t][0]=e.Name,i[t][1]=e.Formula,h="",o=u.state,!o)for(f=0;f<3;f++)r[t][f]=o;i[t][2]=u.range}return{numericData:i,colorData:r}},t.prototype.CreateColoredTable=function(n){var o=this,t,i,u;if(n!==null){var r=[],f=n.length,e=n[0].Variables.length;for(t=0;t<e;t++)for(r[t]=[],i=0;i<f;i++)u=n[f-i-1].Variables[e-1-t],r[t][i]=u.Hi===u.Lo;return r}},t.prototype.AddPropagationColumn=function(n){var r=this.expandedProofPropagation.find("tr"),i,t;for($("<td><\/td>").text("Fix Point").appendTo(r.eq(0)),i=this.expandedProofPropagation.coloredtableviewer("option","colorData"),t=0;t<n.length;t++)i[t][0]=n[t].state,$("<td><\/td>").text(n[t].range).appendTo(r.eq(t+1)),this.colorData[t].push(n[t].state),i[t].push(n[t].state);this.expandedProofPropagation.coloredtableviewer("option","colorData",i)},t.prototype.CreateExpandedProofVariables=function(n){var t=$("<div><\/div>").coloredtableviewer({numericData:n.numericData,colorData:n.colorData,header:["Name","Formula","Range"]});return t.addClass("scrollable-results"),t},t.prototype.CreateExpandedProofPropagation=function(n){var r=$("<div><\/div>"),t,h,i,u;if(n===null)return r;var a=this,c=this.appModel.BioModel,o=c.Variables,f=[],e=[],s=[],l=n.length;for(s[0]="Name",i=0;i<n.length;i++)s[i+1]="T = "+i;for(t=0;t<o.length;t++)for(f[t]=[],e[t]=[],f[t][0]=c.GetVariableById(n[0].Variables[o.length-1-t].Id).Name,h=n[0].Variables[o.length-1-t],e[t][0]=h.Lo===h.Hi,i=1;i<l+1;i++)u=n[l-i].Variables[o.length-1-t],u.Lo===u.Hi?(f[t][i]=u.Lo,e[t][i]=!0):(f[t][i]=u.Lo+" - "+u.Hi,e[t][i]=!1);return r.coloredtableviewer({header:s,numericData:f,colorData:e}),r.addClass("scrollable-results"),r.children("table").removeClass("variables-table").addClass("proof-propagation-table"),r.find("td").eq(0).width(150),r},t}();t.ProofPresenter=i})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f,e,o){var h=this,s;this.appModel=t;this.compactViewer=r;this.expandedViewer=i;this.logService=e;this.ajax=f;this.colors=[];s=this;window.Commands.On("ChangePlotVariables",function(n){s.colors[n.ind].Seen=n.check;s.compactViewer.ChangeVisibility(n)});window.Commands.On("RunSimulation",function(t){s.expandedViewer.StandbyMode();s.results=[];s.initValues=t.data;s.ClearColors();try{var i=n.Model.ExportBioModel(s.appModel.BioModel),r=s.ConvertParam(t.data);e.LogSimulationRun();s.StartSimulation({model:i,variables:r,num:t.num})}catch(u){alert(u);s.expandedViewer.ActiveMode()}});window.Commands.On("SimulationRequested",function(){if(s.CurrentModelChanged()){s.initValues=[];s.results=[];s.expandedSimulationVariables=undefined;s.CreateColors();s.ClearColors();s.dataForPlot=s.CreateDataForPlot(s.colors);var n=s.CreateVariablesView();s.compactViewer.SetData({data:{variables:n,colorData:undefined},plot:undefined})}});window.Commands.On("Expand",function(n){if(h.appModel.BioModel.Variables.length!==0){var t=undefined,i=h.appModel.BioModel.Variables.sort(function(n,t){return n.Id<t.Id?-1:1});switch(n){case"SimulationVariables":s.expandedSimulationVariables!==undefined?t=s.expandedSimulationVariables:(s.expandedViewer.Set({variables:i,colors:s.dataForPlot,init:s.initValues}),t=s.expandedViewer.GetViewer());break;case"SimulationPlot":t=$("<div><\/div>").simulationplot({colors:s.dataForPlot});break;default:r.Show({tab:undefined})}t!==undefined&&(r.Hide({tab:n}),u.Show({tab:n,content:t}))}});window.Commands.On("Collapse",function(n){r.Show({tab:n});u.Hide()});window.Commands.On("ExportCSV",function(){var n=s.CreateCSV(",");o.Export(n,t.BioModel.Name,"csv")})}return t.prototype.CurrentModelChanged=function(){if(this.currentModel===undefined)return this.Snapshot(),!0;try{var t=JSON.stringify(n.Model.ExportBioModel(this.currentModel)),i=JSON.stringify(n.Model.ExportBioModel(this.appModel.BioModel));return t!==i}catch(r){return this.Snapshot(),!0}},t.prototype.Snapshot=function(){this.currentModel=this.appModel.BioModel.Clone()},t.prototype.StartSimulation=function(n){var t=this,i,r,u,f;if(t.expandedSimulationVariables=t.expandedViewer.GetViewer(),n.num===undefined||n.num===0){i=t.CreateVariablesView();r=t.CreateProgressionMinTable();t.dataForPlot=t.CreateDataForPlot(t.colors);t.compactViewer.SetData({data:{variables:i,colorData:r},plot:t.dataForPlot});t.expandedViewer.ActiveMode();this.Snapshot();return}if(u={Model:n.model,Variables:n.variables},n.variables!==undefined&&n.variables!==null)f=t.ajax.Invoke(u).done(function(i){if(i.Variables!==null){t.results.push(i);t.expandedViewer.AddResult(i);var r=t.ConvertResult(i);t.AddData(r);t.StartSimulation({model:n.model,variables:i.Variables,num:n.num-1})}else t.expandedViewer.ActiveMode(),alert("Simulation Error: "+i.ErrorMessages)}).fail(function(n,i,r){this.logService.LogSimulationError();console.log(i);t.expandedViewer.ActiveMode();alert("Simulate error: "+r);return});else return},t.prototype.AddData=function(n){var r,t,i;if(n!==null)for(r=this.appModel.BioModel.Variables.sort(function(n,t){return n.Id<t.Id?-1:1}),t=0;t<n.length;t++)i=this.colors[this.GetColorById(r[t].Id)],i.Plot.push(n[t]);return i},t.prototype.CreateDataForPlot=function(n){for(var i=[],r=this.appModel.BioModel.Variables.sort(function(n,t){return n.Id<t.Id?-1:1}),t=0;t<r.length;t++)i.push(n[this.GetColorById(r[t].Id)]);return i},t.prototype.CreateColors=function(){for(var t=this.appModel.BioModel.Variables,n=0;n<t.length;n++)this.GetColorById(t[n].Id)===undefined&&this.colors.push({Id:t[n].Id,Name:t[n].Name,Color:this.getRandomColor(),Seen:!0,Plot:[]})},t.prototype.CreateCSV=function(n){for(var s,f,e,u,h,t="",o=this,r=this.dataForPlot,i=0,c=r.length;i<c;i++){for(s=o.appModel.BioModel.GetVariableById(r[i].Id).ContainerId,f=o.appModel.Layout.GetContainerById(s),t+=f!==undefined?f.Name+n:""+n,t+=r[i].Name+n,e=r[i].Plot,u=0,h=e.length;u<h;u++)t+=e[u]+n;t+="\n"}return t},t.prototype.ClearColors=function(){for(var t,i,n=0;n<this.colors.length;n++)this.colors[n].Plot=[];for(t=this.appModel.BioModel.Variables,n=0;n<t.length;n++)i=this.GetColorById(t[n].Id),this.colors[i].Plot=[],this.colors[i].Name=t[n].Name,this.initValues[n]!==undefined&&(this.colors[i].Plot[0]=this.initValues[n])},t.prototype.GetColorById=function(n){for(var t=0;t<this.colors.length;t++)if(n===this.colors[t].Id)return t;return undefined},t.prototype.getRandomColor=function(){var n=this.GetRandomInt(0,255),t=this.GetRandomInt(0,255),i=this.GetRandomInt(0,255);return"rgb("+n+", "+t+", "+i+")"},t.prototype.GetRandomInt=function(n,t){return Math.floor(Math.random()*(t-n+1)+n)},t.prototype.CreateProgressionMinTable=function(){var i=[],n,r,t;if(!(this.results.length<1)){for(n=0;n<this.results[0].Variables.length;n++)for(i[n]=[],i[n][0]=!1,r=this.results.length,t=1;t<r;t++)i[n][t]=this.results[t].Variables[n].Value!==this.results[t-1].Variables[n].Value;return i}},t.prototype.CreateVariablesView=function(){for(var r=this,t=[],i=this.appModel.BioModel.Variables.sort(function(n,t){return n.Id<t.Id?-1:1}),n=0;n<i.length;n++)t[n]=[],t[n][0]=this.colors[this.GetColorById(i[n].Id)].Color,t[n][1]=function(){var t=r.appModel.Layout.GetContainerById(i[n].ContainerId);return t!==undefined?t.Name:""}(),t[n][2]=i[n].Name,t[n][3]=i[n].RangeFrom+" - "+i[n].RangeTo;return t},t.prototype.ConvertParam=function(n){for(var i=[],r=this.appModel.BioModel.Variables.sort(function(n,t){return n.Id<t.Id?-1:1}),t=0;t<n.length;t++)i[t]={Id:r[t].Id,Value:n[t]};return i},t.prototype.ConvertResult=function(n){var i=[],t;for(n.Variables!==undefined&&n.Variables!==null&&(i=[]),t=0;t<n.Variables.length;t++)i[t]=n.Variables[t].Value;return i},t}();t.SimulationPresenter=i})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(t){var i=function(){function t(t,i,r,u,f){var e=this;window.Commands.On("NewModel",function(){function i(){t.Deserialize(undefined);r.Snapshot(t);u.LogNewModelCreated()}try{if(r.IsChanged(t))var n=$("<div><\/div>").appendTo("body").userdialog({message:"Do you want to save changes?",functions:[function(){n.detach()},function(){n.detach();i()},function(){n.detach()}]});else i()}catch(f){i()}});window.Commands.On("ImportModel",function(){function e(){i.OpenFileDialog().done(function(i){var u=new FileReader;u.onload=function(){var o=u.result,f,i;try{f=$.parseXML(o);i=n.ParseXmlModel(f,window.GridSettings);t.Reset(i.Model,i.Layout)}catch(e){console.log("XML parsing failed: "+e+". Trying JSON");try{t.Deserialize(u.result)}catch(s){console.log("JSON failed: "+e+". Trying legacy JSON version");t.DeserializeLegacyJSON(u.result)}}r.Snapshot(t)};u.readAsText(i)})}try{if(r.IsChanged(t))var f=$("<div><\/div>").appendTo("body").userdialog({message:"Do you want to save changes?",functions:[function(){f.detach()},function(){f.detach();e()},function(){f.detach()}]});else u.LogImportModel(),e()}catch(o){alert(o);u.LogImportModel();e()}});window.Commands.On("ExportModel",function(){try{var n=t.Serialize();f.Export(n,t.BioModel.Name,"json");r.Snapshot(t)}catch(i){alert(i)}})}return t}();t.ModelStoragePresenter=i})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(n,t){var i=this;this.editorDriver=n;this.ajax=t;window.Commands.On("FormulaEdited",function(n){var r=n.formula,u=n.inputs,t,f;for(t in u)if(u[t]>1&&r.split(t).length-1!==u[t]){i.editorDriver.SetValidation(!1,"Need equal number of repeating inputs in formula");return}r!==""?f=i.ajax.Invoke({Formula:r}).done(function(n){i.editorDriver.SetValidation(n.IsValid,n.Message)}).fail(function(){i.editorDriver.SetValidation(undefined,"")}):i.editorDriver.SetValidation(undefined,"")})}return n}();n.FormulaValidationPresenter=t})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f){function s(){e.driver.ActiveMode();e.driver.HideStartFurtherTestingToggler();e.driver.HideResults();e.data=undefined}var o=this,e=this;this.appModel=n;this.driver=t;this.popupViewer=i;this.ajax=r;this.messagebox=u;window.Commands.On("ProofFailed",function(n){n!==undefined?(e.driver.ShowStartFurtherTestingToggler(),e.model=n.Model,e.result=n.Res,e.variables=n.Variables):e.data=undefined});window.Commands.On("ProofStarting",function(){s()});window.Commands.On("FurtherTestingRequested",function(){if(e.result.length!==0&&e.model!==undefined&&e.result!==undefined&&e.variables!==undefined){e.driver.StandbyMode();f.LogFurtherTestingRun();var n=e.ajax.Invoke({Model:e.model,Analysis:e.result}).done(function(n){var t,a,v,y,p,w;if(e.driver.ActiveMode(),n.CounterExamples!==null){if(e.driver.HideStartFurtherTestingToggler(),n.CounterExamples.length!==0){var r=null,u=null,o=null;for(t=0;t<n.CounterExamples.length;t++)switch(n.CounterExamples[t].Status){case"Bifurcation":r=n.CounterExamples[t];break;case"Cycle":u=n.CounterExamples[t];break;case"Fixpoint":o=n.CounterExamples[t]}var h=[],c=[],l=[];if(r!==null){a=e.ParseBifurcations(r.Variables);v=e.CreateBifurcationsView(e.variables,a);h.push(v);c.push(["Cell","Name","Calculated Bound","Fix1","Fix2"]);var i=$("<div><\/div>").addClass("further-testing-tab"),b=$("<div><\/div>").addClass("bifurcations-icon").appendTo(i),k=$("<div><\/div>").text("Bifurcations").appendTo(i);l.push(i)}if(u!==null){y=e.ParseOscillations(u.Variables);p=e.CreateOscillationsView(e.variables,y);h.push(p);c.push(["Cell","Name","Calculated Bound","Oscillation"]);var i=$("<div><\/div>").addClass("further-testing-tab"),b=$("<div><\/div>").addClass("oscillations-icon").appendTo(i),k=$("<div><\/div>").text("Oscillations").appendTo(i);l.push(i)}if(o!==null&&r===null&&u===null)try{w=e.ParseFixPoint(o.Variables);window.Commands.Execute("ProofByFurtherTesting",{issucceeded:!0,message:"Further testing has been determined the model to be stable with the following stable state",fixPoint:w});s()}catch(d){e.messagebox.Show("Invalid service response");e.driver.ShowStartFurtherTestingToggler()}else e.data={tabLabels:l,tableHeaders:c,data:h},e.driver.ShowResults(e.data)}}else f.LogFurtherTestingError(),e.driver.ActiveMode(),e.messagebox.Show("Invalid service response")}).fail(function(){e.driver.ActiveMode();e.messagebox.Show("Invalid service response")})}else e.messagebox.Show("No Variables")});window.Commands.On("Expand",function(n){var t,i;switch(n){case"FurtherTesting":e.driver.HideStartFurtherTestingToggler();e.driver.HideResults();t=$("<div><\/div>").furthertesting();t.furthertesting("SetData",e.data);i=t.children().eq(1).children().eq(1);o.popupViewer.Show({tab:n,content:i});break;default:e.driver.ShowResults(e.data)}});window.Commands.On("Collapse",function(n){switch(n){case"FurtherTesting":e.driver.ShowResults(e.data);o.popupViewer.Hide()}})}return n.prototype.ParseOscillations=function(n){for(var f,u,t,i=[],r=0;r<n.length;r++)f=this.ParseId(n[r].Id),i[parseInt(f[0])]===undefined&&(i[parseInt(f[0])]=[]),i[parseInt(f[0])][parseInt(f[1])]=n[r].Value;for(u=[],t=0;t<i.length;t++)if(i[t]!==undefined){for(u[t]={min:i[t][0],max:i[t][0],oscillations:""},r=0;r<i[t].length-1;r++)i[t][r]<u[t].min&&(u[t].min=i[t][r]),i[t][r]>u[t].max&&(u[t].max=i[t][r]),u[t].oscillations+=i[t][r]+",";u[t].oscillations+=i[t][i[t].length-1]}return u},n.prototype.ParseBifurcations=function(n){for(var u,f,i,t=[],r=0;r<n.length;r++)u=this.ParseId(n[r].Id),t[parseInt(u[0])]===undefined&&(t[parseInt(u[0])]=[]),t[parseInt(u[0])][0]=parseInt(n[r].Fix1),t[parseInt(u[0])][1]=parseInt(n[r].Fix2);for(f=[],i=0;i<t.length;i++)t[i]!==undefined&&(f[i]={min:Math.min(t[i][0],t[i][1]),max:Math.max(t[i][0],t[i][1]),Fix1:t[i][0],Fix2:t[i][1]});return f},n.prototype.CreateOscillationsView=function(n,t){for(var u,f=this,r=[],i=0;i<n.length;i++)u=t[n[i].Id],r[i]=[],r[i][0]=function(){var t=f.appModel.Layout.GetContainerById(n[i].ContainerId);return t!==undefined?t.Name:""}(),r[i][1]=n[i].Name,r[i][2]=u.min+"-"+u.max,r[i][3]=u.oscillations;return r},n.prototype.CreateBifurcationsView=function(n,t){for(var r,f=this,u=[],i=0;i<n.length;i++)r=t[n[i].Id],u[i]=[],u[i][0]=function(){var t=f.appModel.Layout.GetContainerById(n[i].ContainerId);return t!==undefined?t.Name:""}(),u[i][1]=n[i].Name,u[i][2]=r.min!==r.max?r.min+"-"+r.max:r.min,u[i][3]=r.Fix1,u[i][4]=r.Fix2;return u},n.prototype.ParseFixPoint=function(n){var t=[],i=this;return n.forEach(function(n){t.push({Id:i.ParseId(n.Id)[0],Value:n.Value})}),t},n.prototype.ParseId=function(n){return n.split("^")},n}();n.FurtherTestingPresenter=t})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){var t;(function(n){var t=function(){function n(n,t,i,r,u,f){var e=this,o;this.appModel=n;this.driver=t;this.tool=i;this.messagebox=r;this.checker=u;o=e.tool.GetModelList();this.driver.SetItems(o);this.driver.Hide();window.Commands.On("LocalStorageChanged",function(){var n=e.tool.GetModelList();n===undefined||n.length==0?e.driver.Message("The model repository is empty"):e.driver.Message("");e.driver.SetItems(n)});window.Commands.On("LocalStorageRemoveModel",function(n){e.tool.RemoveModel(n)});window.Commands.On("LocalStorageRequested",function(){var n=e.tool.GetModelList();e.driver.SetItems(n);e.driver.Show()});window.Commands.On("LocalStorageSaveModel",function(){try{f.LogSaveModel();var t=n.BioModel.Name;e.tool.SaveModel(t,JSON.parse(n.Serialize()));e.checker.Snapshot(e.appModel)}catch(i){alert(i)}});window.Commands.On("LocalStorageLoadModel",function(t){function r(){e.tool.IsInRepo(t)?(n.Deserialize(JSON.stringify(e.tool.LoadModel(t))),e.checker.Snapshot(e.appModel)):(e.messagebox.Show("The model was removed from outside"),window.Commands.Execute("LocalStorageChanged",{}))}try{if(e.checker.IsChanged(e.appModel))var i=$("<div><\/div>").appendTo("body").userdialog({message:"Do you want to save changes?",functions:[function(){i.detach();window.Commands.Execute("LocalStorageSaveModel",{})},function(){i.detach();r()},function(){i.detach()}]});else r()}catch(u){alert(u);r()}});window.Commands.On("LocalStorageInitModel",function(t){e.tool.IsInRepo(t)&&(n.Deserialize(JSON.stringify(e.tool.LoadModel(t))),e.checker.Snapshot(e.appModel))});window.Commands.Execute("LocalStorageChanged",{})}return n}();n.LocalStoragePresenter=t})(t=n.Presenters||(n.Presenters={}))}(BMA||(BMA={})),function(n){function t(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t=="x"?i:i&3|8).toString(16)})}var i=function(){function n(){this.userId=$.cookie("BMAClient.UserID");this.userId===undefined&&(this.userId=t(),$.cookie("BMAClient.UserID",this.userId));this.sessionId=t();this.logIn=new Date;this.logOut=new Date;this.proofCount=0;this.simulationCount=0;this.furtherTestingCount=0;this.newModelCount=0;this.saveModelCount=0;this.importModelCount=0;this.proofErrorCount=this.furtherTestingErrorCount=this.simulationErrorCount=0}return n.prototype.LogProofError=function(){this.proofErrorCount++},n.prototype.LogSimulationError=function(){this.simulationErrorCount++},n.prototype.LogFurtherTestingError=function(){this.furtherTestingErrorCount++},n.prototype.LogProofRun=function(){this.proofCount++},n.prototype.LogSimulationRun=function(){this.simulationCount++},n.prototype.LogFurtherTestingRun=function(){this.furtherTestingCount++},n.prototype.LogNewModelCreated=function(){this.newModelCount++},n.prototype.LogImportModel=function(){this.importModelCount++},n.prototype.LogSaveModel=function(){this.saveModelCount++},n.prototype.CloseSession=function(){return this.logOut=new Date,{Proof:this.proofCount,Simulation:this.simulationCount,FurtherTesting:this.furtherTestingCount,NewModel:this.newModelCount,ImportModel:this.importModelCount,SaveModel:this.saveModelCount,LogIn:this.logIn.toJSON(),LogOut:this.logOut.toJSON(),UserID:this.userId,SessionID:this.sessionId,ProofErrorCount:this.proofErrorCount,SimulationErrorCount:this.simulationErrorCount,FurtherTestingErrorCount:this.furtherTestingErrorCount}},n}();n.SessionLog=i}(BMA||(BMA={})),function(n){var t=n.widget("BMA.bmaaccordion",{version:"1.11.0",options:{active:0,animate:{},collapsible:!0,event:"click",position:"center",activate:null,beforeActivate:null,contentLoaded:{ind:"",val:!0},z_index:0},hideProps:{},showProps:{},_create:function(){this.element.addClass("bma-accordion-container");var t=this.options;this.prevShow=this.prevHide=n();this.element.addClass("ui-accordion").attr("role","tablist");t.collapsible||t.active!==!1&&t.active!=null||(t.active=0);this._processPanels();t.active<0&&(t.active+=this.headers.length);this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():n()}},_destroy:function(){var n;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role");this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId();n=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId()},_processAnimation:function(n){var t=this,r=t.options.position,i=0;switch(r){case"left":case"right":i=n.outerWidth();break;case"top":case"bottom":i=n.outerHeight();break;case"center":return}this.hideProps={};this.showProps={};this.hideProps[t.options.position]="-="+i;this.showProps[t.options.position]="+="+i;n.css("z-index",t.options.z_index+1);this.headers.next().not(n).css("z-index",t.options.z_index)},_setOption:function(t,i){var r=this,u,f;if(t==="active"){this._activate(i);return}if(t==="event"&&(this.options.event&&this._off(this.headers,this.options.event),i.ind,this._setupEvents(i)),t=="contentLoaded"&&(typeof i.ind=="number"?(u=r.headers[i.ind][0]===r.active[0],r.loadingList[i.ind]=i.val):typeof i.ind=="string"?(u=n(i.ind)[0]===r.active[0],r.loadingList[r.headers.index(n(i.ind))]=i.val):typeof i.ind=="JQuery"&&(u=i.ind[0]===r.active[0],r.loadingList[r.headers.index(i.ind)]=i.val),i.val&&u&&(r._hideLoading(r.active),f={oldHeader:n(),oldPanel:n(),newHeader:r.active,newPanel:r.active.next()},r._toggle(f))),t=="position"){switch(i){case"left":case"right":case"top":case"bottom":case"center":r.options.position=i}return}t!=="collapsible"||i||this.options.active!==!1||this._activate(0);t==="disabled"&&(this.element.toggleClass("ui-state-disabled",!!i).attr("aria-disabled",i),this.headers.add(this.options.context).toggleClass("ui-state-disabled",!!i));this._super(t,i)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=n.ui.keyCode,u=this.headers.length,f=this.headers.index(t.target),r=undefined;switch(t.keyCode){case i.RIGHT:case i.DOWN:r=this.headers[(f+1)%u];break;case i.LEFT:case i.UP:r=this.headers[(f-1+u)%u];break;case i.ENTER:this._eventHandler(t);break;case i.HOME:r=this.headers[0];break;case i.END:r=this.headers[u-1]}r!==undefined&&(n(t.target).attr("tabIndex",-1),n(r).attr("tabIndex",0),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===n.ui.keyCode.UP&&t.ctrlKey},refresh:function(){var t=this.options;this._processPanels();(t.active!==!1||t.collapsible!==!0)&&this.headers.length?t.active===!1?this._activate(0):this.active.length&&!n.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=n()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active):(t.active=!1,this.active=n());this._refresh()},_processPanels:function(){var t=this,u=t.options.position,i;for(this.element.css(u,0),this.headers=t.element.children().filter(":even"),this.headers.addClass("bma-accordion-header"),this.loadingList=[],i=0;i<this.headers.length;i++){t.loadingList[i]=!0;var r=this.headers[i],f=n(r).next(),e=0;switch(u){case"left":case"right":e=f.outerWidth();n(r).css("top",(n(r).outerHeight()+10)*i);break;case"top":case"bottom":e=f.outerHeight();n(r).css("left",(n(r).outerWidth()+10)*i);break;case"center":t.headers.removeClass("accordion-expanded").addClass("accordion-collapsed");t.headers.next().hide();return}t.headers.css("position","absolute");t.headers.css(u,0);f.css("position","absolute");f.css(u,-e)}},_refresh:function(){var t=this.options,r=this.element.parent(),i;this.active=n();this.active.next().addClass("ui-accordion-content-active");i=this;this.headers.attr("role","tab").each(function(){var t=n(this),r=t.uniqueId().attr("id"),i=t.next(),u=i.uniqueId().attr("id");t.attr("aria-controls",u);i.attr("aria-labelledby",r)}).next().attr("role","tabpanel");this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide();this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0);this._setupEvents(t.event)},_findActive:function(t){return typeof t=="number"?this.headers.eq(t):n()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&n.each(t.split(" "),function(n,t){i[t]="eventHandler"});this._off(this.headers);this._on(this.headers,i);this._on(this.headers.next(),{keydown:"_panelKeyDown"})},eventHandler:function(t){var e=this.options,u=this.active,i=n(t.currentTarget).eq(0),f=i[0]===u[0],o=f&&e.collapsible,s=o?n():i.next(),h=this.loadingList[this.headers.index(this.active)]?u.next():n(),r={oldHeader:u,oldPanel:h,newHeader:i,newPanel:s};if(t.preventDefault(),(!f||e.collapsible)&&this._trigger("beforeActivate",t,r)!==!1){if(s.is(":hidden")&&window.Commands.Execute(i.attr("data-command"),{}),r.newHeader.css("z-index",this.options.z_index+2),this.headers.not(r.newHeader).css("z-index",this.options.z_index),this.active=f?n():i,!this.loadingList[this.headers.index(i)]){r.newPanel=n();o?this._hideLoading(i):(this._hideLoading(this.headers.not(i)),this._toggle(r),this._showLoading(i));return}this._toggle(r);u.removeClass("ui-accordion-header-active ui-state-active");f||(i.removeClass("ui-corner-all").addClass("ui-accordion-header-active  ui-corner-top"),i.addClass("ui-accordion-content-active"))}},_toggle:function(t){var r=t.newPanel,i=this.prevShow.length?this.prevShow:t.oldPanel,u=this;this.prevShow.add(this.prevHide).stop(!0,!0);this.prevShow=r;this.prevHide=i;u.options.animate&&u.options.position!="center"?u._animate(r,i,t):(i.hide(),r.show(),t.newHeader.next().is(":hidden")?t.newHeader.removeClass("accordion-expanded").removeClass("accordion-shadow").addClass("accordion-collapsed"):t.newHeader.removeClass("accordion-collapsed").addClass("accordion-expanded").addClass("accordion-shadow"),u._toggleComplete(t));i.attr({"aria-hidden":"true"});i.prev().attr("aria-selected","false");r.length&&i.length?i.prev().attr({tabIndex:-1,"aria-expanded":"false"}):r.length&&this.headers.filter(function(){return n(this).attr("tabIndex")===0}).attr("tabIndex",-1);r.attr("aria-hidden","false").prev().attr({"aria-selected":"true",tabIndex:0,"aria-expanded":"true"})},_showLoading:function(t){var r,i;for(t.animate({width:"+=60px"}),r=n('<div class="spinner loading"><\/div>').appendTo(t),i=1;i<4;i++)n("<div><\/div>").addClass("bounce"+i).appendTo(r)},_hideLoading:function(t){t.each(function(){var t=n(this).children().filter(".loading");t.length&&(t.detach(),n(this).animate({width:"-=60px"}))})},_animate:function(n,t,i){var f,e,r=this,h=n.length&&(!t.length||n.index()<t.index()),o=this.options.animate||{},u=h&&o.down||o,s=function(){r._toggleComplete(i)};if(typeof u=="number"&&(e=u),typeof u=="string"&&(f=u),f=f||u.easing||o.easing,e=e||u.duration||o.duration,r=this,this._hideLoading(this.headers.not(this.active)),!n.length){r._processAnimation(t);r.element.animate(r.hideProps,e,f,s);return}if(!t.length){r._processAnimation(n);n.show();r.element.animate(r.showProps,e,f,s);return}t.css("z-index",r.options.z_index);n.css("z-index",r.options.z_index+1);this._toggleComplete(i)},_toggleComplete:function(n){var t=n.oldPanel,i=n.newPanel;n.newPanel.css("z-index",this.options.z_index+1);t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all");t.hide();i.show();t.length&&(t.parent()[0].className=t.parent()[0].className);this._trigger("activate",null,n)}})}(jQuery),function(n){n.widget("BMA.bmazoomslider",{options:{step:10,value:0,min:0,max:100},_create:function(){var t=this,i,r,u;this.element.addClass("zoomslider-container");i=this.element.attr("data-command");r=n("<img>").attr("id","zoom-plus").attr("src","images/zoomplus.svg").addClass("hoverable").appendTo(t.element);this.zoomslider=n("<div><\/div>").appendTo(t.element);u=n("<img>").attr("id","zoom-minus").attr("src","images/zoomminus.svg").addClass("hoverable").appendTo(t.element);this.zoomslider.slider({min:t.options.min,max:t.options.max,value:t.options.value,change:function(){var n=t.zoomslider.slider("option","value"),u=n>t.options.max||n<t.options.min,r;u?(r=n>t.options.max?t.options.max:t.options.min,t.options.value=r,t.zoomslider.slider("option","value",r)):t.options.value=n;i!==undefined&&i!==""&&window.Commands.Execute(i,{value:n,isExternal:u})}});this.zoomslider.removeClass().addClass("zoomslider-bar");this.zoomslider.find("a").removeClass().addClass("zoomslider-pointer");r.bind("click",function(){var n=t.zoomslider.slider("option","value")-t.options.step;t.zoomslider.slider("option","value",n)});u.bind("click",function(){var n=t.zoomslider.slider("option","value")+t.options.step;t.zoomslider.slider("option","value",n)})},_destroy:function(){this.element.removeClass("zoomslider-container");this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"value":this.options.value!==t&&(this.options.value=t,this.zoomslider.slider("option","value",t));break;case"min":this.options.min=t;this.zoomslider.slider("option","min",t);break;case"max":this.options.max=t;this.zoomslider.slider("option","max",t)}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.coloredtableviewer",{options:{header:[],numericData:undefined,colorData:undefined,type:"standart"},_create:function(){this.refresh()},refresh:function(){var t,s,f,r,i,o,u,e;this.element.empty();f=this;t=this.options;this.table=n("<table><\/table>");this.table.appendTo(f.element);switch(t.type){case"standart":t.numericData!==undefined&&t.numericData!==null&&t.numericData.length!==0&&(this.table.addClass("variables-table"),this.createHeader(t.header),this.arrayToTable(t.numericData),t.colorData!==undefined&&this.paintTable(t.colorData));break;case"color":if(this.table.addClass("proof-propagation-overview"),t.colorData!==undefined&&t.colorData.length!==0)for(f=this,r=t.colorData,i=0;i<r.length;i++)for(o=n("<tr><\/tr>").appendTo(f.table),u=0;u<r[i].length;u++)e=n("<td><\/td>").appendTo(o),r[i][u]!==undefined&&(r[i][u]?e.addClass("propagation-cell-green"):e.addClass("propagation-cell-red"));break;case"graph-min":t.numericData!==undefined&&t.numericData!==null&&t.numericData.length!==0&&(this.table.addClass("variables-table"),this.createHeader(t.header),this.arrayToTableGraphMin(t.numericData),t.colorData!==undefined&&this.paintTable(t.colorData));break;case"graph-max":t.numericData!==undefined&&t.numericData!==null&&t.numericData.length!==0&&(this.table.addClass("variables-table"),this.createHeader(t.header),s=f.table.find("tr").eq(0),s.children("td").eq(0).attr("colspan","2"),s.children("td").eq(2).attr("colspan","2"),this.arrayToTableGraphMax(t.numericData),t.colorData!==undefined&&this.paintTable(t.colorData));break;case"simulation-min":if(this.table.addClass("proof-propagation-overview"),t.colorData!==undefined&&t.colorData.length!==0)for(f=this,r=t.colorData,i=0;i<r.length;i++)for(o=n("<tr><\/tr>").appendTo(f.table),u=0;u<r[i].length;u++)e=n("<td><\/td>").appendTo(o),r[i][u]&&e.addClass("change")}},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this;if(n==="header"&&(this.options.header=t),n==="numericData"&&(this.options.numericData=t),n==="colorData"&&(this.options.colorData=t,this.options.colorData!==undefined)){this.paintTable(this.options.colorData);return}this._super(n,t);t!==null&&t!==undefined&&this.refresh()},createHeader:function(t){for(var r=this,u=n("<tr><\/tr>").appendTo(r.table),i=0;i<t.length;i++)n("<td><\/td>").text(t[i]).appendTo(u)},arrayToTableGraphMin:function(t){for(var u,f,r,e=this,i=0;i<t.length;i++)for(u=n("<tr><\/tr>").appendTo(e.table),f=n("<td><\/td>").appendTo(u),t[i][0]!==undefined&&f.css("background-color",t[i][0]),r=1;r<t[i].length;r++)n("<td><\/td>").text(t[i][r]).appendTo(u)},arrayToTableGraphMax:function(t){for(var u,f,c,o,i=this,l=this.options.variables,r=0;r<t.length;r++){var e=n("<tr><\/tr>").appendTo(i.table),h=n("<td><\/td>").appendTo(e),s=n("<td><\/td>").appendTo(e);for(t[r][1]&&t[r][0]!==undefined&&(h.css("background-color",t[r][0]),s.addClass("plot-check")),s.bind("click",function(){n(this).toggleClass("plot-check");var r=n(this).hasClass("plot-check");r?(n(this).prev().css("background-color",t[n(this).parent().index()-1][0]),i.alldiv.attr("checked",i.checkAllButtons())):(i.alldiv.attr("checked",!1),n(this).prev().css("background-color","transparent"));window.Commands.Execute("ChangePlotVariables",{ind:n(this).parent().index()-1,check:r})}),u=2;u<t[r].length;u++)n("<td><\/td>").text(t[r][u]).appendTo(e)}this.buttons=i.table.find("tr").not(":first-child").find("td:nth-child(2)");f=n("<tr><\/tr>").appendTo(i.table);c=n("<td><\/td>").appendTo(f);this.allcheck=n('<td id="allcheck"><\/td>').appendTo(f).addClass("plot-check");o=n("<td><\/td>").appendTo(f);this.alldiv=n("<div><\/div>").attr("checked",i.checkAllButtons()).text("ALL").appendTo(o);o.css("border-left","none");this.allcheck.bind("click",function(){var t;if(i.alldiv.attr("checked",!i.alldiv.attr("checked")),i.alldiv.attr("checked"))for(t=0;t<i.buttons.length;t++)n(i.buttons[t]).hasClass("plot-check")||n(i.buttons[t]).click();else for(t=0;t<i.buttons.length;t++)n(i.buttons[t]).hasClass("plot-check")&&n(i.buttons[t]).click()})},getColors:function(){var r=this,t,i;this.options.type==="graph-max"&&(t=this.table.find("tr:not(:first-child)").children("td: nth-child(2)"),i=[],t.each(function(t){n(this).hasClass("plot-check")&&(i[t]=r.options.data.variables[t].color)}))},checkAllButtons:function(){for(var t=this,i=t.buttons.length,n=0;n<i;n++)if(!t.buttons.eq(n).hasClass("plot-check"))return!1;return!0},getAllButton:function(){if(this.allcheck!==undefined)return this.allcheck},arrayToTable:function(t){for(var u,r,f=this,i=0;i<t.length;i++)for(u=n("<tr><\/tr>").appendTo(f.table),r=0;r<t[i].length;r++)n("<td><\/td>").text(t[i][r]).appendTo(u)},paintTable:function(n){var r=this,e=r.table,o=0,t,u,i,f;for(r.options.header!==undefined&&r.options.header.length!==0&&(o=1),t=0;t<n.length;t++){if(u=e.find("tr").eq(t+o).children("td"),n[t].length>u.length){console.log("Incompatible sizes of numeric and color data-2");return}for(i=0;i<n[t].length;i++)f=u.eq(i),n[t][i]?f.addClass("propagation-cell-green"):f.addClass("propagation-cell-red")}return e}})}(jQuery),function(n){n.widget("BMA.containernameeditor",{options:{name:"name"},_create:function(){var t=this,i=n("<div><\/div>").addClass("close-icon").appendTo(t.element),r=n('<img src="../../images/close.png">').appendTo(i);r.bind("click",function(){t.element.hide()});this.element.addClass("container-name").draggable({containment:"parent",scroll:!1});this.name=n("<input>").attr("type","text").attr("size",15).attr("placeholder","Container Name").appendTo(t.element);this.name.bind("input change",function(){t.options.name=t.name.val();window.Commands.Execute("ContainerNameEdited",{})});this.name.val(t.options.name)},_setOption:function(t,i){var r=this;t==="name"&&(this.options.name=i,this.name.val(i));n.Widget.prototype._setOption.apply(this,arguments);this._super("_setOption",t,i)},destroy:function(){n.Widget.prototype.destroy.call(this)}})}(jQuery),function(n){n.widget("BMA.drawingsurface",{_plot:null,_gridLinesPlot:null,_svgPlot:null,_lightSvgPlot:null,_rectsPlot:null,_dragService:null,_zoomObs:undefined,_onlyZoomEnabled:!1,options:{isNavigationEnabled:!0,svg:undefined,zoom:50},_plotSettings:{MinWidth:.01,MaxWidth:1e5},_svgLoaded:function(){this.options.svg!==undefined&&this._svgPlot!==undefined&&(this._svgPlot.svg.clear(),this._svgPlot.svg.add(this.options.svg))},_lightSvgLoaded:function(){this.options.lightSvg!==undefined&&this._lightSvgPlot!==undefined&&(this._lightSvgPlot.svg.configure({"pointer-events":"none"},!1),this._lightSvgPlot.svg.clear(),this._lightSvgPlot.svg.add(this.options.svg))},_create:function(){var i=this,r,u,e,f,o;window.PlotSettings!==undefined&&(this._plotSettings=window.PlotSettings);var t=n("<div><\/div>").width(this.element.width()).height(this.element.height()).attr("data-idd-plot","plot").appendTo(i.element),s=n("<div><\/div>").attr("data-idd-plot","scalableGridLines").appendTo(t),h=n("<div><\/div>").attr("data-idd-plot","rectsPlot").appendTo(t),c=n("<div><\/div>").attr("data-idd-plot","svgPlot").appendTo(t),l=n("<div><\/div>").attr("data-idd-plot","svgPlot").appendTo(t);if(i._plot=InteractiveDataDisplay.asPlot(t),this._plot.aspectRatio=1,r=i._plot.get(c[0]),this._svgPlot=r,u=i._plot.get(l[0]),this._lightSvgPlot=u,this._rectsPlot=i._plot.get(h[0]),this.options.svg!==undefined)if(r.svg===undefined)r.host.on("svgLoaded",this._svgLoaded);else r.svg.clear(),r.svg.add(this.options.svg);if(u.svg===undefined)u.host.on("svgLoaded",this._lightSvgLoaded);else u.svg.clear(),this.options.lightSvg!==undefined&&u.svg.add(this.options.lightSvg);t.droppable({drop:function(n){if(i.options.isNavigationEnabled!==!0){var u=r.getScreenToDataTransform();window.Commands.Execute("DrawingSurfaceClick",{x:u.screenToDataX(n.pageX-t.offset().left),y:-u.screenToDataY(n.pageY-t.offset().top)})}}});t.bind("click touchstart",function(n){var i=r.getScreenToDataTransform();n.originalEvent!==undefined&&(n=n.originalEvent);window.Commands.Execute("DrawingSurfaceClick",{x:i.screenToDataX(n.pageX-t.offset().left),y:-i.screenToDataY(n.pageY-t.offset().top),screenX:n.pageX-t.offset().left,screenY:n.pageY-t.offset().top})});t.dblclick(function(n){var i=r.getScreenToDataTransform();n.originalEvent!==undefined&&(n=n.originalEvent);window.Commands.Execute("DrawingSurfaceDoubleClick",{x:i.screenToDataX(n.pageX-t.offset().left),y:-i.screenToDataY(n.pageY-t.offset().top)})});var a=function(i){var u=n(document),f=i.onAsObservable("mousedown"),e=i.onAsObservable("mousemove"),o=u.onAsObservable("mouseup"),s=o,h=f.selectMany(function(n){var i=r.getScreenToDataTransform(),u=i.screenToDataX(n.pageX-t.offset().left),f=-i.screenToDataY(n.pageY-t.offset().top);return e.select(function(n){var r=i.screenToDataX(n.pageX-t.offset().left),e=-i.screenToDataY(n.pageY-t.offset().top);return{x0:u,y0:f,x1:r,y1:e}}).takeUntil(s)}),c=i.onAsObservable("touchstart"),l=i.onAsObservable("touchmove"),a=u.onAsObservable("touchend"),v=u.onAsObservable("touchcancel"),y=c.selectMany(function(n){var i=r.getScreenToDataTransform(),u=i.screenToDataX(n.originalEvent.pageX-t.offset().left),f=-i.screenToDataY(n.originalEvent.pageY-t.offset().top);return l.takeUntil(a.merge(v)).select(function(n){var r=i.screenToDataX(n.originalEvent.pageX-t.offset().left),e=-i.screenToDataY(n.originalEvent.pageY-t.offset().top);return{x0:u,y0:f,x1:r,y1:e}})});return h.merge(y)},v=function(i){var u=n(document),e=i.onAsObservable("mousedown").where(function(n){return n.button===0}),o=i.onAsObservable("mousemove"),f=u.onAsObservable("mouseup"),v=f,s=e.selectMany(function(n){var i=r.getScreenToDataTransform(),u=i.screenToDataX(n.pageX-t.offset().left),e=-i.screenToDataY(n.pageY-t.offset().top);return o.select(function(){return{x:u,y:e}}).first().takeUntil(f)}),h=i.onAsObservable("touchstart"),c=i.onAsObservable("touchmove"),l=u.onAsObservable("touchend"),a=u.onAsObservable("touchcancel"),y=h.selectMany(function(n){var i=r.getScreenToDataTransform(),u=i.screenToDataX(n.originalEvent.pageX-t.offset().left),f=-i.screenToDataY(n.originalEvent.pageY-t.offset().top);return c.select(function(){return{x:u,y:f}}).first().takeUntil(l.merge(a))});return s},y=function(t){var r=n(document),s=i._plot.centralPart.onAsObservable("mousedown"),h=t.onAsObservable("mousemove"),u=r.onAsObservable("mouseup"),f=r.onAsObservable("touchend"),e=r.onAsObservable("touchcancel"),o=u.merge(f).merge(e);return o};this._dragService={dragStart:v(i._plot.centralPart),drag:a(i._plot.centralPart),dragEnd:y(i._plot.centralPart)};this._gridLinesPlot=i._plot.get(s[0]);e=new InteractiveDataDisplay.DataTransform(function(n){return-n},function(n){return-n},undefined);this._plot.yDataTransform=e;f=1600;i.options.zoom=f;this.options.isNavigationEnabled?(o=InteractiveDataDisplay.Gestures.getGesturesStream(i._plot.host).where(function(n){return n.Type!=="Zoom"||n.scaleFactor>1&&i._plot.visibleRect.width<i._plotSettings.MaxWidth||n.scaleFactor<1&&i._plot.visibleRect.width>i._plotSettings.MinWidth}),i._plot.navigation.gestureSource=o):i._plot.navigation.gestureSource=undefined;i._plot.navigation.setVisibleRect({x:0,y:-50,width:f,height:f/2.5},!1);i._plot.host.bind("visibleRectChanged",function(){Math.round(i._plot.visibleRect.width)!==i.options.zoom&&window.Commands.Execute("VisibleRectChanged",i._plot.visibleRect.width)});n(window).resize(function(){i.resize()});i.resize();this.refresh()},resize:function(){this._plot!==null&&this._plot!==undefined&&(this._plot.host.width(this.element.width()),this._plot.host.height(this.element.height()),this._plot.requestUpdateLayout())},_setOption:function(n,t){var i=this,u;switch(n){case"svg":this._svgPlot!==undefined&&this._svgPlot.svg!==undefined&&(this._svgPlot.svg.clear(),t!==undefined&&this._svgPlot.svg.add(t));break;case"lightSvg":this._lightSvgPlot!==undefined&&this._lightSvgPlot.svg!==undefined&&(this._lightSvgPlot.svg.clear(),t!==undefined&&this._lightSvgPlot.svg.add(t));break;case"isNavigationEnabled":t===!0?this._onlyZoomEnabled===!0&&(u=InteractiveDataDisplay.Gestures.getGesturesStream(this._plot.host).where(function(n){return n.Type!=="Zoom"||n.scaleFactor>1&&i._plot.visibleRect.width<i._plotSettings.MaxWidth||n.scaleFactor<1&&i._plot.visibleRect.width>i._plotSettings.MinWidth}),this._plot.navigation.gestureSource=u,this._onlyZoomEnabled=!1):(u=InteractiveDataDisplay.Gestures.getGesturesStream(this._plot.host).where(function(n){return n.Type==="Zoom"&&(n.scaleFactor>1&&i._plot.visibleRect.width<i._plotSettings.MaxWidth||n.scaleFactor<1&&i._plot.visibleRect.width>i._plotSettings.MinWidth)}),this._plot.navigation.gestureSource=u,this._onlyZoomEnabled=!0);break;case"grid":t!==undefined&&(this._gridLinesPlot.x0=t.x0,this._gridLinesPlot.y0=t.y0,this._gridLinesPlot.xStep=t.xStep,this._gridLinesPlot.yStep=t.yStep,this._plot.requestUpdateLayout());break;case"zoom":if(t!==undefined&&i._plot.visibleRect.width!==t){var r=i._plot.visibleRect,o=r.x+r.width/2,s=r.y+r.height/2,h=r.width/t,f=r.height/h,e={x:o-t/2,y:s-f/2,width:t,height:f};console.log(e.y);i._plot.navigation.setVisibleRect(e,!1);i.options.zoom=t}break;case"visibleRect":t!==undefined&&i._plot.navigation.setVisibleRect({x:t.x,y:-t.y-t.height,width:t.width,height:t.height},!1);break;case"gridVisibility":this._gridLinesPlot.isVisible=t;this._plot.requestUpdateLayout();break;case"rects":this._rectsPlot.draw({rects:t});this._plot.requestUpdateLayout()}this._super(n,t)},_setOptions:function(n){this._super(n);this.refresh()},refresh:function(){},_constrain:function(n){return n},destroy:function(){this.element.empty()},getDragSubject:function(){return this._dragService},getPlotX:function(n){var t=this._svgPlot.getScreenToDataTransform();return t.screenToDataX(n)},getPlotY:function(n){var t=this._svgPlot.getScreenToDataTransform();return-t.screenToDataY(n)},getPixelWidth:function(){var n=this._svgPlot.getScreenToDataTransform();return n.screenToDataX(1)-n.screenToDataX(0)},getZoomSubject:function(){return this._zoomService},setCenter:function(n){var t=this._plot.visibleRect;this._plot.navigation.setVisibleRect({x:n.x-t.width/2,y:n.y-t.height/2,width:t.width,height:t.height},!1)},getSVG:function(){return this._svgPlot.svg}})}(jQuery),function(n){n.widget("BMA.progressiontable",{options:{interval:undefined,data:undefined,header:"Initial Value",init:undefined},_create:function(){var t=this,r=t.options,i=n("<div><\/div>").addClass("randomise-button").appendTo(t.element.parent().parent()),u=n("<div><\/div>").addClass("bma-random-icon2").appendTo(i),f=n("<div><\/div>").text("Randomise").appendTo(i);t.element.addClass("simulation-progression-table-container");this.init=n("<div><\/div>").appendTo(t.element);this.RefreshInit();this.data=n("<div><\/div>").addClass("bma-simulation-data-table").appendTo(t.element);this.InitData();i.bind("click",function(){var n=t.init.find("tr").not(":first-child").children("td:nth-child(2)");n.click()})},InitData:function(){var n,t;if(this.ClearData(),this.options.data!==undefined&&this.options.data.length!==0&&(n=this.options.data,n[0].length===this.options.interval.length))for(t=0;t<n.length;t++)this.AddData(n[t])},RefreshInit:function(){var t=this,c=this.options,r,f,i,s;if(this.init.empty(),r=n("<table><\/table>").addClass("variables-table").appendTo(t.init),f=n("<tr><\/tr>").appendTo(r),t.options.header!==undefined&&n("<td><\/td>").width(120).attr("colspan","2").text(t.options.header).appendTo(f),t.options.interval!==undefined)for(i=0;i<t.options.interval.length;i++){var e=n("<tr><\/tr>").appendTo(r),h=n("<td><\/td>").appendTo(e),o=n('<input type="text">').width("100%").appendTo(h),u=t.options.init!==undefined?t.options.init[i]||t.options.interval[i]:t.options.interval[i];Array.isArray(u)?o.val(u[0]):o.val(u);s=n("<td><\/td>").addClass("random-small bma-random-icon2 hoverable").appendTo(e);s.bind("click",function(){var u=parseInt(n(this).prev().children("input").eq(0).val()),i=n(this).parent().index()-1,r=t.GetRandomInt(parseInt(t.options.interval[i][0]),parseInt(t.options.interval[i][1]));n(this).prev().children("input").eq(0).val(r);r!==u?n(this).parent().addClass("red"):n(this).parent().removeClass("red")})}},FindClone:function(n){for(var i,r=this.data.find("tr"),u=r.eq(0),t=0;t<u.children("td").length-1;t++)if(i=r.children("td:nth-child("+(t+1)+")"),this.IsClone(n,i))return this.repeat===undefined&&(this.repeat=i),t;return undefined},IsClone:function(n,t){var r,i;if(n.length!==t.length)return!1;for(r=[],i=0;i<n.length;i++)if(r[i]=n.eq(i).text()+" "+t.eq(i).text(),n.eq(i).text()!==t.eq(i).text())return!1;return!0},GetInit:function(){var t=[],i=this.init.find("tr:not(:first-child)").children("td:first-child").children("input");return i.each(function(i){t[i]=parseInt(n(this).val())}),t},ClearData:function(){this.data.empty()},AddData:function(t){var i=this,u,o,r,s,h,f,e;if(t!==undefined)if(u=i.data.find("tr"),u.length===0)for(i.repeat=undefined,o=n("<table><\/table>").addClass("progression-table").appendTo(i.data),r=0;r<t.length;r++)s=n("<tr><\/tr>").appendTo(o),h=n("<td><\/td>").text(t[r]).appendTo(s);else u.each(function(i){var r=n("<td><\/td>").text(t[i]).appendTo(n(this));r.text()!==r.prev().text()&&r.addClass("change")}),f=i.data.find("tr").children("td:last-child"),i.repeat!==undefined?i.IsClone(i.repeat,f)&&i.Highlight(i.data.find("tr:first-child").children("td").length-1):(e=i.FindClone(f),e!==undefined&&(i.Highlight(e),i.Highlight(i.data.find("tr:first-child").children("td").length-1)))},Highlight:function(t){var r=this,i=this.data.find("tr").children("td:nth-child("+(t+1)+")");i.each(function(){n(this).addClass("repeat")})},GetRandomInt:function(n,t){return Math.floor(Math.random()*(t-n+1)+n)},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"interval":this.options.interval=t;this.RefreshInit();break;case"header":this.options.header=t;break;case"init":this.options.init=t;this.RefreshInit();break;case"data":this.options.data=t;this.InitData()}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.proofresultviewer",{options:{issucceeded:!0,time:0,data:undefined,message:""},refreshSuccess:function(){var i=this,t=this.options;this.resultDiv.empty();switch(t.issucceeded){case!0:n('<img src="../../images/succeeded.svg">').appendTo(this.resultDiv);n("<div><\/div>").addClass("stabilize-prooved").text("Stabilizes").appendTo(this.resultDiv);break;case!1:n('<img src="../../images/failed.svg">').appendTo(this.resultDiv);n("<div><\/div>").addClass("stabilize-failed").text("Failed to Stabilize").appendTo(this.resultDiv);break;case undefined:n('<img src="../../images/failed.svg">').appendTo(this.resultDiv);n("<div><\/div>").addClass("stabilize-failed").text("Service Error").appendTo(this.resultDiv)}},refreshMessage:function(){this.proofmessage.text(this.options.message)},refreshData:function(){var u=this,t=this.options,i,r;this.compactvariables.resultswindowviewer();this.proofPropagation.resultswindowviewer();t.data!==undefined&&t.data.numericData!==undefined&&t.data.numericData!==null&&t.data.numericData.length!==0?(i=n("<div><\/div>").addClass("scrollable-results").coloredtableviewer({header:["Name","Formula","Range"],numericData:t.data.numericData,colorData:t.data.colorVariables}),this.compactvariables.resultswindowviewer({header:"Variables",content:i,icon:"max",tabid:"ProofVariables"}),t.data.colorData!==undefined&&t.data.colorData!==null&&t.data.colorData.length!==0&&(r=n("<div><\/div>").addClass("scrollable-results").coloredtableviewer({type:"color",colorData:t.data.colorData}),this.proofPropagation.resultswindowviewer({header:"Proof Propagation",content:r,icon:"max",tabid:"ProofPropagation"}))):(this.compactvariables.resultswindowviewer("destroy"),this.proofPropagation.resultswindowviewer("destroy"))},show:function(n){n===undefined&&(this.compactvariables.show(),this.proofPropagation.show());n==="ProofVariables"&&this.compactvariables.show();n==="ProofPropagation"&&this.proofPropagation.show()},hide:function(n){n==="ProofVariables"&&(this.compactvariables.hide(),this.element.children().not(this.compactvariables).show());n==="ProofPropagation"&&(this.proofPropagation.hide(),this.element.children().not(this.proofPropagation).show())},_create:function(){var t=this,i=this.options;this.resultDiv=n("<div><\/div>").addClass("proof-state").appendTo(t.element);this.proofmessage=n("<p><\/p>").appendTo(t.element);n("<br><\/br>").appendTo(t.element);this.compactvariables=n("<div><\/div>").addClass("proof-variables").appendTo(t.element).resultswindowviewer();this.proofPropagation=n("<div><\/div>").addClass("proof-propagation").appendTo(t.element).resultswindowviewer();this.refreshSuccess();this.refreshMessage();this.refreshData()},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"issucceeded":this.options.issucceeded=t;this.refreshSuccess();break;case"data":this.options.data=t;this.refreshData();break;case"message":this.options.message=t;this.refreshMessage()}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.furthertesting",{options:{header:"Further Testing",toggler:undefined,tabid:"FurtherTesting",buttonMode:"ActiveMode",tableHeaders:[],data:[],tabLabels:[]},ChangeMode:function(){var r=this,i,t;switch(this.options.buttonMode){case"ActiveMode":this.toggler.removeClass("waiting").text("Further Testing");break;case"StandbyMode":for(this.toggler.addClass("waiting").text(""),i=n('<div class="spinner"><\/div>').appendTo(this.toggler),t=1;t<4;t++)n("<div><\/div>").addClass("bounce"+t).appendTo(i)}},_create:function(){var t=this,r=this.options,i=n("<button><\/button>").text("Further Testing").addClass("action-button-small red further-testing-button");this.element.addClass("further-testing-box");this.toggler=t.options.toggler||i;this.toggler.appendTo(this.element).hide();this.toggler.bind("click",function(){window.Commands.Execute("FurtherTestingRequested",{})});this.results=n("<div><\/div>").appendTo(this.element).resultswindowviewer();this.refresh()},refresh:function(){var t=this,s=this.options,r=n("<div><\/div>"),o=n("<ul><\/ul>").appendTo(r),u,f,i,e;if(t.options.data!==null&&t.options.data!==undefined&&t.options.tabLabels!==null&&t.options.tabLabels!==undefined&&t.options.tableHeaders!==null&&t.options.tableHeaders!==undefined){for(i=0;i<t.options.data.length;i++)u=n("<li><\/li>").appendTo(o),f=n('<a href="#FurtherTestingTab'+i+'"><\/a>').appendTo(u),t.options.tabLabels[i].appendTo(f);for(i=0;i<t.options.data.length;i++)e=n("<div><\/div>").attr("id","FurtherTestingTab"+i).addClass("scrollable-results").coloredtableviewer({numericData:t.options.data[i],header:t.options.tableHeaders[i]}).appendTo(r),e.find("table").removeClass("variables-table").addClass("furhter-testing");r.tabs();r.removeClass("ui-widget ui-widget-content ui-corner-all");r.children("ul").removeClass("ui-helper-reset ui-widget-header ui-corner-all");r.children("div").removeClass("ui-tabs-panel ui-widget-content ui-corner-bottom");this.results.resultswindowviewer({header:t.options.header,content:r,icon:"max",tabid:t.options.tabid})}else this.results.resultswindowviewer(),this.results.resultswindowviewer("destroy");this.ChangeMode()},GetToggler:function(){return this.toggler},ShowStartToggler:function(){this.toggler.show()},SetData:function(n){n!==undefined?(this.options.data=n.data,this.options.tableHeaders=n.tableHeaders,this.options.tabLabels=n.tabLabels):this.options.data=this.options.tableHeaders=this.options.tabLabels=undefined;this.refresh()},HideStartToggler:function(){this.toggler.hide()},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"header":this.options.header=t;this.header.text(t);break;case"data":this.options.data=t;this.refresh();break;case"buttonMode":this.options.buttonMode=t;this.ChangeMode()}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.localstoragewidget",{options:{items:[]},_create:function(){var i=this,e=this.options.items;this.element.addClass("model-repository");var o=n("<span><\/span>").text("Repository").addClass("window-title").appendTo(i.element),r=n("<div><\/div>").addClass("close-icon").appendTo(i.element),u=n('<img src="../../images/close.png">').appendTo(r);if(u.bind("click",function(){i.element.hide()}),i.element.draggable({containment:"parent",scroll:!1}),this.message=n("<div><\/div>").appendTo(this.element),this.repo=n("<div><\/div>").appendTo(this.element),Silverlight.isInstalled()){var f=n("<div><\/div>").appendTo(this.element),t="<a href='{1}' style='text-decoration: none;'><img src='{2}' alt='{3}' style='border-style: none'/><\/a>";t=t.replace("{1}",'javascript:Silverlight.getSilverlight("5.0.61118.0");');t=t.replace("{2}","http://go.microsoft.com/fwlink/?LinkId=161376");t=t.replace("{3}","Get Microsoft Silverlight");Silverlight.createObject("ClientBin/BioCheck.xap",f[0],"slPlugin",{width:"250",height:"50",background:"white",alt:t,version:"5.0.61118.0"},{onError:onSilverlightError},"param1=value1,param2=value2","row3")}this.refresh()},refresh:function(){this._createHTML()},AddItem:function(n){this.options.items.push(n);this.refresh()},_createHTML:function(t){var t=this.options.items,f,i,r,u;for(this.repo.empty(),f=this,this.ol=n("<ol><\/ol>").appendTo(this.repo),i=0;i<t.length;i++)r=n("<li><\/li>").text(t[i]).appendTo(this.ol),u=n("<button><\/button>").addClass("delete icon-delete").appendTo(r),u.bind("click",function(i){i.stopPropagation();window.Commands.Execute("LocalStorageRemoveModel","user."+t[n(this).parent().index()])});this.ol.selectable({stop:function(){window.Commands.Execute("LocalStorageLoadModel","user."+t[n(this).find(".ui-selected").eq(0).index()])}})},Message:function(n){this.message.text(n)},_setOption:function(t,i){switch(t){case"items":this.options.items=i;this.refresh()}n.Widget.prototype._setOption.apply(this,arguments);this._super("_setOption",t,i)},destroy:function(){n.Widget.prototype.destroy.call(this);this.element.empty()}})}(jQuery),function(n){n.widget("BMA.resultswindowviewer",{options:{content:n(),header:"",icon:"",effects:{effect:"size",easing:"easeInExpo",duration:200,complete:function(){}},tabid:""},reseticon:function(){var i=this,r=this.options,t;this.buttondiv.empty();t="";t=this.options.icon==="max"?"../../images/maximize.png":this.options.icon==="min"?"../../images/minimize.png":this.options.icon;this.button=n("<img src="+t+">").addClass("expand-window-icon");this.button.appendTo(this.buttondiv);this.button.bind("click",function(){r.icon==="max"&&window.Commands.Execute("Expand",i.options.tabid);r.icon==="min"&&window.Commands.Execute("Collapse",i.options.tabid)})},refresh:function(){var t=this,n=this.options;this.content.detach();n.content!==undefined&&(this.content=n.content.appendTo(t.element))},_create:function(){var t=this,i=this.options;this.header=n("<div><\/div>").addClass("analysis-title").appendTo(this.element);n("<span><\/span>").text(i.header).appendTo(this.header);this.buttondiv=n("<div><\/div>").addClass("expand-collapse-bttn").appendTo(t.header);this.content=n("<div><\/div>").appendTo(this.element);this.reseticon();this.refresh()},toggle:function(){this.element.toggle(this.options.effects)},getbutton:function(){return this.button},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"header":this.header.children("span").text(t);break;case"content":this.options.content!==t&&(this.options.content=t,this.refresh());break;case"icon":this.options.icon=t;this.reseticon()}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.simulationplot",{options:{colors:undefined},_create:function(){var n=this;this.refresh();this.element.addClass("simulation-plot-box")},refresh:function(){var r=this,i=this.options,l,a,s,h,e,u,f,t;if(this.element.empty(),this.chartdiv=n('<div id="chart"><\/div>').attr("data-idd-plot","figure").width("70%").height("100%").css("float","left").appendTo(r.element),l=n("<div><\/div>").addClass("simulationplot-legend-legendcontainer").appendTo(r.element),a=n("<div><\/div>").attr("id","glPlot").attr("data-idd-plot","scalableGridLines").appendTo(this.chartdiv),r._chart=InteractiveDataDisplay.asPlot(r.chartdiv),r.options.colors!==undefined&&r.options.colors!==null){for(t=0;t<r.options.colors.length;t++)e=i.colors[t].Name===""||i.colors[t].Name===undefined?"plot"+t:i.colors[t].Name,r._chart.polyline(e,undefined);r._chart.isAutoFitEnabled=!0;this._gridLinesPlot=r._chart.get(a[0]);this._gridLinesPlot.x0=0;this._gridLinesPlot.y0=0;this._gridLinesPlot.xStep=1;this._gridLinesPlot.yStep=1;var v=[],y=[],o=0;if(i.colors!==undefined){for(t=0;t<i.colors.length;t++){s=i.colors[t].Plot;h=r.Max(s);h>o&&(o=h);e=i.colors[t].Name===""||i.colors[t].Name===undefined?"plot"+t:i.colors[t].Name;u=r._chart.get(e);u!==undefined&&(u.stroke=i.colors[t].Color,u.isVisible=i.colors[t].Seen,u.draw({y:s,thickness:4,lineJoin:"round"}));f=n("<div><\/div>").addClass("simulationplot-legend-legenditem").attr("data-index",t).appendTo(l);i.colors[t].Seen||f.hide();var p=n("<div><\/div>").addClass("simulationplot-legend-colorboxcontainer").appendTo(f),nt=n("<div><\/div>").addClass("simulationplot-legend-colorbox").css("background-color",i.colors[t].Color).appendTo(p),tt=n("<div><\/div>").text(i.colors[t].Name).addClass("simulationplot-legend-namebox").appendTo(f);f.hover(function(){var e=parseInt(n(this).attr("data-index")),u=r.highlightPlot,t,o,f;if(u!==undefined)for(u.stroke=i.colors[e].Color,u.isVisible=!0,u.draw({y:i.colors[e].Plot,thickness:8,lineJoin:"round"}),t=0;t<i.colors.length;t++)o=i.colors[t].Name===""||i.colors[t].Name===undefined?"plot"+t:i.colors[t].Name,f=r._chart.get(o),f!==undefined&&(f.stroke="lightgray")},function(){var u=r.highlightPlot,n,f,t;if(u!==undefined)for(u.isVisible=!1,n=0;n<i.colors.length;n++)f=i.colors[n].Name===""||i.colors[n].Name===undefined?"plot"+n:i.colors[n].Name,t=r._chart.get(f),t!==undefined&&(t.stroke=i.colors[n].Color)})}for(t=0;t<i.colors[0].Plot.length;t++)v[t]=t.toString();for(t=0;t<o+1;t++)y[t]=t.toString()}this.highlightPlot=r._chart.polyline("_hightlightPlot",undefined);var w=r._chart.addAxis("bottom","labels",{labels:v}),b=r._chart.addAxis("left","labels",{labels:y}),c=r._chart.aggregateBounds();c.bounds.height+=.04;c.bounds.y-=.02;r._chart.navigation.setVisibleRect(c.bounds,!1);var k=InteractiveDataDisplay.Gestures.getGesturesStream(r._chart.centralPart),d=InteractiveDataDisplay.Gestures.applyHorizontalBehavior(InteractiveDataDisplay.Gestures.getGesturesStream(w)),g=InteractiveDataDisplay.Gestures.applyVerticalBehavior(InteractiveDataDisplay.Gestures.getGesturesStream(b));r._chart.navigation.gestureSource=k.merge(d.merge(g))}},Max:function(n){var i,t;if(n!==null&&n!==undefined){for(i=n[0],t=0;t<n.length;t++)n[t]>i&&(i=n[t]);return i}return undefined},getPlot:function(){return this._chart},ChangeVisibility:function(n,t){var r=this.options.colors[n].Name===""||this.options.colors[n].Name===undefined?"plot"+n:this.options.colors[n].Name,u=this._chart.get(r),i;this.options.colors[n].Seen=t;u.isVisible=t;i=this.element.find(".simulationplot-legend-legenditem[data-index="+n+"]");t?i.show():i.hide()},_destroy:function(){var n=this;this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"colors":this.options.colors=t}t!==null&&t!==undefined&&this.refresh();this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.simulationexpanded",{options:{data:undefined,init:undefined,interval:undefined,variables:undefined,num:10,buttonMode:"ActiveMode",step:10},_create:function(){var t=this,i=t.options,f=n("<div><\/div>").addClass("scrollable-results").appendTo(this.element),e,o,s;this.small_table=n("<div><\/div>").addClass("small-simulation-popout-table").appendTo(f);this.big_table=n("<div><\/div>").addClass("big-simulation-popout-table").appendTo(f);e=n("<div><\/div>").addClass("steps-container").appendTo(t.element);this.big_table.progressiontable();i.variables!==undefined&&(this.small_table.coloredtableviewer({header:["Graph","Name","Range"],type:"graph-max",numericData:t.options.variables}),i.interval!==undefined&&i.interval.length!==0&&this.big_table.progressiontable({init:i.init,interval:i.interval,data:i.data}));var u=this.options.step,r=n("<ul><\/ul>").addClass("button-list").appendTo(e),h=n("<li><\/li>").addClass("action-button-small grey").appendTo(r),c=n("<li><\/li>").appendTo(r),l=n("<li><\/li>").addClass("steps").appendTo(r),a=n("<li><\/li>").appendTo(r),v=n("<li><\/li>").addClass("action-button green").appendTo(r),y=n("<button><\/button>").text("Export CSV").appendTo(h);y.bind("click",function(){window.Commands.Execute("ExportCSV",{})});o=n("<button><\/button>").text("+ "+u).appendTo(c);o.bind("click",function(){t._setOption("num",t.options.num+u)});this.num=n("<button><\/button>").text("STEPS: "+t.options.num).appendTo(l);s=n("<button><\/button>").text("- "+u).appendTo(a);s.bind("click",function(){t._setOption("num",t.options.num-u)});this.RunButton=n("<button><\/button>").addClass("run-button").text("Run").appendTo(v);this.refresh()},ChangeMode:function(){var r=this,t,u,i;switch(this.options.buttonMode){case"ActiveMode":t=this.RunButton.parent();t.removeClass("waiting");t.find(".spinner").detach();this.RunButton.text("Run");this.RunButton.bind("click",function(){r.big_table.progressiontable("ClearData");window.Commands.Execute("RunSimulation",{data:r.big_table.progressiontable("GetInit"),num:r.options.num})});break;case"StandbyMode":for(t=this.RunButton.parent(),t.addClass("waiting"),this.RunButton.text(""),u=n('<div class="spinner"><\/div>').appendTo(this.RunButton),i=1;i<4;i++)n("<div><\/div>").addClass("bounce"+i).appendTo(u);this.RunButton.unbind("click")}},refresh:function(){var t=this,n=this.options;n.variables!==undefined&&(this.small_table.coloredtableviewer({header:["Graph","Name","Range"],type:"graph-max",numericData:t.options.variables}),n.interval!==undefined&&n.interval.length!==0&&this.big_table.progressiontable({interval:n.interval,data:n.data}));this.ChangeMode()},AddResult:function(n){this.big_table.progressiontable("AddData",n)},getColors:function(){this.small_table.coloredtableviewer("GetColors")},_destroy:function(){this.element.empty()},_setOption:function(n,t){var r=this,i=this.options;switch(n){case"data":this.options.data=t;i.interval!==undefined&&i.interval.length!==0&&this.big_table.progressiontable({interval:i.interval,data:i.data});break;case"init":this.options.init=t;this.big_table.progressiontable({init:t});break;case"num":t<0&&(t=0);this.options.num=t;this.num.text("STEPS: "+t);break;case"variables":this.options.variables=t;this.small_table.coloredtableviewer({header:["Graph","Name","Range"],type:"graph-max",numericData:r.options.variables});case"interval":this.options.interval=t;this.big_table.progressiontable({interval:t});break;case"buttonMode":this.options.buttonMode=t;this.ChangeMode()}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.simulationviewer",{options:{data:undefined,plot:undefined},refresh:function(){var t=this,i=this.options.data,r=n("<div><\/div>").addClass("marginable"),u,f;i!==undefined&&i.variables!==undefined&&i.variables.length!==0?(u=n("<div><\/div>").appendTo(r).addClass("scrollable-results"),u.coloredtableviewer({header:["Graph","Cell","Name","Range"],type:"graph-min",numericData:i.variables}),i.colorData!==undefined&&i.colorData.length!==0&&(f=n("<div><\/div>").addClass("scrollable-results").appendTo(r).coloredtableviewer({type:"simulation-min",colorData:i.colorData})),t.variables.resultswindowviewer({header:"Variables",content:r,icon:"max",tabid:"SimulationVariables"})):(this.variables.resultswindowviewer(),t.variables.resultswindowviewer("destroy"));t.options.plot!==undefined&&t.options.plot.length!==0?(t.plot=n("<div><\/div>").addClass("plot-min").simulationplot({colors:t.options.plot}),t.plotDiv.resultswindowviewer({header:"Simulation Graph",content:t.plot,icon:"max",tabid:"SimulationPlot"})):(t.plotDiv.resultswindowviewer(),t.plotDiv.resultswindowviewer("destroy"))},_create:function(){var t=this;this.variables=n("<div><\/div>").addClass("simulation-variables").appendTo(t.element).resultswindowviewer();this.plotDiv=n("<div><\/div>").appendTo(t.element).resultswindowviewer();this.refresh()},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this,r=this.options;n==="data"&&(this.options.data=t);n==="plot"&&(this.options.plot=t);this._super(n,t);this.refresh()},show:function(n){switch(n){case undefined:this.variables.show();this.plotDiv.show();break;case"SimulationVariables":this.variables.show();break;case"SimulationPlot":this.plotDiv.show()}},hide:function(n){n==="SimulationVariables"&&(this.variables.hide(),this.element.children().not(this.variables).show());n==="SimulationPlot"&&(this.plotDiv.hide(),this.element.children().not(this.plotDiv).show())},ChangeVisibility:function(n,t){try{this.plot.simulationplot("ChangeVisibility",n,t)}catch(i){}}})}(jQuery),function(n){n.widget("BMA.userdialog",{options:{message:"",functions:[]},_create:function(){var t=this;this.element.addClass("window dialog");this.element.draggable({containment:"parent",scroll:!1});this._add_close_button();this.message=n("<div><div>").text(this.options.message).addClass("window-title").appendTo(t.element);this.buttons=n("<div><div>").addClass("button-list").appendTo(t.element);var i=n("<button><\/button>").text("Yes").appendTo(this.buttons),r=n("<button><\/button>").text("No").appendTo(this.buttons),u=n("<button><\/button>").text("Cancel").appendTo(this.buttons);this._bind_functions();this._popup_position()},_add_close_button:function(){var t=this,i=n("<div><\/div>").addClass("close-icon").appendTo(t.element),r=n("<img>").attr("src","../../images/close.png").appendTo(i);r.bind("click",function(){t.element.hide()})},_popup_position:function(){var t=n(".dialog");t.each(function(){var i=n(this).outerWidth(),r=n(this).outerHeight(),u=n(window).outerWidth(),f=n(window).outerHeight(),e=(u-i)/2,o=(f-r)/2;u>i&&t.css({left:e});u<i&&t.css({left:5});f>r&&t.css({top:o});f<r&&t.css({top:5})})},_bind_functions:function(){var t=this.options.functions,i=this.buttons.children("button"),n;if(t!==null&&t.length===3)for(n=0;n<3;n++)i.eq(n).bind("click",t[n])},Show:function(){this.element.show()},Hide:function(){this.element.hide()},_destroy:function(){this.element.empty()},_setOption:function(n,t){var i=this;switch(n){case"message":this.message.text(i.options.message)}this._super(n,t)}})}(jQuery),function(n){n.widget("BMA.bmaeditor",{options:{name:"name",rangeFrom:0,rangeTo:0,functions:["VAR","CONST"],operators1:["+","-","*","/"],operators2:["AVG","MIN","MAX","CEIL","FLOOR"],inputs:[],formula:"",approved:undefined},resetElement:function(){var t=this,i;this.name.val(t.options.name);this.rangeFrom.val(t.options.rangeFrom);this.rangeTo.val(t.options.rangeTo);this.listOfInputs.empty();i=this.options.inputs;i.forEach(function(i){var r=n("<div><\/div>").text(i).appendTo(t.listOfInputs);r.bind("click",function(){t.formulaTextArea.insertAtCaret("var("+n(this).text()+")").change();t.listOfInputs.hide()})});this.formulaTextArea.val(t.options.formula);window.Commands.Execute("FormulaEdited",{formula:t.options.formula,inputs:t._inputsArray()})},SetValidation:function(n,t){this.options.approved=n;var i=this;this.options.approved===undefined?(i.element.removeClass("bmaeditor-expanded"),i.prooficon.removeClass("formula-failed-icon"),i.prooficon.removeClass("formula-validated-icon"),this.formulaTextArea.removeClass("formula-failed-textarea"),this.formulaTextArea.removeClass("formula-validated-textarea")):this.options.approved===!0?(i.prooficon.removeClass("formula-failed-icon").addClass("formula-validated-icon"),this.formulaTextArea.removeClass("formula-failed-textarea").addClass("formula-validated-textarea"),i.element.removeClass("bmaeditor-expanded")):this.options.approved===!1&&(i.prooficon.removeClass("formula-validated-icon").addClass("formula-failed-icon"),this.formulaTextArea.removeClass("formula-validated-textarea").addClass("formula-failed-textarea"),i.element.addClass("bmaeditor-expanded"));i.errorMessage.text(t)},getCaretPos:function(n){var t=n[0],i,r;return(t.focus(),t.selectionStart)?t.selectionStart:document.selection?(i=document.selection.createRange(),r=i.duplicate(),i.collapse(!0),r.moveToElementText(t),r.setEndPoint("EndToEnd",i),r.text.length):0},_create:function(){var n=this;this.element.addClass("variable-editor");this.element.draggable({containment:"parent",scroll:!1});this._appendInputs();this._processExpandingContent();this._bindExpanding();this.resetElement()},_appendInputs:function(){var t=this,l=n("<div><\/div>").addClass("close-icon").appendTo(t.element),a=n('<img src="../../images/close.png">').appendTo(l),u,i,v,f,o,s,e,h,c,r;a.bind("click",function(){t.element.hide()});u=n("<div><\/div>").addClass("editor-namerange-container").appendTo(t.element);this.name=n('<input type="text" size="15">').addClass("variable-name").attr("placeholder","Variable Name").appendTo(u);i=n("<div><\/div>").appendTo(u);v=n("<span><\/span>").text("Range").appendTo(i);this.rangeFrom=n('<input type="text" min="0" max="100" size="1">').attr("placeholder","min").appendTo(i);f=n("<div><\/div>").addClass("div-triangles").appendTo(i);o=n("<div><\/div>").addClass("triangle-up").appendTo(f);o.bind("click",function(){var n=Number(t.rangeFrom.val());t._setOption("rangeFrom",n+1);window.Commands.Execute("VariableEdited",{})});s=n("<div><\/div>").addClass("triangle-down").appendTo(f);s.bind("click",function(){var n=Number(t.rangeFrom.val());t._setOption("rangeFrom",n-1);window.Commands.Execute("VariableEdited",{})});this.rangeTo=n('<input type="text" min="0" max="100" size="1">').attr("placeholder","max").appendTo(i);e=n("<div><\/div>").addClass("div-triangles").appendTo(i);h=n("<div><\/div>").addClass("triangle-up").appendTo(e);h.bind("click",function(){var n=Number(t.rangeTo.val());t._setOption("rangeTo",n+1);window.Commands.Execute("VariableEdited",{})});c=n("<div><\/div>").addClass("triangle-down").appendTo(e);c.bind("click",function(){var n=Number(t.rangeTo.val());t._setOption("rangeTo",n-1);window.Commands.Execute("VariableEdited",{})});r=n("<div><\/div>").addClass("target-function").appendTo(t.element);n("<div><\/div>").addClass("window-title").text("Target Function").appendTo(r);this.formulaTextArea=n("<textarea><\/textarea>").attr("spellcheck","false").addClass("formula-text-area").appendTo(r);this.prooficon=n("<div><\/div>").addClass("validation-icon").appendTo(r);this.errorMessage=n("<div><\/div>").addClass("formula-validation-message").appendTo(r)},_processExpandingContent:function(){var t=this,e=n("<div><\/div>").addClass("functions").appendTo(t.element),u,i,o,f,s,h,c,r,l;n("<div><\/div>").addClass("window-title").text("Inputs").appendTo(e);u=n("<ul><\/ul>").appendTo(e);i=n("<div><\/div>").addClass("operators").appendTo(t.element);n("<div><\/div>").addClass("window-title").text("Operators").appendTo(i);o=n("<ul><\/ul>").appendTo(i);f=n("<ul><\/ul>").appendTo(i);this.infoTextArea=n("<div><\/div>").addClass("operators-info").appendTo(i);s=this.options.functions;s.forEach(function(i,r){var f=n("<li><\/li>").appendTo(u),e=n("<button><\/button>").text(i).appendTo(f);f.hover(function(){t._OnHoverFunction(n(this).children("button"),t.infoTextArea)},function(){t._OffHoverFunction(n(this).children("button"),t.infoTextArea)});r!==0&&f.click(function(){var i=window.FunctionsRegistry.GetFunctionByName(n(this).text());t._InsertToFormula(i)})});h=this.options.operators1;h.forEach(function(i){var r=n("<li><\/li>").appendTo(o),u=n("<button><\/button>").text(i).appendTo(r);r.hover(function(){t._OnHoverFunction(n(this).children("button"),t.infoTextArea)},function(){t._OffHoverFunction(n(this).children("button"),t.infoTextArea)});r.click(function(){var i=window.FunctionsRegistry.GetFunctionByName(n(this).text());t._InsertToFormula(i)})});c=this.options.operators2;c.forEach(function(i){var r=n("<li><\/li>").appendTo(f),u=n("<button><\/button>").text(i).appendTo(r);r.hover(function(){t._OnHoverFunction(n(this).children("button"),t.infoTextArea)},function(){t._OffHoverFunction(n(this).children("button"),t.infoTextArea)});r.click(function(){var i=window.FunctionsRegistry.GetFunctionByName(n(this).text());t._InsertToFormula(i)})});i.width(f.width());this.inputsList=u.children().eq(0).addClass("var-button");r=this.inputsList.children("button").addClass("inputs-list-header");l=n("<div><\/div>").addClass("inputs-expandbttn").appendTo(r);this.listOfInputs=n("<div><\/div>").addClass("inputs-list-content").appendTo(t.inputsList).hide();this.inputsList.bind("click",function(){t.listOfInputs.is(":hidden")?(t.inputsList.css("border-radius","15px 15px 0 0"),t.listOfInputs.show(),r.addClass("inputs-list-header-expanded")):(t.inputsList.css("border-radius","15px"),t.listOfInputs.hide(),r.removeClass("inputs-list-header-expanded"))})},_OnHoverFunction:function(n,t){var i=n.addClass("ui-selected");n.parent().children().not(i).removeClass("ui-selected");this._refreshText(i,t)},_OffHoverFunction:function(n,t){n.parent().children().removeClass("ui-selected");t.text("")},_InsertToFormula:function(n){var t=this.getCaretPos(this.formulaTextArea)+n.Offset;this.formulaTextArea.insertAtCaret(n.InsertText).change();this.formulaTextArea[0].setSelectionRange(t,t)},_refreshText:function(t,i){var u=this,r;i.empty();r=window.FunctionsRegistry.GetFunctionByName(t.text());n("<h3><\/h3>").text(r.Head).appendTo(i);n("<p><\/p>").text(r.About).appendTo(i)},_bindExpanding:function(){var n=this;this.name.bind("input change",function(){n.options.name=n.name.val();window.Commands.Execute("VariableEdited",{})});this.rangeFrom.bind("input change",function(){n._setOption("rangeFrom",n.rangeFrom.val());window.Commands.Execute("VariableEdited",{})});this.rangeTo.bind("input change",function(){n._setOption("rangeTo",n.rangeTo.val());window.Commands.Execute("VariableEdited",{})});this.formulaTextArea.bind("input change propertychange",function(){n._setOption("formula",n.formulaTextArea.val());window.Commands.Execute("VariableEdited",{})})},_inputsArray:function(){for(var t=this.options.inputs,i={},n=0;n<t.length;n++)i[t[n]]===undefined?i[t[n]]=1:i[t[n]]++;return i},_setOption:function(t,i){var r=this,u,f;switch(t){case"name":r.options.name=i;this.name.val(r.options.name);break;case"rangeFrom":i>100&&(i=100);i<0&&(i=0);r.options.rangeFrom=i;this.rangeFrom.val(r.options.rangeFrom);break;case"rangeTo":i>100&&(i=100);i<0&&(i=0);r.options.rangeTo=i;this.rangeTo.val(r.options.rangeTo);break;case"formula":r.options.formula=i;u=r._inputsArray();this.formulaTextArea.val()!==r.options.formula&&this.formulaTextArea.val(r.options.formula);window.Commands.Execute("FormulaEdited",{formula:r.options.formula,inputs:u});break;case"inputs":this.options.inputs=i;this.listOfInputs.empty();f=this.options.inputs;f.forEach(function(t){var i=n("<div><\/div>").text(t).appendTo(r.listOfInputs);i.bind("click",function(){r.formulaTextArea.insertAtCaret("var("+n(this).text()+")").change();r.listOfInputs.hide()})})}n.Widget.prototype._setOption.apply(this,arguments);this._super("_setOption",t,i)},destroy:function(){n.Widget.prototype.destroy.call(this)}})}(jQuery);jQuery.fn.extend({insertAtCaret:function(n){return this.each(function(){var i;if(document.selection)this.focus(),i=document.selection.createRange(),i.text=n,this.focus();else if(this.selectionStart||this.selectionStart=="0"){var t=this.selectionStart,r=this.selectionEnd,u=this.scrollTop;this.value=this.value.substring(0,t)+n+this.value.substring(r,this.value.length);this.focus();this.selectionStart=t+n.length;this.selectionEnd=t+n.length;this.scrollTop=u}else this.value+=n,this.focus()})}}),function(n){n.widget("BMA.visibilitysettings",{_getList:function(){return this.list||this.element.find("ol,ul").eq(0)},_create:function(){var t=this,r,u;this.list=this._getList();this.items=this.list.find("li");this.listOptions=[];this.items.each(function(i){var u=this,r;t.listOptions[i]={};r=n(u).children();r.each(function(){var r=this,h=n(r).text(),s=n(r).attr("data-behavior"),o,u,f,e,c,l;if(s===undefined){for(o=0;o<i;o++)if(t.listOptions[o].name===h)throw"Options must be different";t.listOptions[i].name=h}else{f=undefined;try{u=n(r).attr("data-command")}catch(a){console.log("Error binding to command: "+a)}switch(s){case"toggle":t.listOptions[i].toggle===undefined?(f=u!==undefined?n(r).attr("data-default")==="true":undefined,e=n("<button><\/button>").appendTo(n(r)),f?(e.parent().addClass("default-button onoff green"),e.text("ON")):(e.parent().addClass("default-button onoff grey"),e.text("OFF")),t.listOptions[i].toggle=f,t.listOptions[i].toggleButton=e,u!==undefined&&e.parent().bind("click",function(){t.listOptions[i].toggle=!t.listOptions[i].toggle;window.Commands.Execute(u,t.listOptions[i].toggle);t.changeButtonONOFFStyle(i)})):console.log("Names of options should be different");break;case"increment":t.listOptions[i].increment===undefined&&(f=u!==undefined?parseInt(n(r).attr("data-default"))||10:undefined,n(this).addClass("pill-button-box"),c=n("<button>+<\/button>").addClass("pill-button").appendTo(n(r)).addClass("hoverable"),l=n("<button>-<\/button>").addClass("pill-button").appendTo(n(r)).addClass("hoverable"),t.listOptions[i].increment=f,c.bind("click",function(){t.listOptions[i].increment++;window.Commands.Execute(u,t.listOptions[i].increment)}),l.bind("click",function(){t.listOptions[i].increment--;window.Commands.Execute(u,t.listOptions[i].increment)}))}f===undefined&&console.log(s+" "+u+" "+f)}})});var i=n("<ul><\/ul>").addClass("button-list").appendTo(n("#visibilityOptionsContent")),f=n("<li><\/li>").addClass("default-button").appendTo(i),e=n("<button><\/button>").text("Fit To View").width(60).appendTo(f);e.bind("click",function(){window.Commands.Execute("ModelFitToView",{})});r=n("<li><\/li>").addClass("default-button").appendTo(i);u=n("<button><\/button>").text("Save as SVG").width(60).appendTo(r);u.bind("click",function(){window.Commands.Execute("SaveSVG",{})})},changeButtonONOFFStyle:function(n){var t=this.listOptions[n].toggleButton;this.listOptions[n].toggle?(t.text("ON"),t.parent().removeClass("grey").addClass("green")):(t.text("OFF"),t.parent().removeClass("green").addClass("grey"))},_setOption:function(t,i){switch(t){case"settingsState":for(var r=0;r<this.listOptions.length;r++){if(this.listOptions[r].name===i.name){this.listOptions[r].toggle=i.toggle;this.changeButtonONOFFStyle(r);this.listOptions[r].increment=i.increment;return}console.log("No such option")}}n.Widget.prototype._setOption.apply(this,arguments);this._super("_setOption",t,i)},destroy:function(){n.Widget.prototype.destroy.call(this)}})}(jQuery);
//# sourceMappingURL=tool.min.js.map
