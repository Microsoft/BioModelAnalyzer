<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>LTL Formula View Sample</title>
    <link rel="stylesheet" type="text/css" href="../css/idd.css" />
    <link rel="stylesheet" href="../css/BMA_less.min.css" type="text/css" />
    <link rel="stylesheet" href="../css/StyleSheet.min.css" type="text/css" />

    <script src="../Scripts/jquery-2.1.1.min.js"></script>
    <script src="../Scripts/jquery-ui-1.10.4.min.js"></script>
    <script src="../js/jquery.svg.min.js"></script>
    <script src="../js/rx.js"></script>
    <script src="../js/rx.jQuery.js"></script>
    <script src="../js/idd.js"></script>
    <script src="../js/svgplot.js"></script>
    <script src="../tool.js"></script>

    <script>
        $(document).ready(function () {
            //Creating CommandRegistry
            window.Commands = new BMA.CommandRegistry();

            //Creating Operators registry
            var registry = new BMA.LTLOperations.OperatorsRegistry();


            //Loading widgets
            var drawingSurface = $("#drawingSurface");
            drawingSurface.drawingsurface();

            var elementPanel = $("#elementPanel");
            for (var i = 0; i < registry.Operators.length; i++) {
                var operator = registry.Operators[i];

                $("<input></input>")
                    .attr("type", "radio")
                    .attr("id", "btn-" + operator.Name)
                    .attr("name", "drawing-button")
                    .attr("data-type", operator.Name)
                    .appendTo(elementPanel);

                var label = $("<label></label>").attr("data-operator", operator.Name).css("border", "none").css("border-radius", "50px 50px 50px 50px").attr("for", "btn-" + operator.Name).css("z-index", 9999999).appendTo(elementPanel);
                var img = $("<div></div>").css("overflow", "hidden").attr("title", operator.Name).appendTo(label);

                img.svg({
                    onLoad: function (svg) {
                        svg.configure({
                            width: img.width(),
                            height: img.height(),
                            viewBox: "-10 -10 20 20",
                            preserveAspectRatio: "none meet"
                        }, true);

                        var op = new BMA.LTLOperations.Operation();
                        op.Operator = registry.GetOperatorByName(operator.Name);
                        op.Operands = op.Operator.OperandsCount > 1 ? [undefined, undefined] : [undefined];
                        var operationLayout = new BMA.LTLOperations.OperationLayout(svg, op, { x: 0, y: 0 });

                        var bbox = operationLayout.BoundingBox;
                        svg.configure({
                            width: bbox.width,
                            height: bbox.height,
                            viewBox: (bbox.x - 1) + " " + (bbox.y - 1) + " " + (bbox.width + 2) + " " + (bbox.height + 2),
                            preserveAspectRatio: "none meet"
                        });

                        img.width(bbox.width).height(bbox.height);
                        label.width(bbox.width).height(bbox.height);
                    }
                });

                label.draggable({ helper: "clone" });
            }

            $("#elementPanel input").click(function (event) {
                window.Commands.Execute("AddOperatorSelect", $(this).attr("data-type"));
            });

            elementPanel.buttonset();



            $("#button-pointer").click(function (event) {
                window.Commands.Execute("AddOperatorSelect", undefined);
            });

            $("#undoredotoolbar").buttonset();

            //Loading Drivers
            var svgPlotDriver = new BMA.UIDrivers.SVGPlotDriver(drawingSurface);


            //Loading Presenters
            var tpPresenter = new BMA.LTL.TemporalPropertiesPresenter(window.Commands, svgPlotDriver, svgPlotDriver, svgPlotDriver);

            svgPlotDriver.SetGridVisibility(false);
        });
    </script>
</head>
<body>
    <div id="tools" class="bma-toolbarpanel">
        
        <div id="undoredotoolbar" class="undoredo-toolbar">
            <input type="radio" id="button-pointer" name="drawing-button" checked="checked" />
            <label for="button-pointer">
                <img class="pointer-icon" title="Selection tool" />
            </label>

            <!--<div class="bma-toolbarpanel-verticalline"></div>-->

            <!--<button id="button-undo">
                <div class="undo-icon" title="Undo"></div>
            </button>
            <button id="button-redo">
                <div class="redo-icon" title="Redo"></div>
            </button>-->
        </div>

        <div id="elementPanel" class="elements-toolbar"></div>
    </div>

    <div id="drawingSurceContainer" class="bma-drawingsurfacecontainer">
        <div id="drawingSurface" class="bma-drawingsurface"></div>
    </div>
</body>
</html>
